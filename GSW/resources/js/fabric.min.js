function _c0d2170afde75219919e980cd593c10ab152d907(){};/*! Fabric.js Copyright 2008-2014, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.4.8"};typeof exports!="undefined"&&(exports.fabric=fabric),typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement,fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],function(){function c(g,f){if(!this.__eventListeners[g]){return}f?fabric.util.removeFromArray(this.__eventListeners[g],f):this.__eventListeners[g].length=0}function a(g,f){this.__eventListeners||(this.__eventListeners={});if(arguments.length===1){for(var h in g){this.on(h,g[h])}}else{this.__eventListeners[g]||(this.__eventListeners[g]=[]),this.__eventListeners[g].push(f)}return this}function d(e,g){if(!this.__eventListeners){return}if(arguments.length===0){this.__eventListeners={}}else{if(arguments.length===1&&typeof arguments[0]=="object"){for(var f in e){c.call(this,f,e[f])}}else{c.call(this,e,g)}}return this}function b(j,g){if(!this.__eventListeners){return}var k=this.__eventListeners[j];if(!k){return}for(var h=0,f=k.length;h<f;h++){k[h].call(this,g||{})}return this}fabric.Observable={observe:a,stopObserving:d,fire:b,on:a,off:d,trigger:b}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var b=0,a=arguments.length;b<a;b++){this._onObjectAdded(arguments[b])}return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(c,a,d){var b=this.getObjects();return d?b[a]=c:b.splice(a,0,c),this._onObjectAdded(c),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){var c=this.getObjects(),a;for(var d=0,b=arguments.length;d<b;d++){a=c.indexOf(arguments[d]),a!==-1&&(c.splice(a,1),this._onObjectRemoved(arguments[d]))}return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(c,a){var d=this.getObjects(),b=d.length;while(b--){c.call(a,d[b],b,d)}return this},getObjects:function(a){return typeof a=="undefined"?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(b,a){return b+=a.complexity?a.complexity():0,b},0)}},function(c){var a=Math.sqrt,d=Math.atan2,b=Math.PI/180;fabric.util={removeFromArray:function(g,f){var h=g.indexOf(f);return h!==-1&&g.splice(h,1),g},getRandomInt:function(g,f){return Math.floor(Math.random()*(f-g+1))+g},degreesToRadians:function(f){return f*b},radiansToDegrees:function(f){return f/b},rotatePoint:function(k,g,m){var j=Math.sin(m),f=Math.cos(m);k.subtractEquals(g);var h=k.x*f-k.y*j,l=k.x*j+k.y*f;return(new fabric.Point(h,l)).addEquals(g)},transformPoint:function(g,f,h){return h?new fabric.Point(f[0]*g.x+f[1]*g.y,f[2]*g.x+f[3]*g.y):new fabric.Point(f[0]*g.x+f[1]*g.y+f[4],f[2]*g.x+f[3]*g.y+f[5])},invertTransform:function(h){var f=h.slice(),i=1/(h[0]*h[3]-h[1]*h[2]);f=[i*h[3],-i*h[1],-i*h[2],i*h[0],0,0];var g=fabric.util.transformPoint({x:h[4],y:h[5]},f);return f[4]=-g.x,f[5]=-g.y,f},toFixed:function(g,f){return parseFloat(Number(g).toFixed(f))},falseFunction:function(){return !1},getKlass:function(g,f){return g=fabric.util.string.camelize(g.charAt(0).toUpperCase()+g.slice(1)),fabric.util.resolveNamespace(f)[g]},resolveNamespace:function(f){if(!f){return fabric}var j=f.split("."),h=j.length,e=c||fabric.window;for(var g=0;g<h;++g){e=e[j[g]]}return e},loadImage:function(j,g,k,h){if(!j){g&&g.call(k,j);return}var f=fabric.util.createImage();f.onload=function(){g&&g.call(k,f),f=f.onload=f.onerror=null},f.onerror=function(){fabric.log("Error loading "+f.src),g&&g.call(k,null,!0),f=f.onload=f.onerror=null},j.indexOf("data")!==0&&typeof h!="undefined"&&(f.crossOrigin=h),f.src=j},enlivenObjects:function(l,h,p,k){function g(){++m===f&&h&&h(j)}l=l||[];var j=[],m=0,f=l.length;if(!f){h&&h(j);return}l.forEach(function(n,i){if(!n||!n.type){g();return}var q=fabric.util.getKlass(n.type,p);q.async?q.fromObject(n,function(r,e){e||(j[i]=r,k&&k(n,j[i])),g()}):(j[i]=q.fromObject(n),k&&k(n,j[i]),g())})},groupSVGElements:function(h,f,i){var g;return h.length>1?g=new fabric.PathGroup(h,f):g=h[0],typeof i!="undefined"&&g.setSourcePath(i),g},populateWithProperties:function(j,g,k){if(k&&Object.prototype.toString.call(k)==="[object Array]"){for(var h=0,f=k.length;h<f;h++){k[h] in j&&(g[k[h]]=j[k[h]])}}},drawDashedLine:function(v,g,n,A,k,z){var y=A-g,t=k-n,m=a(y*y+t*t),x=d(t,y),q=z.length,j=0,w=!0;v.save(),v.translate(g,n),v.moveTo(0,0),v.rotate(x),g=0;while(m>g){g+=z[j++%q],g>m&&(g=m),v[w?"lineTo":"moveTo"](g,0),w=!w}v.restore()},createCanvasElement:function(f){return f||(f=fabric.document.createElement("canvas")),!f.getContext&&typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(f),f},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(k){var g=k.prototype;for(var m=g.stateProperties.length;m--;){var j=g.stateProperties[m],f=j.charAt(0).toUpperCase()+j.slice(1),h="set"+f,l="get"+f;g[l]||(g[l]=function(i){return new Function('return this.get("'+i+'")')}(j)),g[h]||(g[h]=function(i){return new Function("value",'return this.set("'+i+'", value)')}(j))}},clipContext:function(g,f){f.save(),f.beginPath(),g.clipTo(f),f.clip()},multiplyTransformMatrices:function(k,p){var h=[[k[0],k[2],k[4]],[k[1],k[3],k[5]],[0,0,1]],f=[[p[0],p[2],p[4]],[p[1],p[3],p[5]],[0,0,1]],j=[];for(var q=0;q<3;q++){j[q]=[];for(var g=0;g<3;g++){var m=0;for(var l=0;l<3;l++){m+=h[q][l]*f[l][g]}j[q][g]=m}}return[j[0][0],j[1][0],j[0][1],j[1][1],j[0][2],j[1][2]]},getFunctionBody:function(f){return(String(f).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(k,g){var l=fabric.util.array.min(k,"x"),j=fabric.util.array.min(k,"y");l=l<0?l:0,j=l<0?j:0;for(var f=0,h=k.length;f<h;f++){k[f].x-=g.width/2+l||0,k[f].y-=g.height/2+j||0}},isTransparent:function(k,p,h,f){f>0&&(p>f?p-=f:p=0,h>f?h-=f:h=0);var j=!0,q=k.getImageData(p,h,f*2||1,f*2||1);for(var g=3,m=q.data.length;g<m;g+=4){var l=q.data[g];j=l<=0;if(j===!1){break}}return q=null,j}}}(typeof exports!="undefined"?exports:this),function(){function b(B,J,G,z,R,M,I,P,K){d=h.call(arguments);if(f[d]){return f[d]}var F=c(I,G,z,P,K,B,J),O=(F.x1-F.x0)*(F.x1-F.x0)+(F.y1-F.y0)*(F.y1-F.y0),s=1/O-0.25;s<0&&(s=0);var H=Math.sqrt(s);M===R&&(H=-H);var L=0.5*(F.x0+F.x1)-H*(F.y1-F.y0),n=0.5*(F.y0+F.y1)+H*(F.x1-F.x0),Q=Math.atan2(F.y0-n,F.x0-L),r=Math.atan2(F.y1-n,F.x1-L),A=r-Q;A<0&&M===1?A+=2*Math.PI:A>0&&M===0&&(A-=2*Math.PI);var j=Math.ceil(Math.abs(A/(Math.PI*0.5+0.001))),q=[];for(var e=0;e<j;e++){var k=Q+e*A/j,D=Q+(e+1)*A/j;q[e]=[L,n,k,D,G,z,F.sinTh,F.cosTh]}return f[d]=q,q}function c(C,I,w,j,z,J,q){var H=C*(Math.PI/180),F=Math.sin(H),B=Math.cos(H);I=Math.abs(I),w=Math.abs(w);var y=B*(j-J)+F*(z-q),E=B*(z-q)-F*(j-J),A=y*y/(I*I)+E*E/(w*w);A*=0.25,A>1&&(A=Math.sqrt(A),I*=A,w*=A);var k=B/I,D=F/I,G=-F/w,x=B/w;return{x0:k*j+D*z,y0:G*j+x*z,x1:k*J+D*q,y1:G*J+x*q,sinTh:F,cosTh:B}}function g(P,K,D,H,A,V,O,J){d=h.call(arguments);if(a[d]){return a[d]}var R=Math.sin(D),L=Math.cos(D),G=Math.sin(H),Q=Math.cos(H),z=J*A,I=-O*V,M=O*A,q=J*V,U=0.25*(H-D),t=8/3*Math.sin(U)*Math.sin(U)/Math.sin(U*2),B=P+L-t*R,k=K+R+t*L,r=P+Q,j=K+G,n=r+t*G,F=j-t*Q;return a[d]=[z*B+I*k,M*B+q*k,z*n+I*F,M*n+q*F,z*r+I*j,M*r+q*j],a[d]}var f={},a={},h=Array.prototype.join,d;fabric.util.drawArc=function(w,C,k,i){var D=i[0],B=i[1],z=i[2],q=i[3],m=i[4],y=i[5],o=i[6],j=b(y,o,D,B,q,m,z,C,k);for(var x=0;x<j.length;x++){var A=g.apply(this,j[x]);w.bezierCurveTo.apply(w,A)}}}(),function(){function b(g,l){var j=d.call(arguments,2),e=[];for(var h=0,k=g.length;h<k;h++){e[h]=j.length?g[h][l].apply(g[h],j):g[h][l].call(g[h])}return e}function f(h,g){return a(h,g,function(j,i){return j>=i})}function c(h,g){return a(h,g,function(j,i){return j<i})}function a(k,h,l){if(!k||k.length===0){return}var j=k.length-1,g=h?k[j][h]:k[j];if(h){while(j--){l(k[j][h],g)&&(g=k[j][h])}}else{while(j--){l(k[j],g)&&(g=k[j])}}return g}var d=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(k){if(this===void 0||this===null){throw new TypeError}var h=Object(this),l=h.length>>>0;if(l===0){return -1}var j=0;arguments.length>0&&(j=Number(arguments[1]),j!==j?j=0:j!==0&&j!==Number.POSITIVE_INFINITY&&j!==Number.NEGATIVE_INFINITY&&(j=(j>0||-1)*Math.floor(Math.abs(j))));if(j>=l){return -1}var g=j>=0?j:Math.max(l-Math.abs(j),0);for(;g<l;g++){if(g in h&&h[g]===k){return g}}return -1}),Array.prototype.forEach||(Array.prototype.forEach=function(i,g){for(var j=0,h=this.length>>>0;j<h;j++){j in this&&i.call(g,this[j],j,this)}}),Array.prototype.map||(Array.prototype.map=function(k,h){var l=[];for(var j=0,g=this.length>>>0;j<g;j++){j in this&&(l[j]=k.call(h,this[j],j,this))}return l}),Array.prototype.every||(Array.prototype.every=function(i,g){for(var j=0,h=this.length>>>0;j<h;j++){if(j in this&&!i.call(g,this[j],j,this)){return !1}}return !0}),Array.prototype.some||(Array.prototype.some=function(i,g){for(var j=0,h=this.length>>>0;j<h;j++){if(j in this&&i.call(g,this[j],j,this)){return !0}}return !1}),Array.prototype.filter||(Array.prototype.filter=function(l,h){var m=[],k;for(var g=0,j=this.length>>>0;g<j;g++){g in this&&(k=this[g],l.call(h,k,g,this)&&m.push(k))}return m}),Array.prototype.reduce||(Array.prototype.reduce=function(i){var g=this.length>>>0,j=0,h;if(arguments.length>1){h=arguments[1]}else{do{if(j in this){h=this[j++];break}if(++j>=g){throw new TypeError}}while(!0)}for(;j<g;j++){j in this&&(h=i.call(null,h,this[j],j,this))}return h}),fabric.util.array={invoke:b,min:c,max:f}}(),function(){function b(d,c){for(var f in c){d[f]=c[f]}return d}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}}(),function(){function b(d){return d.replace(/-+(.)?/g,function(g,f){return f?f.toUpperCase():""})}function a(f,d){return f.charAt(0).toUpperCase()+(d?f.slice(1):f.slice(1).toLowerCase())}function c(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:b,capitalize:a,escapeXml:c}}(),function(){var b=Array.prototype.slice,a=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(f){var d=this,e=b.call(arguments,1),g;return e.length?g=function(){return a.call(d,this instanceof c?this:f,e.concat(b.call(arguments)))}:g=function(){return a.call(d,this instanceof c?this:f,arguments)},c.prototype=this.prototype,g.prototype=new c,g})}(),function(){function b(){}function c(e){var i=this.constructor.superclass.prototype[e];return arguments.length>1?i.apply(this,f.call(arguments,1)):i.call(this)}function g(){function i(){this.initialize.apply(this,arguments)}var l=null,k=f.call(arguments,0);typeof k[0]=="function"&&(l=k.shift()),i.superclass=l,i.subclasses=[],l&&(b.prototype=l.prototype,i.prototype=new b,l.subclasses.push(i));for(var e=0,j=k.length;e<j;e++){d(i,k[e],l)}return i.prototype.initialize||(i.prototype.initialize=a),i.prototype.constructor=i,i.prototype.callSuper=c,i}var f=Array.prototype.slice,a=function(){},h=function(){for(var i in {toString:1}){if(i==="toString"){return !1}}return !0}(),d=function(m,k,l){for(var j in k){j in m.prototype&&typeof m.prototype[j]=="function"&&(k[j]+"").indexOf("callSuper")>-1?m.prototype[j]=function(i){return function(){var o=this.constructor.superclass;this.constructor.superclass=l;var e=k[i].apply(this,arguments);this.constructor.superclass=o;if(i!=="initialize"){return e}}}(j):m.prototype[j]=k[j],h&&(k.toString!==Object.prototype.toString&&(m.prototype.toString=k.toString),k.valueOf!==Object.prototype.valueOf&&(m.prototype.valueOf=k.valueOf))}};fabric.util.createClass=g}(),function(){function k(f){var c=Array.prototype.slice.call(arguments,1),g,d,a=c.length;for(d=0;d<a;d++){g=typeof f[c[d]];if(!/^(?:function|object|unknown)$/.test(g)){return !1}}return !0}function q(c,a){return{handler:a,wrappedHandler:y(c,a)}}function y(c,a){return function(d){a.call(z(c),d||fabric.window.event)}}function j(c,a){return function(g){if(I[c]&&I[c][a]){var f=I[c][a];for(var d=0,e=f.length;d<e;d++){f[d].call(this,g||fabric.window.event)}}}}function H(c,e){c||(c=fabric.window.event);var d=c.target||(typeof c.srcElement!==G?c.srcElement:null),a=fabric.util.getScrollLeftTop(d,e);return{x:b(c)+a.left,y:A(c)+a.top}}function E(d,a,f){var c=d.type==="touchend"?"changedTouches":"touches";return d[c]&&d[c][0]?d[c][0][a]-(d[c][0][a]-d[c][0][f])||d[f]:d[f]}var G="unknown",z,w,C=function(){var a=0;return function(c){return c.__uniqueID||(c.__uniqueID="uniqueID__"+a++)}}();(function(){var a={};z=function(c){return a[c]},w=function(c,d){a[c]=d}})();var J=k(fabric.document.documentElement,"addEventListener","removeEventListener")&&k(fabric.window,"addEventListener","removeEventListener"),F=k(fabric.document.documentElement,"attachEvent","detachEvent")&&k(fabric.window,"attachEvent","detachEvent"),B={},I={},D,x;J?(D=function(c,a,d){c.addEventListener(a,d,!1)},x=function(c,a,d){c.removeEventListener(a,d,!1)}):F?(D=function(d,c,g){var f=C(d);w(f,d),B[f]||(B[f]={}),B[f][c]||(B[f][c]=[]);var a=q(f,g);B[f][c].push(a),d.attachEvent("on"+c,a.wrappedHandler)},x=function(g,c,i){var f=C(g),d;if(B[f]&&B[f][c]){for(var h=0,a=B[f][c].length;h<a;h++){d=B[f][c][h],d&&d.handler===i&&(g.detachEvent("on"+c,d.wrappedHandler),B[f][c][h]=null)}}}):(D=function(f,a,g){var d=C(f);I[d]||(I[d]={});if(!I[d][a]){I[d][a]=[];var c=f["on"+a];c&&I[d][a].push(c),f["on"+a]=j(d,a)}I[d][a].push(g)},x=function(g,c,i){var f=C(g);if(I[f]&&I[f][c]){var d=I[f][c];for(var h=0,a=d.length;h<a;h++){d[h]===i&&d.splice(h,1)}}}),fabric.util.addListener=D,fabric.util.removeListener=x;var b=function(a){return typeof a.clientX!==G?a.clientX:0},A=function(a){return typeof a.clientY!==G?a.clientY:0};fabric.isTouchSupported&&(b=function(a){return E(a,"pageX","clientX")},A=function(a){return E(a,"pageY","clientY")}),fabric.util.getPointer=H,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function f(l,j){var m=l.style;if(!m){return l}if(typeof j=="string"){return l.style.cssText+=";"+j,j.indexOf("opacity")>-1?c(l,j.match(/opacity:\s*(\d?\.?\d*)/)[1]):l}for(var k in j){if(k==="opacity"){c(l,j[k])}else{var h=k==="float"||k==="cssFloat"?typeof m.styleFloat=="undefined"?"cssFloat":"styleFloat":k;m[h]=j[k]}}return l}var b=fabric.document.createElement("div"),g=typeof b.style.opacity=="string",d=typeof b.style.filter=="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(h){return h};g?c=function(i,h){return i.style.opacity=h,i}:d&&(c=function(i,h){var j=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(j.zoom=1),a.test(j.filter)?(h=h>=0.9999?"":"alpha(opacity="+h*100+")",j.filter=j.filter.replace(a,h)):j.filter+=" alpha(opacity="+h*100+")",i}),fabric.util.setStyle=f}(),function(){function q(a){return typeof a=="string"?fabric.document.getElementById(a):a}function v(i,a){var l=fabric.document.createElement(i);for(var f in a){f==="class"?l.className=a[f]:f==="for"?l.htmlFor=a[f]:l.setAttribute(f,a[f])}return l}function c(f,a){f&&(" "+f.className+" ").indexOf(" "+a+" ")===-1&&(f.className+=(f.className?" ":"")+a)}function p(f,a,i){return typeof a=="string"&&(a=v(a,i)),f.parentNode&&f.parentNode.replaceChild(a,f),a.appendChild(f),a}function m(y,l){var A,x,f=0,w=0,z=fabric.document.documentElement,a=fabric.document.body||{scrollLeft:0,scrollTop:0};x=y;while(y&&y.parentNode&&!A){y=y.parentNode,y!==fabric.document&&fabric.util.getElementStyle(y,"position")==="fixed"&&(A=y),y!==fabric.document&&x!==l&&fabric.util.getElementStyle(y,"position")==="absolute"?(f=0,w=0):y===fabric.document?(f=a.scrollLeft||z.scrollLeft||0,w=a.scrollTop||z.scrollTop||0):(f+=y.scrollLeft||0,w+=y.scrollTop||0)}return{left:f,top:w}}function j(y){var l,A=y&&y.ownerDocument,x={left:0,top:0},f={left:0,top:0},w,z={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!A){return{left:0,top:0}}for(var a in z){f[z[a]]+=parseInt(g(y,a),10)||0}return l=A.documentElement,typeof y.getBoundingClientRect!="undefined"&&(x=y.getBoundingClientRect()),w=fabric.util.getScrollLeftTop(y,null),{left:x.left+w.left-(l.clientLeft||0)+f.left,top:x.top+w.top-(l.clientTop||0)+f.top}}var k=Array.prototype.slice,d,b=function(a){return k.call(a,0)};try{d=b(fabric.document.childNodes) instanceof Array}catch(h){}d||(b=function(f){var a=new Array(f.length),i=f.length;while(i--){a[i]=f[i]}return a});var g;fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?g=function(f,a){return fabric.document.defaultView.getComputedStyle(f,null)[a]}:g=function(f,a){var i=f.style[a];return !i&&f.currentStyle&&(i=f.currentStyle[a]),i},function(){function l(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),a?n.style[a]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function f(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),a?n.style[a]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var i=fabric.document.documentElement.style,a="userSelect" in i?"userSelect":"MozUserSelect" in i?"MozUserSelect":"WebkitUserSelect" in i?"WebkitUserSelect":"KhtmlUserSelect" in i?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=l,fabric.util.makeElementSelectable=f}(),function(){function a(s,l){var u=fabric.document.getElementsByTagName("head")[0],o=fabric.document.createElement("script"),f=!0;o.onload=o.onreadystatechange=function(i){if(f){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}f=!1,l(i||fabric.window.event),o=o.onload=o.onreadystatechange=null}},o.src=s,u.appendChild(o)}fabric.util.getScript=a}(),fabric.util.getById=q,fabric.util.toArray=b,fabric.util.makeElement=v,fabric.util.addClass=c,fabric.util.wrapElement=p,fabric.util.getScrollLeftTop=m,fabric.util.getElementOffset=j,fabric.util.getElementStyle=g}(),function(){function c(g,f){return g+(/\?/.test(g)?"&":"?")+f}function d(){}function b(j,g){g||(g={});var h=g.method?g.method.toUpperCase():"GET",k=g.onComplete||function(){},f=a(),e;return f.onreadystatechange=function(){f.readyState===4&&(k(f),f.onreadystatechange=d)},h==="GET"&&(e=null,typeof g.parameters=="string"&&(j=c(j,g.parameters))),f.open(h,j,!0),(h==="POST"||h==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(e),f}var a=function(){var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}];for(var f=h.length;f--;){try{var i=h[f]();if(i){return h[f]}}catch(g){}}}();fabric.util.request=b}(),fabric.log=function(){},fabric.warn=function(){},typeof console!="undefined"&&["log","warn"].forEach(function(a){typeof console[a]!="undefined"&&console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),function(){function b(d){c(function(y){d||(d={});var e=y||+(new Date),m=d.duration||500,z=e+m,j,x=d.onChange||function(){},w=d.abort||function(){return !1},q=d.easing||function(i,f,l,h){return -l*Math.cos(i/h*(Math.PI/2))+l+f},k="startValue" in d?d.startValue:0,v="endValue" in d?d.endValue:100,n=d.byValue||v-k;d.onStart&&d.onStart(),function g(f){j=f||+(new Date);var h=j>z?m:j-e;if(w()){d.onComplete&&d.onComplete();return}x(q(h,k,n,m));if(j>z){d.onComplete&&d.onComplete();return}c(g)}(e)})}function c(){return a.apply(fabric.window,arguments)}var a=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){fabric.window.setTimeout(d,1000/60)};fabric.util.animate=b,fabric.util.requestAnimFrame=c}(),function(){function Z(c,a,d,b){return c<Math.abs(a)?(c=a,b=d/4):b=d/(2*Math.PI)*Math.asin(a/c),{a:c,c:a,p:d,s:b}}function I(b,a,c){return b.a*Math.pow(2,10*(a-=1))*Math.sin((a*c-b.s)*2*Math.PI/b.p)}function P(c,a,d,b){return d*((c=c/b-1)*c*c+1)+a}function L(c,a,d,b){return c/=b/2,c<1?d/2*c*c*c+a:d/2*((c-=2)*c*c+2)+a}function V(c,a,d,b){return d*(c/=b)*c*c*c+a}function J(c,a,d,b){return -d*((c=c/b-1)*c*c*c-1)+a}function O(c,a,d,b){return c/=b/2,c<1?d/2*c*c*c*c+a:-d/2*((c-=2)*c*c*c-2)+a}function G(c,a,d,b){return d*(c/=b)*c*c*c*c+a}function ad(c,a,d,b){return d*((c=c/b-1)*c*c*c*c+1)+a}function Y(c,a,d,b){return c/=b/2,c<1?d/2*c*c*c*c*c+a:d/2*((c-=2)*c*c*c*c+2)+a}function R(c,a,d,b){return -d*Math.cos(c/b*(Math.PI/2))+d+a}function ab(c,a,d,b){return d*Math.sin(c/b*(Math.PI/2))+a}function W(c,a,d,b){return -d/2*(Math.cos(Math.PI*c/b)-1)+a}function M(c,a,d,b){return c===0?a:d*Math.pow(2,10*(c/b-1))+a}function aa(c,a,d,b){return c===b?a+d:d*(-Math.pow(2,-10*c/b)+1)+a}function F(c,a,d,b){return c===0?a:c===b?a+d:(c/=b/2,c<1?d/2*Math.pow(2,10*(c-1))+a:d/2*(-Math.pow(2,-10*--c)+2)+a)}function Q(c,a,d,b){return -d*(Math.sqrt(1-(c/=b)*c)-1)+a}function X(c,a,d,b){return d*Math.sqrt(1-(c=c/b-1)*c)+a}function A(c,a,d,b){return c/=b/2,c<1?-d/2*(Math.sqrt(1-c*c)-1)+a:d/2*(Math.sqrt(1-(c-=2)*c)+1)+a}function ac(l,g,d,e){var k=1.70158,c=0,b=d;if(l===0){return g}l/=e;if(l===1){return g+d}c||(c=e*0.3);var h=Z(b,d,c,k);return -I(h,l,e)+g}function D(e,k,g,d){var f=1.70158,h=0,c=g;if(e===0){return k}e/=d;if(e===1){return k+g}h||(h=d*0.3);var b=Z(c,g,h,f);return b.a*Math.pow(2,-10*e)*Math.sin((e*d-b.s)*2*Math.PI/b.p)+b.c+k}function H(l,g,d,e){var k=1.70158,c=0,b=d;if(l===0){return g}l/=e/2;if(l===2){return g+d}c||(c=e*0.3*1.5);var h=Z(b,d,c,k);return l<1?-0.5*I(h,l,e)+g:h.a*Math.pow(2,-10*(l-=1))*Math.sin((l*e-h.s)*2*Math.PI/h.p)*0.5+h.c+g}function q(d,b,f,c,a){return a===undefined&&(a=1.70158),f*(d/=c)*d*((a+1)*d-a)+b}function B(d,b,f,c,a){return a===undefined&&(a=1.70158),f*((d=d/c-1)*d*((a+1)*d+a)+1)+b}function j(d,b,f,c,a){return a===undefined&&(a=1.70158),d/=c/2,d<1?f/2*d*d*(((a*=1.525)+1)*d-a)+b:f/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+b}function z(c,a,d,b){return d-K(b-c,0,d,b)+a}function K(c,a,d,b){return(c/=b)<1/2.75?d*7.5625*c*c+a:c<2/2.75?d*(7.5625*(c-=1.5/2.75)*c+0.75)+a:c<2.5/2.75?d*(7.5625*(c-=2.25/2.75)*c+0.9375)+a:d*(7.5625*(c-=2.625/2.75)*c+0.984375)+a}function U(c,a,d,b){return c<b/2?z(c*2,0,d,b)*0.5+a:K(c*2-b,0,d,b)*0.5+d*0.5+a}fabric.util.ease={easeInQuad:function(c,a,d,b){return d*(c/=b)*c+a},easeOutQuad:function(c,a,d,b){return -d*(c/=b)*(c-2)+a},easeInOutQuad:function(c,a,d,b){return c/=b/2,c<1?d/2*c*c+a:-d/2*(--c*(c-2)-1)+a},easeInCubic:function(c,a,d,b){return d*(c/=b)*c*c+a},easeOutCubic:P,easeInOutCubic:L,easeInQuart:V,easeOutQuart:J,easeInOutQuart:O,easeInQuint:G,easeOutQuint:ad,easeInOutQuint:Y,easeInSine:R,easeOutSine:ab,easeInOutSine:W,easeInExpo:M,easeOutExpo:aa,easeInOutExpo:F,easeInCirc:Q,easeOutCirc:X,easeInOutCirc:A,easeInElastic:ac,easeOutElastic:D,easeInOutElastic:H,easeInBack:q,easeOutBack:B,easeInOutBack:j,easeInBounce:z,easeOutBounce:K,easeInOutBounce:U}}(),function(J){function I(a){return a in q?q[a]:a}function E(d,f,c){var a;d!=="fill"&&d!=="stroke"||f!=="none"?d==="fillRule"?f=f==="evenodd"?"destination-over":f:d==="strokeDashArray"?f=f.replace(/,/g," ").split(/\s+/):d==="transformMatrix"?c&&c.transformMatrix?f=B(c.transformMatrix,w.parseTransformAttribute(f)):f=w.parseTransformAttribute(f):d==="visible"?(f=f==="none"||f==="hidden"?!1:!0,c&&c.visible===!1&&(f=!1)):d==="originX"&&(f=f==="start"?"left":f==="end"?"right":"center"):f="",a=Object.prototype.toString.call(f)==="[object Array]";var b=a?f.map(parseFloat):parseFloat(f);return !a&&isNaN(b)?f:b}function L(b){for(var c in N){if(!b[c]||typeof b[N[c]]=="undefined"){continue}if(b[c].indexOf("url(")===0){continue}var a=new w.Color(b[c]);b[c]=a.setAlpha(x(a.getAlpha()*b[N[c]],2)).toRgba(),delete b[N[c]]}return b}function G(g,c){var l=g.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(!l){return}var f=l[1],b=l[3],d=l[4],h=l[5],a=l[6];f&&(c.fontStyle=f),b&&(c.fontWeight=isNaN(parseFloat(b))?b:parseFloat(b)),d&&(c.fontSize=parseFloat(d)),a&&(c.fontFamily=a),h&&(c.lineHeight=h==="normal"?1:h)}function A(c,a){var d,b;c.replace(/;$/,"").split(";").forEach(function(g){var f=g.split(":");d=I(f[0].trim().toLowerCase()),b=E(d,f[1].trim()),d==="font"?G(b,a):a[d]=b})}function K(d,b){var f,c;for(var a in d){if(typeof d[a]=="undefined"){continue}f=I(a.toLowerCase()),c=E(f,d[a]),f==="font"?G(c,b):b[f]=c}}function k(m){var f=m.nodeName,b=m.getAttribute("class"),g=m.getAttribute("id"),y={};for(var d in w.cssRules){var v=b&&(new RegExp("^\\."+b)).test(d)||g&&(new RegExp("^#"+g)).test(d)||(new RegExp("^"+f)).test(d);if(v){for(var t in w.cssRules[d]){var p=I(t),l=E(p,w.cssRules[d][t]);y[p]=l}}}return y}function D(Q){var U=Q.querySelectorAll("use");for(var m=0;m<U.length;m++){var b=U[m],y=b.getAttribute("xlink:href").substr(1),V=b.getAttribute("x")||0,g=b.getAttribute("y")||0,T=Q.getElementById(y).cloneNode(!0),S=(b.getAttribute("transform")||"")+" translate("+V+", "+g+")";for(var P=0,v=b.attributes,R=v.length;P<R;P++){var O=v.item(P);O.nodeName!=="x"&&O.nodeName!=="y"&&O.nodeName!=="xlink:href"&&(O.nodeName==="transform"?S=S+" "+O.nodeValue:T.setAttribute(O.nodeName,O.nodeValue))}T.setAttribute("transform",S),T.removeAttribute("id");var d=b.parentNode;d.replaceChild(T,b)}}function j(b){var c=b.objects,a=b.options;return c=c.map(function(d){return w[z(d.type)].fromObject(d)}),{objects:c,options:a}}function M(b,a,c){a[c]&&a[c].toSVG&&b.push('<pattern x="0" y="0" id="',c,'Pattern" ','width="',a[c].source.width,'" height="',a[c].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[c].source.width,'" height="',a[c].source.height,'" xlink:href="',a[c].source.src,'"></image></pattern>')}var w=J.fabric||(J.fabric={}),C=w.util.object.extend,z=w.util.string.capitalize,F=w.util.object.clone,x=w.util.toFixed,B=w.util.multiplyTransformMatrices,q={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},N={stroke:"strokeOpacity",fill:"fillOpacity"};w.parseTransformAttribute=function(){function ab(b,a){var c=a[0];b[0]=Math.cos(c),b[1]=Math.sin(c),b[2]=-Math.sin(c),b[3]=Math.cos(c)}function U(c,a){var d=a[0],b=a.length===2?a[1]:a[0];c[0]=d,c[3]=b}function R(b,a){b[2]=a[0]}function X(b,a){b[1]=a[0]}function Q(b,a){b[4]=a[0],a.length===2&&(b[5]=a[1])}var T=[1,0,0,1,0,0],P="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",af="(?:\\s+,?\\s*|,\\s*)",aa="(?:(skewX)\\s*\\(\\s*("+P+")\\s*\\))",W="(?:(skewY)\\s*\\(\\s*("+P+")\\s*\\))",ad="(?:(rotate)\\s*\\(\\s*("+P+")(?:"+af+"("+P+")"+af+"("+P+"))?\\s*\\))",Y="(?:(scale)\\s*\\(\\s*("+P+")(?:"+af+"("+P+"))?\\s*\\))",S="(?:(translate)\\s*\\(\\s*("+P+")(?:"+af+"("+P+"))?\\s*\\))",ac="(?:(matrix)\\s*\\(\\s*("+P+")"+af+"("+P+")"+af+"("+P+")"+af+"("+P+")"+af+"("+P+")"+af+"("+P+")\\s*\\))",O="(?:"+ac+"|"+S+"|"+Y+"|"+ad+"|"+aa+"|"+W+")",V="(?:"+O+"(?:"+af+O+")*)",Z="^\\s*(?:"+V+"?)\\s*$",t=new RegExp(Z),ae=new RegExp(O,"g");return function(d){var c=T.concat(),e=[];if(!d||d&&!t.test(d)){return c}d.replace(ae,function(f){var a=(new RegExp(O)).exec(f).filter(function(h){return h!==""&&h!=null}),i=a[1],g=a.slice(2).map(parseFloat);switch(i){case"translate":Q(c,g);break;case"rotate":g[0]=w.util.degreesToRadians(g[0]),ab(c,g);break;case"scale":U(c,g);break;case"skewX":R(c,g);break;case"skewY":X(c,g);break;case"matrix":c=g}e.push(c.concat()),c=T.concat()});var b=e[0];while(e.length>1){e.shift(),b=w.util.multiplyTransformMatrices(b,e[0])}return b}}(),w.parseSVGDocument=function(){function a(g,f){while(g&&(g=g.parentNode)){if(f.test(g.nodeName)){return !0}}return !1}var c=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,d="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",b=new RegExp("^\\s*("+d+"+)\\s*,?\\s*("+d+"+)\\s*,?\\s*("+d+"+)\\s*,?\\s*("+d+"+)\\s*$");return function(U,R,O){if(!U){return}var ac=new Date;D(U);var Y=w.util.toArray(U.getElementsByTagName("*"));if(Y.length===0&&w.isLikelyNode){Y=U.selectNodes('//*[name(.)!="svg"]');var V=[];for(var aa=0,W=Y.length;aa<W;aa++){V[aa]=Y[aa]}Y=V}var Q=Y.filter(function(f){return c.test(f.tagName)&&!a(f,/^(?:pattern|defs)$/)});if(!Q||Q&&!Q.length){R&&R([],{});return}var Z=U.getAttribute("viewBox"),t=parseFloat(U.getAttribute("width")),X=parseFloat(U.getAttribute("height")),m=null,ab=null,s,P,i,r;Z&&(Z=Z.match(b))&&(i=parseFloat(Z[1]),r=parseFloat(Z[2]),s=parseFloat(Z[3]),P=parseFloat(Z[4])),s&&t&&s!==t?(m=s,ab=P):(m=t?t:s,ab=X?X:P);var e={width:m,height:ab,widthAttr:t,heightAttr:X};w.gradientDefs=w.getGradientDefs(U),w.cssRules=w.getCSSRules(U),w.parseElements(Q,function(f){w.documentParsingTime=new Date-ac,R&&R(f,e)},F(e),O)}}();var H={has:function(b,a){a(!1)},get:function(){},set:function(){}};C(w,{resolveGradients:function(c){for(var d=c.length;d--;){var b=c[d].get("fill");if(!/^url\(/.test(b)){continue}var a=b.slice(5,b.length-1);w.gradientDefs[a]&&c[d].set("fill",w.Gradient.fromElement(w.gradientDefs[a],c[d]))}},getGradientDefs:function(f){var b=f.getElementsByTagName("linearGradient"),g=f.getElementsByTagName("radialGradient"),d,a,c={};a=b.length;for(;a--;){d=b[a],c[d.getAttribute("id")]=d}a=g.length;for(;a--;){d=g[a],c[d.getAttribute("id")]=d}return c},parseAttributes:function(d,c){if(!d){return}var a,b={};d.parentNode&&/^g$/i.test(d.parentNode.nodeName)&&(b=w.parseAttributes(d.parentNode,c));var f=c.reduce(function(e,g){return a=d.getAttribute(g),a&&(g=I(g),a=E(g,a,b),e[g]=a),e},{});return f=C(f,C(k(d),w.parseStyleAttribute(d))),L(C(b,f))},parseElements:function(c,d,b,a){(new w.ElementsParser(c,d,b,a)).parse()},parseStyleAttribute:function(b){var a={},c=b.getAttribute("style");return c?(typeof c=="string"?A(c,a):K(c,a),a):a},parsePointsAttribute:function(f){if(!f){return null}f=f.trim();var b=f.indexOf(",")>-1;f=f.split(/\s+/);var g=[],d,a;if(b){d=0,a=f.length;for(;d<a;d++){var c=f[d].split(",");g.push({x:parseFloat(c[0]),y:parseFloat(c[1])})}}else{d=0,a=f.length;for(;d<a;d+=2){g.push({x:parseFloat(f[d]),y:parseFloat(f[d+1])})}}return g},getCSSRules:function(f){var b=f.getElementsByTagName("style"),h={},d;for(var a=0,c=b.length;a<c;a++){var g=b[0].textContent;g=g.replace(/\/\*[\s\S]*?\*\//g,""),d=g.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(i){return i.trim()}),d.forEach(function(v){var P=v.match(/([\s\S]*?)\s*\{([^}]*)\}/);v=P[1];var l=P[2].trim(),n=l.replace(/;$/,"").split(/\s*;\s*/);h[v]||(h[v]={});for(var Q=0,m=n.length;Q<m;Q++){var O=n[Q].split(/\s*:\s*/),y=O[0],p=O[1];h[v][y]=p}})}return h},loadSVGFromURL:function(c,d,b){function a(e){var f=e.responseXML;f&&!f.documentElement&&w.window.ActiveXObject&&e.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));if(!f||!f.documentElement){return}w.parseSVGDocument(f.documentElement,function(h,g){H.set(c,{objects:w.util.array.invoke(h,"toObject"),options:g}),d(h,g)},b)}c=c.replace(/^\n\s*/,"").trim(),H.has(c,function(e){e?H.get(c,function(g){var f=j(g);d(f.objects,f.options)}):new w.util.request(c,{method:"get",onComplete:a})})},loadSVGFromString:function(d,f,c){d=d.trim();var a;if(typeof DOMParser!="undefined"){var b=new DOMParser;b&&b.parseFromString&&(a=b.parseFromString(d,"text/xml"))}else{w.window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(d.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")))}w.parseSVGDocument(a.documentElement,function(h,g){f(h,g)},c)},createSVGFontFacesMarkup:function(c){var a="";for(var d=0,b=c.length;d<b;d++){if(c[d].type!=="text"||!c[d].path){continue}a+=["@font-face {","font-family: ",c[d].fontFamily,"; ","src: url('",c[d].path,"')","}"].join("")}return a&&(a=['<style type="text/css">',"<![CDATA[",a,"]]>","</style>"].join("")),a},createSVGRefElementsMarkup:function(b){var a=[];return M(a,b,"backgroundColor"),M(a,b,"overlayColor"),a.join("")}})}(typeof exports!="undefined"?exports:this),fabric.ElementsParser=function(c,a,d,b){this.elements=c,this.callback=a,this.options=d,this.reviver=b},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var b=0,a=this.elements.length;b<a;b++){(function(d,c){setTimeout(function(){d.createObject(d.elements[c],c)},0)})(this,b)}},fabric.ElementsParser.prototype.createObject=function(c,a){var d=fabric[fabric.util.string.capitalize(c.tagName)];if(d&&d.fromElement){try{this._createObject(d,c,a)}catch(b){fabric.log(b)}}else{this.checkIfDone()}},fabric.ElementsParser.prototype._createObject=function(c,a,d){if(c.async){c.fromElement(a,this.createCallback(d,a),this.options)}else{var b=c.fromElement(a,this.options);this.reviver&&this.reviver(a,b),this.instances.splice(d,0,b),this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(b,a){var c=this;return function(d){c.reviver&&c.reviver(a,d),c.instances.splice(b,0,d),c.checkIfDone()}},fabric.ElementsParser.prototype.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(a){return a!=null}),fabric.resolveGradients(this.instances),this.callback(this.instances))},function(b){function c(f,d){this.x=f,this.y=d}var a=b.fabric||(b.fabric={});if(a.Point){a.warn("fabric.Point is already defined");return}a.Point=c,c.prototype={constructor:c,add:function(d){return new c(this.x+d.x,this.y+d.y)},addEquals:function(d){return this.x+=d.x,this.y+=d.y,this},scalarAdd:function(d){return new c(this.x+d,this.y+d)},scalarAddEquals:function(d){return this.x+=d,this.y+=d,this},subtract:function(d){return new c(this.x-d.x,this.y-d.y)},subtractEquals:function(d){return this.x-=d.x,this.y-=d.y,this},scalarSubtract:function(d){return new c(this.x-d,this.y-d)},scalarSubtractEquals:function(d){return this.x-=d,this.y-=d,this},multiply:function(d){return new c(this.x*d,this.y*d)},multiplyEquals:function(d){return this.x*=d,this.y*=d,this},divide:function(d){return new c(this.x/d,this.y/d)},divideEquals:function(d){return this.x/=d,this.y/=d,this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(f,d){return new c(this.x+(f.x-this.x)*d,this.y+(f.y-this.y)*d)},distanceFrom:function(f){var d=this.x-f.x,g=this.y-f.y;return Math.sqrt(d*d+g*g)},midPointFrom:function(d){return new c(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new c(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new c(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(f,d){this.x=f,this.y=d},setFromPoint:function(d){this.x=d.x,this.y=d.y},swap:function(f){var d=this.x,g=this.y;this.x=f.x,this.y=f.y,f.x=d,f.y=g}}}(typeof exports!="undefined"?exports:this),function(b){function c(d){this.status=d,this.points=[]}var a=b.fabric||(b.fabric={});if(a.Intersection){a.warn("fabric.Intersection is already defined");return}a.Intersection=c,a.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}},a.Intersection.intersectLineLine=function(m,d,j,t){var g,q=(t.x-j.x)*(m.y-j.y)-(t.y-j.y)*(m.x-j.x),p=(d.x-m.x)*(m.y-j.y)-(d.y-m.y)*(m.x-j.x),k=(t.y-j.y)*(d.x-m.x)-(t.x-j.x)*(d.y-m.y);if(k!==0){var h=q/k,n=p/k;0<=h&&h<=1&&0<=n&&n<=1?(g=new c("Intersection"),g.points.push(new a.Point(m.x+h*(d.x-m.x),m.y+h*(d.y-m.y)))):g=new c}else{q===0||p===0?g=new c("Coincident"):g=new c("Parallel")}return g},a.Intersection.intersectLinePolygon=function(k,n,d){var h=new c,p=d.length;for(var g=0;g<p;g++){var m=d[g],l=d[(g+1)%p],j=c.intersectLineLine(k,n,m,l);h.appendPoints(j.points)}return h.points.length>0&&(h.status="Intersection"),h},a.Intersection.intersectPolygonPolygon=function(l,h){var k=new c,g=l.length;for(var j=0;j<g;j++){var m=l[j],f=l[(j+1)%g],d=c.intersectLinePolygon(m,f,h);k.appendPoints(d.points)}return k.points.length>0&&(k.status="Intersection"),k},a.Intersection.intersectPolygonRectangle=function(t,d,m){var y=d.min(m),j=d.max(m),x=new a.Point(j.x,y.y),w=new a.Point(y.x,j.y),q=c.intersectLinePolygon(y,x,t),k=c.intersectLinePolygon(x,j,t),v=c.intersectLinePolygon(j,w,t),n=c.intersectLinePolygon(w,y,t),g=new c;return g.appendPoints(q.points),g.appendPoints(k.points),g.appendPoints(v.points),g.appendPoints(n.points),g.points.length>0&&(g.status="Intersection"),g}}(typeof exports!="undefined"?exports:this),function(c){function d(f){f?this._tryParsingColor(f):this.setSource([0,0,0,1])}function b(g,f,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?g+(f-g)*6*h:h<0.5?f:h<2/3?g+(f-g)*(2/3-h)*6:g}var a=c.fabric||(c.fabric={});if(a.Color){a.warn("fabric.Color is already defined.");return}a.Color=d,a.Color.prototype={_tryParsingColor:function(g){var f;g in d.colorNameMap&&(g=d.colorNameMap[g]);if(g==="transparent"){this.setSource([255,255,255,0]);return}f=d.sourceFromHex(g),f||(f=d.sourceFromRgb(g)),f||(f=d.sourceFromHsl(g)),f&&this.setSource(f)},_rgbToHsl:function(m,j,g){m/=255,j/=255,g/=255;var k,t,h,q=a.util.array.max([m,j,g]),p=a.util.array.min([m,j,g]);h=(q+p)/2;if(q===p){k=t=0}else{var l=q-p;t=h>0.5?l/(2-q-p):l/(q+p);switch(q){case m:k=(j-g)/l+(j<g?6:0);break;case j:k=(g-m)/l+2;break;case g:k=(m-j)/l+4}k/=6}return[Math.round(k*360),Math.round(t*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(f){this._source=f},toRgb:function(){var f=this.getSource();return"rgb("+f[0]+","+f[1]+","+f[2]+")"},toRgba:function(){var f=this.getSource();return"rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+")"},toHsl:function(){var g=this.getSource(),f=this._rgbToHsl(g[0],g[1],g[2]);return"hsl("+f[0]+","+f[1]+"%,"+f[2]+"%)"},toHsla:function(){var g=this.getSource(),f=this._rgbToHsl(g[0],g[1],g[2]);return"hsla("+f[0]+","+f[1]+"%,"+f[2]+"%,"+g[3]+")"},toHex:function(){var h=this.getSource(),f,i,g;return f=h[0].toString(16),f=f.length===1?"0"+f:f,i=h[1].toString(16),i=i.length===1?"0"+i:i,g=h[2].toString(16),g=g.length===1?"0"+g:g,f.toUpperCase()+i.toUpperCase()+g.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(g){var f=this.getSource();return f[3]=g,this.setSource(f),this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),h=g[3];return this.setSource([f,f,f,h]),this},toBlackWhite:function(h){var f=this.getSource(),i=(f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),g=f[3];return h=h||127,i=Number(i)<Number(h)?0:255,this.setSource([i,i,i,g]),this},overlayWith:function(l){l instanceof d||(l=new d(l));var h=[],k=this.getAlpha(),g=0.5,j=this.getSource(),m=l.getSource();for(var f=0;f<3;f++){h.push(Math.round(j[f]*(1-g)+m[f]*g))}return h[3]=k,this.setSource(h),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},a.Color.fromRgb=function(f){return d.fromSource(d.sourceFromRgb(f))},a.Color.sourceFromRgb=function(k){var g=k.match(d.reRGBa);if(g){var j=parseInt(g[1],10)/(/%$/.test(g[1])?100:1)*(/%$/.test(g[1])?255:1),f=parseInt(g[2],10)/(/%$/.test(g[2])?100:1)*(/%$/.test(g[2])?255:1),h=parseInt(g[3],10)/(/%$/.test(g[3])?100:1)*(/%$/.test(g[3])?255:1);return[parseInt(j,10),parseInt(f,10),parseInt(h,10),g[4]?parseFloat(g[4]):1]}},a.Color.fromRgba=d.fromRgb,a.Color.fromHsl=function(f){return d.fromSource(d.sourceFromHsl(f))},a.Color.sourceFromHsl=function(m){var r=m.match(d.reHSLa);if(!r){return}var j=(parseFloat(r[1])%360+360)%360/360,v=parseFloat(r[2])/(/%$/.test(r[2])?100:1),g=parseFloat(r[3])/(/%$/.test(r[3])?100:1),q,p,k;if(v===0){q=p=k=g}else{var h=g<=0.5?g*(v+1):g+v-g*v,n=g*2-h;q=b(n,h,j+1/3),p=b(n,h,j),k=b(n,h,j-1/3)}return[Math.round(q*255),Math.round(p*255),Math.round(k*255),r[4]?parseFloat(r[4]):1]},a.Color.fromHsla=d.fromHsl,a.Color.fromHex=function(f){return d.fromSource(d.sourceFromHex(f))},a.Color.sourceFromHex=function(k){if(k.match(d.reHex)){var g=k.slice(k.indexOf("#")+1),j=g.length===3,f=j?g.charAt(0)+g.charAt(0):g.substring(0,2),h=j?g.charAt(1)+g.charAt(1):g.substring(2,4),l=j?g.charAt(2)+g.charAt(2):g.substring(4,6);return[parseInt(f,16),parseInt(h,16),parseInt(l,16),1]}},a.Color.fromSource=function(g){var f=new d;return f.setSource(g),f}}(typeof exports!="undefined"?exports:this),function(){function f(p){var w=p.getAttribute("style"),k=p.getAttribute("offset"),h,l;k=parseFloat(k)/(/%$/.test(k)?100:1);if(w){var x=w.split(/\s*;\s*/);x[x.length-1]===""&&x.pop();for(var j=x.length;j--;){var v=x[j].split(/\s*:\s*/),q=v[0].trim(),m=v[1].trim();q==="stop-color"?h=m:q==="stop-opacity"&&(l=m)}}return h||(h=p.getAttribute("stop-color")||"rgb(0,0,0)"),l||(l=p.getAttribute("stop-opacity")),h=(new fabric.Color(h)).toRgb(),{offset:k,color:h,opacity:isNaN(parseFloat(l))?1:parseFloat(l)}}function b(h){return{x1:h.getAttribute("x1")||0,y1:h.getAttribute("y1")||0,x2:h.getAttribute("x2")||"100%",y2:h.getAttribute("y2")||0}}function g(h){return{x1:h.getAttribute("fx")||h.getAttribute("cx")||"50%",y1:h.getAttribute("fy")||h.getAttribute("cy")||"50%",r1:0,x2:h.getAttribute("cx")||"50%",y2:h.getAttribute("cy")||"50%",r2:h.getAttribute("r")||"50%"}}function d(j,h){for(var k in h){if(typeof h[k]=="string"&&/^\d+%$/.test(h[k])){var i=parseFloat(h[k],10);if(k==="x1"||k==="x2"||k==="r2"){h[k]=fabric.util.toFixed(j.width*i/100,2)}else{if(k==="y1"||k==="y2"){h[k]=fabric.util.toFixed(j.height*i/100,2)}}}a(h,k,j)}}function a(i,h,j){if(h==="x1"||h==="x2"){i[h]-=fabric.util.toFixed(j.width/2,2)}else{if(h==="y1"||h==="y2"){i[h]-=fabric.util.toFixed(j.height/2,2)}}}function c(i,h){for(var j in h){a(h,j,i);if(j==="x1"||j==="x2"||j==="r2"){h[j]=fabric.util.toFixed(h[j]/i.width*100,2)+"%"}else{if(j==="y1"||j==="y2"){h[j]=fabric.util.toFixed(h[j]/i.height*100,2)+"%"}}}}fabric.Gradient=fabric.util.createClass({initialize:function(i){i||(i={});var h={};this.id=fabric.Object.__uid++,this.type=i.type||"linear",h={x1:i.coords.x1||0,y1:i.coords.y1||0,x2:i.coords.x2||0,y2:i.coords.y2||0},this.type==="radial"&&(h.r1=i.coords.r1||0,h.r2=i.coords.r2||0),this.coords=h,this.gradientUnits=i.gradientUnits||"objectBoundingBox",this.colorStops=i.colorStops.slice()},addColorStop:function(i){for(var h in i){var j=new fabric.Color(i[h]);this.colorStops.push({offset:h,color:j.toRgb(),opacity:j.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(l,j){var m=fabric.util.object.clone(this.coords),k;this.colorStops.sort(function(n,i){return n.offset-i.offset}),j&&this.gradientUnits==="userSpaceOnUse"?(m.x1+=l.width/2,m.y1+=l.height/2,m.x2+=l.width/2,m.y2+=l.height/2):this.gradientUnits==="objectBoundingBox"&&c(l,m),this.type==="linear"?k=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',m.x1,'" y1="',m.y1,'" x2="',m.x2,'" y2="',m.y2,'">']:this.type==="radial"&&(k=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',m.x2,'" cy="',m.y2,'" r="',m.r2,'" fx="',m.x1,'" fy="',m.y1,'">']);for(var h=0;h<this.colorStops.length;h++){k.push("<stop ",'offset="',this.colorStops[h].offset*100+"%",'" style="stop-color:',this.colorStops[h].color,this.colorStops[h].opacity?";stop-opacity: "+this.colorStops[h].opacity:";",'"/>')}return k.push(this.type==="linear"?"</linearGradient>":"</radialGradient>"),k.join("")},toLive:function(m){var j;if(!this.type){return}this.type==="linear"?j=m.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):this.type==="radial"&&(j=m.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));for(var q=0,l=this.colorStops.length;q<l;q++){var h=this.colorStops[q].color,k=this.colorStops[q].opacity,p=this.colorStops[q].offset;typeof k!="undefined"&&(h=(new fabric.Color(h)).setAlpha(k).toRgba()),j.addColorStop(parseFloat(p),h)}return j}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(k,m){var p=k.getElementsByTagName("stop"),j=k.nodeName==="linearGradient"?"linear":"radial",h=k.getAttribute("gradientUnits")||"objectBoundingBox",n=[],e={};j==="linear"?e=b(k):j==="radial"&&(e=g(k));for(var q=p.length;q--;){n.push(f(p[q]))}return d(m,e),new fabric.Gradient({type:j,coords:e,gradientUnits:h,colorStops:n})},forObject:function(i,h){return h||(h={}),d(i,h),new fabric.Gradient(h)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(b){b||(b={}),this.id=fabric.Object.__uid++;if(b.source){if(typeof b.source=="string"){if(typeof fabric.util.getFunctionBody(b.source)!="undefined"){this.source=new Function(fabric.util.getFunctionBody(b.source))}else{var a=this;this.source=fabric.util.createImage(),fabric.util.loadImage(b.source,function(c){a.source=c})}}else{this.source=b.source}}b.repeat&&(this.repeat=b.repeat),b.offsetX&&(this.offsetX=b.offsetX),b.offsetY&&(this.offsetY=b.offsetY)},toObject:function(){var a;return typeof this.source=="function"?a=String(this.source):typeof this.source.src=="string"&&(a=this.source.src),{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var b=typeof this.source=="function"?this.source():this.source,f=b.width/d.getWidth(),c=b.height/d.getHeight(),a="";return b.src?a=b.src:b.toDataURL&&(a=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+f+'" height="'+c+'"><image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+a+'"></image></pattern>'},toLive:function(b){var a=typeof this.source=="function"?this.source():this.source;if(!a){return""}if(typeof a.src!="undefined"){if(!a.complete){return""}if(a.naturalWidth===0||a.naturalHeight===0){return""}}return b.createPattern(a,this.repeat)}}),function(b){var a=b.fabric||(b.fabric={});if(a.Shadow){a.warn("fabric.Shadow is already defined.");return}a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(c){typeof c=="string"&&(c=this._parseShadow(c));for(var d in c){this[d]=c[d]}this.id=a.Object.__uid++},_parseShadow:function(f){var g=f.trim(),d=a.Shadow.reOffsetsAndBlur.exec(g)||[],c=g.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:c.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(d){var c="SourceAlpha";return d&&(d.fill===this.color||d.stroke===this.color)&&(c="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+c+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}var c={},d=a.Shadow.prototype;return this.color!==d.color&&(c.color=this.color),this.blur!==d.blur&&(c.blur=this.blur),this.offsetX!==d.offsetX&&(c.offsetX=this.offsetX),this.offsetY!==d.offsetY&&(c.offsetY=this.offsetY),c}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var c=fabric.util.object.extend,a=fabric.util.getElementOffset,d=fabric.util.removeFromArray,b=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(g,f){f||(f={}),this._initStatic(g,f),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(g,f){this._objects=[],this._createLowerCanvas(g),this._initOptions(f),this._setImageSmoothing(),f.overlayImage&&this.setOverlayImage(f.overlayImage,this.renderAll.bind(this)),f.backgroundImage&&this.setBackgroundImage(f.backgroundImage,this.renderAll.bind(this)),f.backgroundColor&&this.setBackgroundColor(f.backgroundColor,this.renderAll.bind(this)),f.overlayColor&&this.setOverlayColor(f.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=a(this.lowerCanvasEl),this},setOverlayImage:function(g,f,h){return this.__setBgOverlayImage("overlayImage",g,f,h)},setBackgroundImage:function(g,f,h){return this.__setBgOverlayImage("backgroundImage",g,f,h)},setOverlayColor:function(g,f){return this.__setBgOverlayColor("overlayColor",g,f)},setBackgroundColor:function(g,f){return this.__setBgOverlayColor("backgroundColor",g,f)},_setImageSmoothing:function(){var f=this.getContext();f.imageSmoothingEnabled=this.imageSmoothingEnabled,f.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,f.mozImageSmoothingEnabled=this.imageSmoothingEnabled,f.msImageSmoothingEnabled=this.imageSmoothingEnabled,f.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(h,f,i,g){return typeof f=="string"?fabric.util.loadImage(f,function(e){this[h]=new fabric.Image(e,g),i&&i()},this):(this[h]=f,i&&i()),this},__setBgOverlayColor:function(h,f,i){if(f&&f.source){var g=this;fabric.util.loadImage(f.source,function(e){g[h]=new fabric.Pattern({source:e,repeat:f.repeat,offsetX:f.offsetX,offsetY:f.offsetY}),i&&i()})}else{this[h]=f,i&&i()}return this},_createCanvasElement:function(){var f=fabric.document.createElement("canvas");f.style||(f.style={});if(!f){throw b}return this._initCanvasElement(f),f},_initCanvasElement:function(f){fabric.util.createCanvasElement(f);if(typeof f.getContext=="undefined"){throw b}},_initOptions:function(g){for(var f in g){this[f]=g[f]}this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px"},_createLowerCanvas:function(f){this.lowerCanvasEl=fabric.util.getById(f)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f){return this._setDimension("width",f)},setHeight:function(f){return this._setDimension("height",f)},setDimensions:function(g){for(var f in g){this._setDimension(f,g[f])}return this},_setDimension:function(g,f){return this.lowerCanvasEl[g]=f,this.lowerCanvasEl.style[g]=f+"px",this.upperCanvasEl&&(this.upperCanvasEl[g]=f,this.upperCanvasEl.style[g]=f+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=f),this.wrapperEl&&(this.wrapperEl.style[g]=f+"px"),this[g]=f,this.calcOffset(),this.renderAll(),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(g){this.viewportTransform=g,this.renderAll();for(var f=0,h=this._objects.length;f<h;f++){this._objects[f].setCoords()}return this},zoomToPoint:function(k,g){var l=k;k=fabric.util.transformPoint(k,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=g,this.viewportTransform[3]=g;var j=fabric.util.transformPoint(k,this.viewportTransform);this.viewportTransform[4]+=l.x-j.x,this.viewportTransform[5]+=l.y-j.y,this.renderAll();for(var f=0,h=this._objects.length;f<h;f++){this._objects[f].setCoords()}return this},setZoom:function(f){return this.zoomToPoint(new fabric.Point(0,0),f),this},absolutePan:function(g){this.viewportTransform[4]=-g.x,this.viewportTransform[5]=-g.y,this.renderAll();for(var f=0,h=this._objects.length;f<h;f++){this._objects[f].setCoords()}return this},relativePan:function(f){return this.absolutePan(new fabric.Point(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(g,f){if(!f){return}g.save();var h=this.viewportTransform;g.transform(h[0],h[1],h[2],h[3],h[4],h[5]),f.render(g),g.restore(),this.controlsAboveOverlay||f._renderControls(g)},_onObjectAdded:function(f){this.stateful&&f.setupState(),f.canvas=this,f.setCoords(),this.fire("object:added",{target:f}),f.fire("added")},_onObjectRemoved:function(f){this.getActiveObject()===f&&(this.fire("before:selection:cleared",{target:f}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:f}),f.fire("removed")},clearContext:function(f){return f.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(g){var f=this[g===!0&&this.interactive?"contextTop":"contextContainer"],h=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),g||this.clearContext(f),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,f),this._renderBackground(f),this._renderObjects(f,h),this._renderActiveGroup(f,h),this.clipTo&&f.restore(),this._renderOverlay(f),this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),this.fire("after:render"),this},_renderObjects:function(h,f){var i,g;if(!f){for(i=0,g=this._objects.length;i<g;++i){this._draw(h,this._objects[i])}}else{for(i=0,g=this._objects.length;i<g;++i){this._objects[i]&&!f.contains(this._objects[i])&&this._draw(h,this._objects[i])}}},_renderActiveGroup:function(g,f){if(f){var h=[];this.forEachObject(function(i){f.contains(i)&&h.push(i)}),f._set("objects",h),this._draw(g,f)}},_renderBackground:function(f){this.backgroundColor&&(f.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(f):this.backgroundColor,f.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(f,this.backgroundImage)},_renderOverlay:function(f){this.overlayColor&&(f.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(f):this.overlayColor,f.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(f,this.overlayImage)},renderTop:function(){var g=this.contextTop||this.contextContainer;this.clearContext(g),this.selection&&this._groupSelector&&this._drawSelection();var f=this.getActiveGroup();return f&&f.render(g),this._renderOverlay(g),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){return this._centerObject(f,new fabric.Point(this.getCenter().left,f.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(f){return this._centerObject(f,new fabric.Point(f.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(g){var f=this.getCenter();return this._centerObject(g,new fabric.Point(f.left,f.top)),this.renderAll(),this},_centerObject:function(g,f){return g.setPositionByOrigin(f,"center","center"),this},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,h){var g=this.getActiveGroup();g&&this.discardActiveGroup();var e={objects:this._toObjects(f,h)};return c(e,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,e,h),g&&(this.setActiveGroup(new fabric.Group(g.getObjects(),{originX:"center",originY:"center"})),g.forEachObject(function(i){i.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup())),e},_toObjects:function(g,f){return this.getObjects().map(function(e){return this._toObject(e,g,f)},this)},_toObject:function(j,g,k){var h;this.includeDefaultValues||(h=j.includeDefaultValues,j.includeDefaultValues=!1);var f=j[g](k);return this.includeDefaultValues||(j.includeDefaultValues=h),f},__serializeBgOverlay:function(){var f={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(f.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(f.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(f.overlayImage=this.overlayImage.toObject()),f},toSVG:function(g,f){g||(g={});var h=[];return this._setSVGPreamble(h,g),this._setSVGHeader(h,g),this._setSVGBgOverlayColor(h,"backgroundColor"),this._setSVGBgOverlayImage(h,"backgroundImage"),this._setSVGObjects(h,f),this._setSVGBgOverlayColor(h,"overlayColor"),this._setSVGBgOverlayImage(h,"overlayImage"),h.push("</svg>"),h.join("")},_setSVGPreamble:function(g,f){f.suppressPreamble||g.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(g,f){g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',f.viewBox?f.viewBox.width:this.width,'" ','height="',f.viewBox?f.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,f.viewBox?'viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(k,g){var l=this.getActiveGroup();l&&this.discardActiveGroup();for(var j=0,f=this.getObjects(),h=f.length;j<h;j++){k.push(f[j].toSVG(g))}l&&(this.setActiveGroup(new fabric.Group(l.getObjects())),l.forEachObject(function(i){i.set("active",!0)}))},_setSVGBgOverlayImage:function(g,f){this[f]&&this[f].toSVG&&g.push(this[f].toSVG())},_setSVGBgOverlayColor:function(g,f){this[f]&&this[f].source?g.push('<rect x="',this[f].offsetX,'" y="',this[f].offsetY,'" ','width="',this[f].repeat==="repeat-y"||this[f].repeat==="no-repeat"?this[f].source.width:this.width,'" height="',this[f].repeat==="repeat-x"||this[f].repeat==="no-repeat"?this[f].source.height:this.height,'" fill="url(#'+f+'Pattern)"',"></rect>"):this[f]&&f==="overlayColor"&&g.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[f],'"',"></rect>")},sendToBack:function(f){return d(this._objects,f),this._objects.unshift(f),this.renderAll&&this.renderAll()},bringToFront:function(f){return d(this._objects,f),this._objects.push(f),this.renderAll&&this.renderAll()},sendBackwards:function(j,g){var h=this._objects.indexOf(j);if(h!==0){var f=this._findNewLowerIndex(j,h,g);d(this._objects,j),this._objects.splice(f,0,j),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(k,g,l){var j;if(l){j=g;for(var f=g-1;f>=0;--f){var h=k.intersectsWithObject(this._objects[f])||k.isContainedWithinObject(this._objects[f])||this._objects[f].isContainedWithinObject(k);if(h){j=f;break}}}else{j=g-1}return j},bringForward:function(j,g){var h=this._objects.indexOf(j);if(h!==this._objects.length-1){var f=this._findNewUpperIndex(j,h,g);d(this._objects,j),this._objects.splice(f,0,j),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(k,g,l){var j;if(l){j=g;for(var f=g+1;f<this._objects.length;++f){var h=k.intersectsWithObject(this._objects[f])||k.isContainedWithinObject(this._objects[f])||this._objects[f].isContainedWithinObject(k);if(h){j=f;break}}}else{j=g+1}return j},moveTo:function(g,f){return d(this._objects,g),this._objects.splice(f,0,g),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),c(fabric.StaticCanvas.prototype,fabric.Observable),c(fabric.StaticCanvas.prototype,fabric.Collection),c(fabric.StaticCanvas.prototype,fabric.DataURLExporter),c(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(h){var f=fabric.util.createCanvasElement();if(!f||!f.getContext){return null}var i=f.getContext("2d");if(!i){return null}switch(h){case"getImageData":return typeof i.getImageData!="undefined";case"setLineDash":return typeof i.setLineDash!="undefined";case"toDataURL":return typeof f.toDataURL!="undefined";case"toDataURLWithQuality":try{return f.toDataURL("image/jpeg",0),!0}catch(g){}return !1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin},_setShadow:function(){if(!this.shadow){return}var a=this.canvas.contextTop;a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){var b=fabric.util.array.min,a=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(c){this.canvas=c,this._points=[]},onMouseDown:function(c){this._prepareForDrawing(c),this._captureDrawingPath(c),this._render()},onMouseMove:function(c){this._captureDrawingPath(c),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){var c=new fabric.Point(d.x,d.y);this._reset(),this._addPoint(c),this.canvas.contextTop.moveTo(c.x,c.y)},_addPoint:function(c){this._points.push(c)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(d){var c=new fabric.Point(d.x,d.y);this._addPoint(c)},_render:function(){var h=this.canvas.contextTop,d=this.canvas.viewportTransform;h.save(),h.transform(d[0],d[1],d[2],d[3],d[4],d[5]),h.beginPath();var k=this._points[0],g=this._points[1];this._points.length===2&&k.x===g.x&&k.y===g.y&&(k.x-=0.5,g.x+=0.5),h.moveTo(k.x,k.y);for(var c=1,f=this._points.length;c<f;c++){var j=k.midPointFrom(g);h.quadraticCurveTo(k.x,k.y,j.x,j.y),k=this._points[c],g=this._points[c+1]}h.lineTo(k.x,k.y),h.stroke(),h.restore()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(e){var c=[],h=[],p=e[0],d=e[1],m=p;for(var k=1,j=e.length;k<j;k++){var g=p.midPointFrom(d);c.push(m.x),c.push(g.x),h.push(m.y),h.push(g.y),p=e[k],d=e[k+1],m=g}return c.push(p.x),h.push(p.y),{minx:b(c),miny:b(h),maxx:a(c),maxy:a(h)}},convertPointsToSVGPath:function(k,p,g,c){var h=[],q=new fabric.Point(k[0].x-p,k[0].y-c),d=new fabric.Point(k[1].x-p,k[1].y-c);h.push("M ",k[0].x-p," ",k[0].y-c," ");for(var m=1,l=k.length;m<l;m++){var j=q.midPointFrom(d);h.push("Q ",q.x," ",q.y," ",j.x," ",j.y," "),q=new fabric.Point(k[m].x-p,k[m].y-c),m+1<k.length&&(d=new fabric.Point(k[m+1].x-p,k[m+1].y-c))}return h.push("L ",q.x," ",q.y," "),h},createPath:function(d){var c=new fabric.Path(d);return c.fill=null,c.stroke=this.color,c.strokeWidth=this.width,c.strokeLineCap=this.strokeLineCap,c.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,c.setShadow(this.shadow)),c},_finalizeAndAddPath:function(){var g=this.canvas.contextTop;g.closePath();var d=this._getSVGPathData().join("");if(d==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var h=this.box.minx+(this.box.maxx-this.box.minx)/2,f=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(h,f,3,0,Math.PI*2,!1);var c=this.createPath(d);c.set({left:h,top:f,originX:"center",originY:"center"}),this.canvas.add(c),c.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:c})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(c){var a=this.addPoint(c),d=this.canvas.contextTop,b=this.canvas.viewportTransform;d.save(),d.transform(b[0],b[1],b[2],b[3],b[4],b[5]),d.fillStyle=a.fill,d.beginPath(),d.arc(a.x,a.y,a.radius,0,Math.PI*2,!1),d.closePath(),d.fill(),d.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var f=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var b=[];for(var h=0,d=this.points.length;h<d;h++){var a=this.points[h],c=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&c.setShadow(this.shadow),b.push(c)}var g=new fabric.Group(b,{originX:"center",originY:"center"});g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.renderAll()},addPoint:function(c){var a=new fabric.Point(c.x,c.y),d=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return a.radius=d,a.fill=b,this.points.push(a),a}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var k=[];for(var d=0,b=this.sprayChunks.length;d<b;d++){var f=this.sprayChunks[d];for(var l=0,c=f.length;l<c;l++){var j=new fabric.Rect({width:f[l].width,height:f[l].width,left:f[l].x+1,top:f[l].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&j.setShadow(this.shadow),k.push(j)}}this.optimizeOverlapping&&(k=this._getOptimizedRects(k));var h=new fabric.Group(k,{originX:"center",originY:"center"});h.canvas=this.canvas,this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=g,this.canvas.renderAll()},_getOptimizedRects:function(f){var b={},g;for(var d=0,a=f.length;d<a;d++){g=f[d].left+""+f[d].top,b[g]||(b[g]=f[d])}var c=[];for(g in b){c.push(b[g])}return c},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var b=this.canvas.viewportTransform;d.save(),d.transform(b[0],b[1],b[2],b[3],b[4],b[5]);for(var f=0,c=this.sprayChunkPoints.length;f<c;f++){var a=this.sprayChunkPoints[f];typeof a.opacity!="undefined"&&(d.globalAlpha=a.opacity),d.fillRect(a.x,a.y,a.width,a.width)}d.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var b,h,d,a=this.width/2;for(var c=0;c<this.density;c++){b=fabric.util.getRandomInt(f.x-a,f.x+a),h=fabric.util.getRandomInt(f.y-a,f.y+a),this.dotWidthVariance?d=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):d=this.dotWidth;var g=new fabric.Point(b,h);g.width=d,this.randomOpacity&&(g.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(g)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var c=20,a=5,d=fabric.document.createElement("canvas"),b=d.getContext("2d");return d.width=d.height=c+a,b.fillStyle=this.color,b.beginPath(),b.arc(c/2,c/2,c/2,0,Math.PI*2,!1),b.closePath(),b.fill(),d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(b){var a=this.callSuper("createPath",b);return a.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),a}}),function(){var f=fabric.util.getPointer,b=fabric.util.degreesToRadians,h=fabric.util.radiansToDegrees,d=Math.atan2,a=Math.abs,c=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(j,i){i||(i={}),this._initStatic(j,i),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(j){var i=this._currentTransform;i.target.set({scaleX:i.original.scaleX,scaleY:i.original.scaleY,left:i.original.left,top:i.original.top}),this._shouldCenterTransform(j,i.target)?i.action==="rotate"?this._setOriginToCenter(i.target):(i.originX!=="center"&&(i.originX==="right"?i.mouseXSign=-1:i.mouseXSign=1),i.originY!=="center"&&(i.originY==="bottom"?i.mouseYSign=-1:i.mouseYSign=1),i.originX="center",i.originY="center"):(i.originX=i.original.originX,i.originY=i.original.originY)},containsPoint:function(k,i){var l=this.getPointer(k,!0),j=this._normalizePointer(i,l);return i.containsPoint(j)||i._findTargetCorner(l)},_normalizePointer:function(p,k){var u=this.getActiveGroup(),m=k.x,j=k.y,l=u&&p.type!=="group"&&u.contains(p),q;return l&&(q=new fabric.Point(u.left,u.top),q=fabric.util.transformPoint(q,this.viewportTransform,!0),m-=q.x,j-=q.y),{x:m,y:j}},isTargetTransparent:function(o,k,p){var m=o.hasBorders,j=o.transparentCorners;o.hasBorders=o.transparentCorners=!1,this._draw(this.contextCache,o),o.hasBorders=m,o.transparentCorners=j;var l=fabric.util.isTransparent(this.contextCache,k,p,this.targetFindTolerance);return this.clearContext(this.contextCache),l},_shouldClearSelection:function(k,i){var l=this.getActiveGroup(),j=this.getActiveObject();return !i||i&&l&&!l.contains(i)&&l!==i&&!k.shiftKey||i&&!i.evented||i&&!i.selectable&&j&&j!==i},_shouldCenterTransform:function(k,i){if(!i){return}var l=this._currentTransform,j;return l.action==="scale"||l.action==="scaleX"||l.action==="scaleY"?j=this.centeredScaling||i.centeredScaling:l.action==="rotate"&&(j=this.centeredRotation||i.centeredRotation),j?!k.altKey:k.altKey},_getOriginFromCorner:function(j,i){var k={x:j.originX,y:j.originY};if(i==="ml"||i==="tl"||i==="bl"){k.x="right"}else{if(i==="mr"||i==="tr"||i==="br"){k.x="left"}}if(i==="tl"||i==="mt"||i==="tr"){k.y="bottom"}else{if(i==="bl"||i==="mb"||i==="br"){k.y="top"}}return k},_getActionFromCorner:function(j,i){var k="drag";return i&&(k=i==="ml"||i==="mr"?"scaleX":i==="mt"||i==="mb"?"scaleY":i==="mtr"?"rotate":"scale"),k},_setupCurrentTransform:function(m,q){if(!q){return}var l=this.getPointer(m),j=q._findTargetCorner(this.getPointer(m,!0)),k=this._getActionFromCorner(q,j),p=this._getOriginFromCorner(q,j);this._currentTransform={target:q,action:k,scaleX:q.scaleX,scaleY:q.scaleY,offsetX:l.x-q.left,offsetY:l.y-q.top,originX:p.x,originY:p.y,ex:l.x,ey:l.y,left:q.left,top:q.top,theta:b(q.angle),width:q.width*q.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:q.left,top:q.top,scaleX:q.scaleX,scaleY:q.scaleY,originX:p.x,originY:p.y},this._resetCurrentTransform(m)},_translateObject:function(j,i){var k=this._currentTransform.target;k.get("lockMovementX")||k.set("left",j-this._currentTransform.offsetX),k.get("lockMovementY")||k.set("top",i-this._currentTransform.offsetY)},_scaleObject:function(p,w,l){var j=this._currentTransform,m=j.target,x=m.get("lockScalingX"),k=m.get("lockScalingY");if(x&&k){return}var v=m.translateToOriginPoint(m.getCenterPoint(),j.originX,j.originY),q=m.toLocalPoint(new fabric.Point(p,w),j.originX,j.originY);this._setLocalMouse(q,j),this._setObjectScale(q,j,x,k,l),m.setPositionByOrigin(v,j.originX,j.originY)},_setObjectScale:function(o,k,p,m,j){var l=k.target;k.newScaleX=l.scaleX,k.newScaleY=l.scaleY,j==="equally"&&!p&&!m?this._scaleObjectEqually(o,l,k):j?j==="x"&&!l.get("lockUniScaling")?(k.newScaleX=o.x/(l.width+l.strokeWidth),p||l.set("scaleX",k.newScaleX)):j==="y"&&!l.get("lockUniScaling")&&(k.newScaleY=o.y/(l.height+l.strokeWidth),m||l.set("scaleY",k.newScaleY)):(k.newScaleX=o.x/(l.width+l.strokeWidth),k.newScaleY=o.y/(l.height+l.strokeWidth),p||l.set("scaleX",k.newScaleX),m||l.set("scaleY",k.newScaleY)),this._flipObject(k)},_scaleObjectEqually:function(m,k,o){var l=m.y+m.x,j=(k.height+k.strokeWidth)*o.original.scaleY+(k.width+k.strokeWidth)*o.original.scaleX;o.newScaleX=o.original.scaleX*l/j,o.newScaleY=o.original.scaleY*l/j,k.set("scaleX",o.newScaleX),k.set("scaleY",o.newScaleY)},_flipObject:function(i){i.newScaleX<0&&(i.originX==="left"?i.originX="right":i.originX==="right"&&(i.originX="left")),i.newScaleY<0&&(i.originY==="top"?i.originY="bottom":i.originY==="bottom"&&(i.originY="top"))},_setLocalMouse:function(j,i){var k=i.target;i.originX==="right"?j.x*=-1:i.originX==="center"&&(j.x*=i.mouseXSign*2,j.x<0&&(i.mouseXSign=-i.mouseXSign)),i.originY==="bottom"?j.y*=-1:i.originY==="center"&&(j.y*=i.mouseYSign*2,j.y<0&&(i.mouseYSign=-i.mouseYSign)),a(j.x)>k.padding?j.x<0?j.x+=k.padding:j.x-=k.padding:j.x=0,a(j.y)>k.padding?j.y<0?j.y+=k.padding:j.y-=k.padding:j.y=0},_rotateObject:function(n,l){var k=this._currentTransform;if(k.target.get("lockRotation")){return}var m=d(k.ey-k.top,k.ex-k.left),p=d(l-k.top,n-k.left),j=h(p-m+k.theta);j<0&&(j=360+j),k.target.angle=j},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.setAngle(0)},_drawSelection:function(){var p=this.contextTop,k=this._groupSelector,s=k.left,l=k.top,q=a(s),j=a(l);p.fillStyle=this.selectionColor,p.fillRect(k.ex-(s>0?0:-s),k.ey-(l>0?0:-l),q,j),p.lineWidth=this.selectionLineWidth,p.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var i=k.ex+c-(s>0?0:q),m=k.ey+c-(l>0?0:j);p.beginPath(),fabric.util.drawDashedLine(p,i,m,i+q,m,this.selectionDashArray),fabric.util.drawDashedLine(p,i,m+j-1,i+q,m+j-1,this.selectionDashArray),fabric.util.drawDashedLine(p,i,m,i,m+j,this.selectionDashArray),fabric.util.drawDashedLine(p,i+q-1,m,i+q-1,m+j,this.selectionDashArray),p.closePath(),p.stroke()}else{p.strokeRect(k.ex+c-(s>0?0:q),k.ey+c-(l>0?0:j),q,j)}},_isLastRenderedObject:function(i){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(i,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(i,!0))},findTarget:function(k,i){if(this.skipTargetFind){return}if(this._isLastRenderedObject(k)){return this.lastRenderedObjectWithControlsAboveOverlay}var l=this.getActiveGroup();if(l&&!i&&this.containsPoint(k,l)){return l}var j=this._searchPossibleTargets(k);return this._fireOverOutEvents(j),j},_fireOverOutEvents:function(i){i?this._hoveredTarget!==i&&(this.fire("mouse:over",{target:i}),i.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=i):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(k,i,l){if(i&&i.visible&&i.evented&&this.containsPoint(k,i)){if(!this.perPixelTargetFind&&!i.perPixelTargetFind||!!i.isEditing){return !0}var j=this.isTargetTransparent(i,l.x,l.y);if(!j){return !0}}},_searchPossibleTargets:function(k){var i,l=this.getPointer(k,!0),j=this._objects.length;while(j--){if(this._checkTarget(k,this._objects[j],l)){this.relatedTarget=this._objects[j],i=this._objects[j];break}}return i},getPointer:function(j,p,l){l||(l=this.upperCanvasEl);var e=f(j,l),k=l.getBoundingClientRect(),m;return e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,p||(e=fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))),k.width===0||k.height===0?m={width:1,height:1}:m={width:l.width/k.width,height:l.height/k.height},{x:e.x*m.width,y:e.y*m.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+i),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(j){var i=this.getWidth()||j.width,k=this.getHeight()||j.height;fabric.util.setStyle(j,{position:"absolute",width:i+"px",height:k+"px",left:0,top:0}),j.width=i,j.height=k,fabric.util.makeElementUnselectable(j)},_copyCanvasStyle:function(j,i){i.style.cssText=j.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(i){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=i,i.set("active",!0)},setActiveObject:function(j,i){return this._setActiveObject(j),this.renderAll(),this.fire("object:selected",{target:j,e:i}),j.fire("selected",{e:i}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(i){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:i}),this},_setActiveGroup:function(i){this._activeGroup=i,i&&i.set("active",!0)},setActiveGroup:function(j,i){return this._setActiveGroup(j),j&&(this.fire("object:selected",{target:j,e:i}),j.fire("selected",{e:i})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var i=this.getActiveGroup();i&&i.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(i){return this._discardActiveGroup(),this.fire("selection:cleared",{e:i}),this},deactivateAll:function(){var j=this.getObjects(),i=0,k=j.length;for(;i<k;i++){j[i].set("active",!1)}return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(j){var i=this.getActiveGroup()||this.getActiveObject();return i&&this.fire("before:selection:cleared",{target:i,e:j}),this.deactivateAll(),i&&this.fire("selection:cleared",{e:j}),this},drawControls:function(j){var i=this.getActiveGroup();i?this._drawGroupControls(j,i):this._drawObjectsControls(j)},_drawGroupControls:function(j,i){i._renderControls(j)},_drawObjectsControls:function(j){for(var i=0,k=this._objects.length;i<k;++i){if(!this._objects[i]||!this._objects[i].active){continue}this._objects[i]._renderControls(j),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[i]}}});for(var g in fabric.StaticCanvas){g!=="prototype"&&(fabric.Canvas[g]=fabric.StaticCanvas[g])}fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),a(fabric.window,"resize",this._onResize),a(this.upperCanvasEl,"mousedown",this._onMouseDown),a(this.upperCanvasEl,"mousemove",this._onMouseMove),a(this.upperCanvasEl,"mousewheel",this._onMouseWheel),a(this.upperCanvasEl,"touchstart",this._onMouseDown),a(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof Event!="undefined"&&"add" in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mousewheel",this._onMouseWheel),c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof Event!="undefined"&&"remove" in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(f,d){this.__onTransformGesture&&this.__onTransformGesture(f,d)},_onDrag:function(f,d){this.__onDrag&&this.__onDrag(f,d)},_onMouseWheel:function(f,d){this.__onMouseWheel&&this.__onMouseWheel(f,d)},_onOrientationChange:function(f,d){this.__onOrientationChange&&this.__onOrientationChange(f,d)},_onShake:function(f,d){this.__onShake&&this.__onShake(f,d)},_onMouseDown:function(d){this.__onMouseDown(d),a(fabric.document,"touchend",this._onMouseUp),a(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),d.type==="touchstart"?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(a(fabric.document,"mouseup",this._onMouseUp),a(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(f){this.__onMouseUp(f),c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"touchend",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove),c(fabric.document,"touchmove",this._onMouseMove),a(this.upperCanvasEl,"mousemove",this._onMouseMove),a(this.upperCanvasEl,"touchmove",this._onMouseMove);if(f.type==="touchend"){var d=this;setTimeout(function(){a(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(f,d){var g=this.getActiveGroup()||this.getActiveObject();return !!(f&&(f.isMoving||f!==g)||!f&&!!g||!f&&!g&&!this._groupSelector||d&&this._previousPointer&&this.selection&&(d.x!==this._previousPointer.x||d.y!==this._previousPointer.y))},__onMouseUp:function(f){var d;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(f);return}this._currentTransform?(this._finalizeCurrentTransform(),d=this._currentTransform.target):d=this.findTarget(f,!0);var g=this._shouldRender(d,this.getPointer(f));this._maybeGroupObjects(f),d&&(d.isMoving=!1),g&&this.renderAll(),this._handleCursorAndEvent(f,d)},_handleCursorAndEvent:function(f,d){this._setCursorFromEvent(f,d);var g=this;setTimeout(function(){g._setCursorFromEvent(f,d)},50),this.fire("mouse:up",{target:d,e:f}),d&&d.fire("mouseup",{e:f})},_finalizeCurrentTransform:function(){var f=this._currentTransform,d=f.target;d._scaling&&(d._scaling=!1),d.setCoords(),this.stateful&&d.hasStateChanged()&&(this.fire("object:modified",{target:d}),d.fire("modified")),this._restoreOriginXY(d)},_restoreOriginXY:function(f){if(this._previousOriginX&&this._previousOriginY){var d=f.translateToOriginPoint(f.getCenterPoint(),this._previousOriginX,this._previousOriginY);f.originX=this._previousOriginX,f.originY=this._previousOriginY,f.left=d.x,f.top=d.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(f){this._isCurrentlyDrawing=!0,this.discardActiveObject(f).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var d=fabric.util.invertTransform(this.viewportTransform),g=fabric.util.transformPoint(this.getPointer(f,!0),d);this.freeDrawingBrush.onMouseDown(g),this.fire("mouse:down",{e:f})},_onMouseMoveInDrawingMode:function(f){if(this._isCurrentlyDrawing){var d=fabric.util.invertTransform(this.viewportTransform),g=fabric.util.transformPoint(this.getPointer(f,!0),d);this.freeDrawingBrush.onMouseMove(g)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:f})},_onMouseUpInDrawingMode:function(d){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:d})},__onMouseDown:function(j){var f="which" in j?j.which===1:j.button===1;if(!f&&!fabric.isTouchSupported){return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(j);return}if(this._currentTransform){return}var k=this.findTarget(j),h=this.getPointer(j,!0);this._previousPointer=h;var d=this._shouldRender(k,h),g=this._shouldGroup(j,k);this._shouldClearSelection(j,k)?this._clearSelection(j,k,h):g&&(this._handleGrouping(j,k),k=this.getActiveGroup()),k&&k.selectable&&!g&&(this._beforeTransform(j,k),this._setupCurrentTransform(j,k)),d&&this.renderAll(),this.fire("mouse:down",{target:k,e:j}),k&&k.fire("mousedown",{e:j})},_beforeTransform:function(f,d){var g;this.stateful&&d.saveState(),(g=d._findTargetCorner(this.getPointer(f)))&&this.onBeforeScaleRotate(d),d!==this.getActiveGroup()&&d!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(d,f))},_clearSelection:function(f,d,g){this.deactivateAllWithDispatch(f),d&&d.selectable?this.setActiveObject(d,f):this.selection&&(this._groupSelector={ex:g.x,ey:g.y,top:0,left:0})},_setOriginToCenter:function(f){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var d=f.getCenterPoint();f.originX="center",f.originY="center",f.left=d.x,f.top=d.y,this._currentTransform.left=f.left,this._currentTransform.top=f.top},_setCenterToOrigin:function(f){var d=f.translateToOriginPoint(f.getCenterPoint(),this._previousOriginX,this._previousOriginY);f.originX=this._previousOriginX,f.originY=this._previousOriginY,f.left=d.x,f.top=d.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(g){var d,h;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(g);return}var f=this._groupSelector;f?(h=this.getPointer(g,!0),f.left=h.x-f.ex,f.top=h.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(g):(d=this.findTarget(g),!d||d&&!d.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(g,d)),this.fire("mouse:move",{target:d,e:g}),d&&d.fire("mousemove",{e:g})},_transformObject:function(f){var d=this.getPointer(f),g=this._currentTransform;g.reset=!1,g.target.isMoving=!0,this._beforeScaleTransform(f,g),this._performTransformAction(f,g,d),this.renderAll()},_performTransformAction:function(j,f,l){var h=l.x,d=l.y,g=f.target,k=f.action;k==="rotate"?(this._rotateObject(h,d),this._fire("rotating",g,j)):k==="scale"?(this._onScale(j,f,h,d),this._fire("scaling",g,j)):k==="scaleX"?(this._scaleObject(h,d,"x"),this._fire("scaling",g,j)):k==="scaleY"?(this._scaleObject(h,d,"y"),this._fire("scaling",g,j)):(this._translateObject(h,d),this._fire("moving",g,j),this.setCursor(this.moveCursor))},_fire:function(f,d,g){this.fire("object:"+f,{target:d,e:g}),d.fire(f,{e:g})},_beforeScaleTransform:function(f,d){if(d.action==="scale"||d.action==="scaleX"||d.action==="scaleY"){var g=this._shouldCenterTransform(f,d.target);if(g&&(d.originX!=="center"||d.originY!=="center")||!g&&d.originX==="center"&&d.originY==="center"){this._resetCurrentTransform(f),d.reset=!0}}},_onScale:function(g,d,h,f){(g.shiftKey||this.uniScaleTransform)&&!d.target.get("lockUniScaling")?(d.currentAction="scale",this._scaleObject(h,f)):(!d.reset&&d.currentAction==="scale"&&this._resetCurrentTransform(g,d.target),d.currentAction="scaleEqually",this._scaleObject(h,f,"equally"))},_setCursorFromEvent:function(g,d){if(!d||!d.selectable){return this.setCursor(this.defaultCursor),!1}var h=this.getActiveGroup(),f=d._findTargetCorner&&(!h||!h.contains(d))&&d._findTargetCorner(this.getPointer(g,!0));return f?this._setCornerCursor(f,d):this.setCursor(d.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(d,e){if(d in b){this.setCursor(this._getRotatedCornerCursor(d,e))}else{if(d!=="mtr"||!e.hasRotatingPoint){return this.setCursor(this.defaultCursor),!1}this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(d,f){var e=Math.round(f.getAngle()%360/45);return e<0&&(e+=8),e+=b[d],e%=8,this.cursorMap[e]}})}(),function(){var b=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(d,c){var f=this.getActiveObject();return d.shiftKey&&(this.getActiveGroup()||f&&f!==c)&&this.selection},_handleGrouping:function(d,c){if(c===this.getActiveGroup()){c=this.findTarget(d,!0);if(!c||c.isType("group")){return}}this.getActiveGroup()?this._updateActiveGroup(c,d):this._createActiveGroup(c,d),this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(d,c){var f=this.getActiveGroup();if(f.contains(d)){f.removeWithUpdate(d),this._resetObjectTransform(f),d.set("active",!1);if(f.size()===1){this.discardActiveGroup(c),this.setActiveObject(f.item(0));return}}else{f.addWithUpdate(d),this._resetObjectTransform(f)}this.fire("selection:created",{target:f,e:c}),f.set("active",!0)},_createActiveGroup:function(d,c){if(this._activeObject&&d!==this._activeObject){var f=this._createGroup(d);f.addWithUpdate(),this.setActiveGroup(f),this._activeObject=null,this.fire("selection:created",{target:f,e:c})}d.set("active",!0)},_createGroup:function(f){var c=this.getObjects(),g=c.indexOf(this._activeObject)<c.indexOf(f),d=g?[this._activeObject,f]:[f,this._activeObject];return new fabric.Group(d,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();c.length===1?this.setActiveObject(c[0],d):c.length>1&&(c=new fabric.Group(c.reverse(),{originX:"center",originY:"center",canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,d),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var g=[],d,j=this._groupSelector.ex,t=this._groupSelector.ey,e=j+this._groupSelector.left,q=t+this._groupSelector.top,p=new fabric.Point(b(j,e),b(t,q)),k=new fabric.Point(a(j,e),a(t,q)),h=j===e&&t===q;for(var m=this._objects.length;m--;){d=this._objects[m];if(!d||!d.selectable||!d.visible){continue}if(d.intersectsWithRect(p,k)||d.isContainedWithinRect(p,k)||d.containsPoint(p)||d.containsPoint(k)){d.set("active",!0),g.push(d);if(h){break}}}return g},_maybeGroupObjects:function(d){this.selection&&this._groupSelector&&this._groupSelectedObjects(d);var c=this.getActiveGroup();c&&(c.setObjectsCoords().setCoords(),c.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var b=d.format||"png",f=d.quality||1,c=d.multiplier||1,a={left:d.left,top:d.top,width:d.width,height:d.height};return c!==1?this.__toDataURLWithMultiplier(b,f,a,c):this.__toDataURL(b,f,a)},__toDataURL:function(f,b,g){this.renderAll(!0);var d=this.upperCanvasEl||this.lowerCanvasEl,a=this.__getCroppedCanvas(d,g);f==="jpg"&&(f="jpeg");var c=fabric.StaticCanvas.supports("toDataURLWithQuality")?(a||d).toDataURL("image/"+f,b):(a||d).toDataURL("image/"+f);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),a&&(a=null),c},__getCroppedCanvas:function(d,b){var f,c,a="left" in b||"top" in b||"width" in b||"height" in b;return a&&(f=fabric.util.createCanvasElement(),c=f.getContext("2d"),f.width=b.width||this.width,f.height=b.height||this.height,c.drawImage(d,-b.left||0,-b.top||0)),f},__toDataURLWithMultiplier:function(m,w,g,b){var j=this.getWidth(),x=this.getHeight(),d=j*b,v=x*b,q=this.getActiveObject(),k=this.getActiveGroup(),h=this.contextTop||this.contextContainer;b>1&&this.setWidth(d).setHeight(v),h.scale(b,b),g.left&&(g.left*=b),g.top&&(g.top*=b),g.width?g.width*=b:b<1&&(g.width=d),g.height?g.height*=b:b<1&&(g.height=v),k?this._tempRemoveBordersControlsFromGroup(k):q&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var p=this.__toDataURL(m,w,g);return this.width=j,this.height=x,h.scale(1/b,1/b),this.setWidth(j).setHeight(x),k?this._restoreBordersControlsOnGroup(k):q&&this.setActiveObject&&this.setActiveObject(q),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),p},toDataURLWithMultiplier:function(b,a,c){return this.toDataURL({format:b,multiplier:a,quality:c})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls,a.origBorderColor=a.borderColor,a.hasControls=!0,a.borderColor="rgba(0,0,0,0)",a.forEachObject(function(b){b.origBorderColor=b.borderColor,b.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls,a.borderColor=a.origBorderColor,a.forEachObject(function(b){b.borderColor=b.origBorderColor,delete b.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(b,a,c){return this.loadFromJSON(b,a,c)},loadFromJSON:function(d,b,f){if(!d){return}var c=typeof d=="string"?JSON.parse(d):d;this.clear();var a=this;return this._enlivenObjects(c.objects,function(){a._setBgOverlay(c,b)},f),this},_setBgOverlay:function(d,b){var f=this,c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay){b&&b();return}var a=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&(f.renderAll(),b&&b())};this.__setBgOverlay("backgroundImage",d.backgroundImage,c,a),this.__setBgOverlay("overlayImage",d.overlayImage,c,a),this.__setBgOverlay("backgroundColor",d.background,c,a),this.__setBgOverlay("overlayColor",d.overlay,c,a),a()},__setBgOverlay:function(d,b,f,c){var a=this;if(!b){f[d]=!0;return}d==="backgroundImage"||d==="overlayImage"?fabric.Image.fromObject(b,function(e){a[d]=e,f[d]=!0,c&&c()}):this["set"+fabric.util.string.capitalize(d,!0)](b,function(){f[d]=!0,c&&c()})},_enlivenObjects:function(d,b,f){var c=this;if(!d||d.length===0){b&&b();return}var a=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(d,function(g){g.forEach(function(i,h){c.insertAt(i,h,!0)}),c.renderOnAddRemove=a,b&&b()},null,f)},_toDataURL:function(b,a){this.clone(function(c){a(c.toDataURL(b))})},_toDataURLWithMultiplier:function(b,a,c){this.clone(function(d){c(d.toDataURLWithMultiplier(b,a))})},clone:function(b,a){var c=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(c,function(){b&&b(d)})})},cloneWithoutData:function(b){var a=fabric.document.createElement("canvas");a.width=this.getWidth(),a.height=this.getHeight();var c=new fabric.Canvas(a);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),b&&b(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):b&&b(c)}}),function(f){var b=f.fabric||(f.fabric={}),h=b.util.object.extend,d=b.util.toFixed,a=b.util.string.capitalize,c=b.util.degreesToRadians,g=b.StaticCanvas.supports("setLineDash");if(b.Object){return}b.Object=b.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(i){i&&this.setOptions(i)},_initGradient:function(i){i.fill&&i.fill.colorStops&&!(i.fill instanceof b.Gradient)&&this.set("fill",new b.Gradient(i.fill))},_initPattern:function(i){i.fill&&i.fill.source&&!(i.fill instanceof b.Pattern)&&this.set("fill",new b.Pattern(i.fill)),i.stroke&&i.stroke.source&&!(i.stroke instanceof b.Pattern)&&this.set("stroke",new b.Pattern(i.stroke))},_initClipping:function(i){if(!i.clipTo||typeof i.clipTo!="string"){return}var j=b.util.getFunctionBody(i.clipTo);typeof j!="undefined"&&(this.clipTo=new Function("ctx",j))},setOptions:function(j){for(var i in j){this.set(i,j[i])}this._initGradient(j),this._initPattern(j),this._initClipping(j)},transform:function(j,i){this.group&&this.group.transform(j,i),j.globalAlpha=this.opacity;var k=i?this._getLeftTopCoords():this.getCenterPoint();j.translate(k.x,k.y),j.rotate(c(this.angle)),j.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(k){var l=b.Object.NUM_FRACTION_DIGITS,j={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,l),top:d(this.top,l),width:d(this.width,l),height:d(this.height,l),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,l),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,l),scaleX:d(this.scaleX,l),scaleY:d(this.scaleY,l),angle:d(this.getAngle(),l),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,l),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(j=this._removeDefaultValues(j)),b.util.populateWithProperties(this,j,k),j},toDatalessObject:function(i){return this.toObject(i)},_removeDefaultValues:function(j){var k=b.util.getKlass(j.type).prototype,i=k.stateProperties;return i.forEach(function(e){j[e]===k[e]&&delete j[e]}),j},toString:function(){return"#<fabric."+a(this.type)+">"},get:function(i){return this[i]},_setObject:function(j){for(var i in j){this._set(i,j[i])}},set:function(j,i){return typeof j=="object"?this._setObject(j):typeof i=="function"&&j!=="clipTo"?this._set(j,i(this.get(j))):this._set(j,i),this},_set:function(k,l){var j=k==="scaleX"||k==="scaleY";return j&&(l=this._constrainScale(l)),k==="scaleX"&&l<0?(this.flipX=!this.flipX,l*=-1):k==="scaleY"&&l<0?(this.flipY=!this.flipY,l*=-1):k==="width"||k==="height"?this.minScaleLimit=d(Math.min(0.1,1/Math.max(this.width,this.height)),2):k==="shadow"&&l&&!(l instanceof b.Shadow)&&(l=new b.Shadow(l)),this[k]=l,this},toggle:function(j){var i=this.get(j);return typeof i=="boolean"&&this.set(j,!i),this},setSourcePath:function(i){return this.sourcePath=i,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(j,k){if(this.width===0||this.height===0||!this.visible){return}j.save(),this._setupFillRule(j),this._transform(j,k),this._setStrokeStyles(j),this._setFillStyles(j);var i=this.transformMatrix;i&&this.group&&(j.translate(-this.group.width/2,-this.group.height/2),j.transform(i[0],i[1],i[2],i[3],i[4],i[5])),this._setShadow(j),this.clipTo&&b.util.clipContext(this,j),this._render(j,k),this.clipTo&&j.restore(),this._removeShadow(j),this._restoreFillRule(j),j.restore()},_transform:function(j,i){var k=this.transformMatrix;k&&!this.group&&j.setTransform(k[0],k[1],k[2],k[3],k[4],k[5]),i||this.transform(j)},_setStrokeStyles:function(i){this.stroke&&(i.lineWidth=this.strokeWidth,i.lineCap=this.strokeLineCap,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,i.strokeStyle=this.stroke.toLive?this.stroke.toLive(i):this.stroke)},_setFillStyles:function(i){this.fill&&(i.fillStyle=this.fill.toLive?this.fill.toLive(i):this.fill)},_renderControls:function(l,m){var k=this.getViewportTransform();l.save();if(this.active&&!m){var j;this.group&&(j=b.util.transformPoint(this.group.getCenterPoint(),k),l.translate(j.x,j.y),l.rotate(c(this.group.angle))),j=b.util.transformPoint(this.getCenterPoint(),k,null!=this.group),this.group&&(j.x*=this.group.scaleX,j.y*=this.group.scaleY),l.translate(j.x,j.y),l.rotate(c(this.angle)),this.drawBorders(l),this.drawControls(l)}l.restore()},_setShadow:function(i){if(!this.shadow){return}i.shadowColor=this.shadow.color,i.shadowBlur=this.shadow.blur,i.shadowOffsetX=this.shadow.offsetX,i.shadowOffsetY=this.shadow.offsetY},_removeShadow:function(i){if(!this.shadow){return}i.shadowColor="",i.shadowBlur=i.shadowOffsetX=i.shadowOffsetY=0},_renderFill:function(i){if(!this.fill){return}this.fill.toLive&&(i.save(),i.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),this.fillRule==="destination-over"?i.fill("evenodd"):i.fill(),this.fill.toLive&&i.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i)},_renderStroke:function(i){if(!this.stroke){return}i.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(i.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(i)):this._renderDashedStroke&&this._renderDashedStroke(i),i.stroke()):this._stroke?this._stroke(i):i.stroke(),this._removeShadow(i),i.restore()},clone:function(i,j){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(j),i):new b.Object(this.toObject(j))},cloneAsImage:function(i){var j=this.toDataURL();return b.util.loadImage(j,function(e){i&&i(new b.Image(e))}),this},toDataURL:function(p){p||(p={});var t=b.util.createCanvasElement(),m=this.getBoundingRect();t.width=m.width,t.height=m.height,b.util.wrapElement(t,"div");var k=new b.Canvas(t);p.format==="jpg"&&(p.format="jpeg"),p.format==="jpeg"&&(k.backgroundColor="#fff");var l={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new b.Point(t.width/2,t.height/2),"center","center");var q=this.canvas;k.add(this);var j=k.toDataURL(p);return this.set(l).setCoords(),this.canvas=q,k.dispose(),k=null,j},isType:function(i){return this.type===i},complexity:function(){return 0},toJSON:function(i){return this.toObject(i)},setGradient:function(m,o){o||(o={});var l={colorStops:[]};l.type=o.type||(o.r1||o.r2?"radial":"linear"),l.coords={x1:o.x1,y1:o.y1,x2:o.x2,y2:o.y2};if(o.r1||o.r2){l.coords.r1=o.r1,l.coords.r2=o.r2}for(var j in o.colorStops){var k=new b.Color(o.colorStops[j]);l.colorStops.push({offset:j,color:k.toRgb(),opacity:k.getAlpha()})}return this.set(m,b.Gradient.forObject(this,l))},setPatternFill:function(i){return this.set("fill",new b.Pattern(i))},setShadow:function(i){return this.set("shadow",i?new b.Shadow(i):null)},setColor:function(i){return this.set("fill",i),this},setAngle:function(j){var i=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return i&&this._setOriginToCenter(),this.set("angle",j),i&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(j,i){i=i||this.canvas.getPointer(j);var k=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:i.x-k.x,y:i.y-k.y}},_setupFillRule:function(i){this.fillRule&&(this._prevFillRule=i.globalCompositeOperation,i.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(i){this.fillRule&&this._prevFillRule&&(i.globalCompositeOperation=this._prevFillRule)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,h(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0}(typeof exports!="undefined"?exports:this),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(c,g,e){var b=c.x,d=c.y,f=this.stroke?this.strokeWidth:0;return g==="left"?b=c.x+(this.getWidth()+f*this.scaleX)/2:g==="right"&&(b=c.x-(this.getWidth()+f*this.scaleX)/2),e==="top"?d=c.y+(this.getHeight()+f*this.scaleY)/2:e==="bottom"&&(d=c.y-(this.getHeight()+f*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(b,d),c,a(this.angle))},translateToOriginPoint:function(c,g,e){var b=c.x,d=c.y,f=this.stroke?this.strokeWidth:0;return g==="left"?b=c.x-(this.getWidth()+f*this.scaleX)/2:g==="right"&&(b=c.x+(this.getWidth()+f*this.scaleX)/2),e==="top"?d=c.y-(this.getHeight()+f*this.scaleY)/2:e==="bottom"&&(d=c.y+(this.getHeight()+f*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(b,d),c,a(this.angle))},getCenterPoint:function(){var b=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(b,this.originX,this.originY)},getPointByOrigin:function(c,b){var d=this.getCenterPoint();return this.translateToOriginPoint(d,c,b)},toLocalPoint:function(d,h,f){var c=this.getCenterPoint(),e=this.stroke?this.strokeWidth:0,g,b;return h&&f?(h==="left"?g=c.x-(this.getWidth()+e*this.scaleX)/2:h==="right"?g=c.x+(this.getWidth()+e*this.scaleX)/2:g=c.x,f==="top"?b=c.y-(this.getHeight()+e*this.scaleY)/2:f==="bottom"?b=c.y+(this.getHeight()+e*this.scaleY)/2:b=c.y):(g=this.left,b=this.top),fabric.util.rotatePoint(new fabric.Point(d.x,d.y),c,-a(this.angle)).subtractEquals(new fabric.Point(g,b))},setPositionByOrigin:function(f,c,g){var d=this.translateToCenterPoint(f,c,g),b=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",b.x),this.set("top",b.y)},adjustPosition:function(e){var j=a(this.angle),g=this.getWidth()/2,d=Math.cos(j)*g,f=Math.sin(j)*g,h=this.getWidth(),c=Math.cos(j)*h,b=Math.sin(j)*h;this.originX==="center"&&e==="left"||this.originX==="right"&&e==="center"?(this.left-=d,this.top-=f):this.originX==="left"&&e==="center"||this.originX==="center"&&e==="right"?(this.left+=d,this.top+=f):this.originX==="left"&&e==="right"?(this.left+=c,this.top+=b):this.originX==="right"&&e==="left"&&(this.left-=c,this.top-=b),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var b=this.getCenterPoint();this.originX="center",this.originY="center",this.left=b.x,this.top=b.y},_resetOrigin:function(){var b=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=b.x,this.top=b.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(h,d){var k=this.oCoords,g=new fabric.Point(k.tl.x,k.tl.y),c=new fabric.Point(k.tr.x,k.tr.y),f=new fabric.Point(k.bl.x,k.bl.y),j=new fabric.Point(k.br.x,k.br.y),b=fabric.Intersection.intersectPolygonRectangle([g,c,j,f],h,d);return b.status==="Intersection"},intersectsWithObject:function(f){function c(h){return{tl:new fabric.Point(h.tl.x,h.tl.y),tr:new fabric.Point(h.tr.x,h.tr.y),bl:new fabric.Point(h.bl.x,h.bl.y),br:new fabric.Point(h.br.x,h.br.y)}}var g=c(this.oCoords),d=c(f.oCoords),b=fabric.Intersection.intersectPolygonPolygon([g.tl,g.tr,g.br,g.bl],[d.tl,d.tr,d.br,d.bl]);return b.status==="Intersection"},isContainedWithinObject:function(d){var b=d.getBoundingRect(),f=new fabric.Point(b.left,b.top),c=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(f,c)},isContainedWithinRect:function(c,b){var d=this.getBoundingRect();return d.left>=c.x&&d.left+d.width<=b.x&&d.top>=c.y&&d.top+d.height<=b.y},containsPoint:function(c){var b=this._getImageLines(this.oCoords),d=this._findCrossPoints(c,b);return d!==0&&d%2===1},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(k,q){var d,b,h,v,c,p,m=0,j;for(var g in q){j=q[g];if(j.o.y<k.y&&j.d.y<k.y){continue}if(j.o.y>=k.y&&j.d.y>=k.y){continue}j.o.x===j.d.x&&j.o.x>=k.x?(c=j.o.x,p=k.y):(d=0,b=(j.d.y-j.o.y)/(j.d.x-j.o.x),h=k.y-d*k.x,v=j.o.y-b*j.o.x,c=-(h-v)/(d-b),p=h+d*c),c>=k.x&&(m+=1);if(m===2){break}}return m},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var h=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],d=fabric.util.array.min(h),k=fabric.util.array.max(h),g=Math.abs(d-k),c=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],f=fabric.util.array.min(c),j=fabric.util.array.max(c),b=Math.abs(f-j);return{left:d,top:f,width:g,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(b){return Math.abs(b)<this.minScaleLimit?b<0?-this.minScaleLimit:this.minScaleLimit:b},scale:function(b){return b=this._constrainScale(b),b<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,b*=-1),this.scaleX=b,this.scaleY=b,this.setCoords(),this},scaleToWidth:function(c){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/b)},scaleToHeight:function(c){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/b)},setCoords:function(){var H=this.strokeWidth>1?this.strokeWidth:0,O=a(this.angle),K=this.getViewportTransform(),U=function(b){return fabric.util.transformPoint(b,K)};this.currentWidth=(this.width+H)*this.scaleX,this.currentHeight=(this.height+H)*this.scaleY,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var I=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),M=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),F=Math.cos(M+O)*I,ab=Math.sin(M+O)*I,X=Math.sin(O),Q=Math.cos(O),Z=this.getCenterPoint(),V=new fabric.Point(this.currentWidth,this.currentHeight),L=new fabric.Point(Z.x-F,Z.y-ab),Y=new fabric.Point(L.x+V.x*Q,L.y+V.x*X),D=new fabric.Point(L.x-V.y*X,L.y+V.y*Q),P=new fabric.Point(L.x+V.x/2*Q,L.y+V.x/2*X),W=U(L),z=U(Y),aa=U(new fabric.Point(Y.x-V.y*X,Y.y+V.y*Q)),B=U(D),G=U(new fabric.Point(L.x-V.y/2*X,L.y+V.y/2*Q)),j=U(P),A=U(new fabric.Point(Y.x-V.y/2*X,Y.y+V.y/2*Q)),e=U(new fabric.Point(D.x+V.x/2*Q,D.y+V.x/2*X)),q=U(new fabric.Point(P.x,P.y)),J=Math.cos(M+O)*this.padding*Math.sqrt(2),R=Math.sin(M+O)*this.padding*Math.sqrt(2);return W=W.add(new fabric.Point(-J,-R)),z=z.add(new fabric.Point(R,-J)),aa=aa.add(new fabric.Point(J,R)),B=B.add(new fabric.Point(-R,J)),G=G.add(new fabric.Point((-J-R)/2,(-R+J)/2)),j=j.add(new fabric.Point((R-J)/2,-(R+J)/2)),A=A.add(new fabric.Point((R+J)/2,(R-J)/2)),e=e.add(new fabric.Point((J-R)/2,(J+R)/2)),q=q.add(new fabric.Point((R-J)/2,-(R+J)/2)),this.oCoords={tl:W,tr:z,br:aa,bl:B,ml:G,mt:j,mr:A,mb:e,mtr:q},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var j=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",m=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",d=this.strokeWidth?this.strokeWidth:"0",b=this.strokeDashArray?this.strokeDashArray.join(" "):"",g=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=typeof this.opacity!="undefined"?this.opacity:"1",k=this.visible?"":" visibility: hidden;",h=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",m,"; ","stroke-width: ",d,"; ","stroke-dasharray: ",b,"; ","stroke-linecap: ",g,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",c,"; ","fill: ",j,"; ","opacity: ",l,";",h,k].join("")},getSvgTransform:function(){var j=fabric.util.toFixed,m=this.getAngle(),d=this.getViewportTransform(),b=fabric.util.transformPoint(this.getCenterPoint(),d),g=fabric.Object.NUM_FRACTION_DIGITS,p="translate("+j(b.x,g)+" "+j(b.y,g)+")",c=m!==0?" rotate("+j(m,g)+")":"",l=this.scaleX===1&&this.scaleY===1&&d[0]===1&&d[3]===1?"":" scale("+j(this.scaleX*d[0],g)+" "+j(this.scaleY*d[3],g)+")",k=this.flipX?"matrix(-1 0 0 1 0 0) ":"",h=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[p,c,l,k,h].join("")},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){return this.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this),a&&a.stateProperties&&a.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var b=fabric.util.degreesToRadians,a=function(){return typeof G_vmlCanvasManager!="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(h){if(!this.hasControls||!this.active){return !1}var d=h.x,j=h.y,g,c;for(var f in this.oCoords){if(!this.isControlVisible(f)){continue}if(f==="mtr"&&!this.hasRotatingPoint){continue}if(!(!this.get("lockUniScaling")||f!=="mt"&&f!=="mr"&&f!=="mb"&&f!=="ml")){continue}c=this._getImageLines(this.oCoords[f].corner),g=this._findCrossPoints({x:d,y:j},c);if(g!==0&&g%2===1){return this.__corner=f,f}}return !1},_setCornerCoords:function(){var f=this.oCoords,k=b(this.angle),h=b(45-this.angle),e=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,g=e*Math.cos(h),j=e*Math.sin(h),d=Math.sin(k),c=Math.cos(k);f.tl.corner={tl:{x:f.tl.x-j,y:f.tl.y-g},tr:{x:f.tl.x+g,y:f.tl.y-j},bl:{x:f.tl.x-g,y:f.tl.y+j},br:{x:f.tl.x+j,y:f.tl.y+g}},f.tr.corner={tl:{x:f.tr.x-j,y:f.tr.y-g},tr:{x:f.tr.x+g,y:f.tr.y-j},br:{x:f.tr.x+j,y:f.tr.y+g},bl:{x:f.tr.x-g,y:f.tr.y+j}},f.bl.corner={tl:{x:f.bl.x-j,y:f.bl.y-g},bl:{x:f.bl.x-g,y:f.bl.y+j},br:{x:f.bl.x+j,y:f.bl.y+g},tr:{x:f.bl.x+g,y:f.bl.y-j}},f.br.corner={tr:{x:f.br.x+g,y:f.br.y-j},bl:{x:f.br.x-g,y:f.br.y+j},br:{x:f.br.x+j,y:f.br.y+g},tl:{x:f.br.x-j,y:f.br.y-g}},f.ml.corner={tl:{x:f.ml.x-j,y:f.ml.y-g},tr:{x:f.ml.x+g,y:f.ml.y-j},bl:{x:f.ml.x-g,y:f.ml.y+j},br:{x:f.ml.x+j,y:f.ml.y+g}},f.mt.corner={tl:{x:f.mt.x-j,y:f.mt.y-g},tr:{x:f.mt.x+g,y:f.mt.y-j},bl:{x:f.mt.x-g,y:f.mt.y+j},br:{x:f.mt.x+j,y:f.mt.y+g}},f.mr.corner={tl:{x:f.mr.x-j,y:f.mr.y-g},tr:{x:f.mr.x+g,y:f.mr.y-j},bl:{x:f.mr.x-g,y:f.mr.y+j},br:{x:f.mr.x+j,y:f.mr.y+g}},f.mb.corner={tl:{x:f.mb.x-j,y:f.mb.y-g},tr:{x:f.mb.x+g,y:f.mb.y-j},bl:{x:f.mb.x-g,y:f.mb.y+j},br:{x:f.mb.x+j,y:f.mb.y+g}},f.mtr.corner={tl:{x:f.mtr.x-j+d*this.rotatingPointOffset,y:f.mtr.y-g-c*this.rotatingPointOffset},tr:{x:f.mtr.x+g+d*this.rotatingPointOffset,y:f.mtr.y-j-c*this.rotatingPointOffset},bl:{x:f.mtr.x-g+d*this.rotatingPointOffset,y:f.mtr.y+j-c*this.rotatingPointOffset},br:{x:f.mtr.x+j+d*this.rotatingPointOffset,y:f.mtr.y+g-c*this.rotatingPointOffset}}},drawBorders:function(x){if(!this.hasBorders){return this}var B=this.padding,k=B*2,d=~~(this.strokeWidth/2)*2;x.save(),x.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,x.strokeStyle=this.borderColor;var q=1/this._constrainScale(this.scaleX),C=1/this._constrainScale(this.scaleY);x.lineWidth=1/this.borderScaleFactor;var j=this.getViewportTransform(),A=fabric.util.transformPoint(new fabric.Point(this.getWidth(),this.getHeight()),j,!0),z=fabric.util.transformPoint(new fabric.Point(q,C),j,!0),w=A.x,m=A.y,y=z.x,v=z.y;this.group&&(w*=this.group.scaleX,m*=this.group.scaleY),x.strokeRect(~~(-(w/2)-B-d/2*y)-0.5,~~(-(m/2)-B-d/2*v)-0.5,~~(w+k+d*y)+1,~~(m+k+d*v)+1);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var g=(this.flipY?m+d*y+B*2:-m-d*v-B*2)/2;x.beginPath(),x.moveTo(0,g),x.lineTo(0,g+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),x.closePath(),x.stroke()}return x.restore(),this},drawControls:function(v){if(!this.hasControls){return this}var z=this.cornerSize,j=z/2,d=~~(this.strokeWidth/2),m=fabric.util.transformPoint(new fabric.Point(this.getWidth(),this.getHeight()),this.getViewportTransform(),!0),A=m.x,g=m.y,y=-(A/2),x=-(g/2),q=this.padding,k=j,w=j-z,p=this.transparentCorners?"strokeRect":"fillRect";return v.save(),v.lineWidth=1,v.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,v.strokeStyle=v.fillStyle=this.cornerColor,this._drawControl("tl",v,p,y-k-d-q,x-k-d-q),this._drawControl("tr",v,p,y+A-k+d+q,x-k-d-q),this._drawControl("bl",v,p,y-k-d-q,x+g+w+d+q),this._drawControl("br",v,p,y+A+w+d+q,x+g+w+d+q),this.get("lockUniScaling")||(this._drawControl("mt",v,p,y+A/2-k,x-k-d-q),this._drawControl("mb",v,p,y+A/2-k,x+g+w+d+q),this._drawControl("mr",v,p,y+A+w+d+q,x+g/2-k),this._drawControl("ml",v,p,y-k-d-q,x+g/2-k)),this.hasRotatingPoint&&this._drawControl("mtr",v,p,y+A/2-k,this.flipY?x+g+this.rotatingPointOffset-this.cornerSize/2+d+q:x-this.rotatingPointOffset-this.cornerSize/2-d-q),v.restore(),this},_drawControl:function(g,j,f,c,d){var h=this.cornerSize;this.isControlVisible(g)&&(a()||this.transparentCorners||j.clearRect(c,d,h,h),j[f](c,d,h,h))},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(d,c){return this._getControlsVisibility()[d]=c,this},setControlsVisibility:function(d){d||(d={});for(var c in d){this.setControlVisible(c,d[c])}return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(f,b){b=b||{};var g=function(){},d=b.onComplete||g,a=b.onChange||g,c=this;return fabric.util.animate({startValue:f.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){f.set("left",e),c.renderAll(),a()},onComplete:function(){f.setCoords(),d()}}),this},fxCenterObjectV:function(f,b){b=b||{};var g=function(){},d=b.onComplete||g,a=b.onChange||g,c=this;return fabric.util.animate({startValue:f.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){f.set("top",e),c.renderAll(),a()},onComplete:function(){f.setCoords(),d()}}),this},fxRemove:function(f,b){b=b||{};var g=function(){},d=b.onComplete||g,a=b.onChange||g,c=this;return fabric.util.animate({startValue:f.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){f.set("active",!1)},onChange:function(e){f.set("opacity",e),c.renderAll(),a()},onComplete:function(){c.remove(f),d()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var d=[],b,f;for(b in arguments[0]){d.push(b)}for(var c=0,a=d.length;c<a;c++){b=d[c],f=c!==a-1,this._animate(b,arguments[0][b],arguments[1],f)}}else{this._animate.apply(this,arguments)}return this},_animate:function(f,b,h,d){var a=this,c;b=b.toString(),h?h=fabric.util.object.clone(h):h={},~f.indexOf(".")&&(c=f.split("."));var g=c?this.get(c[0])[c[1]]:this.get(f);"from" in h||(h.from=g),~b.indexOf("=")?b=g+parseFloat(b.replace("=","")):b=parseFloat(b),fabric.util.animate({startValue:h.from,endValue:b,byValue:h.by,easing:h.easing,duration:h.duration,abort:h.abort&&function(){return h.abort.call(a)},onChange:function(e){c?a[c[0]][c[1]]=e:a.set(f,e);if(d){return}h.onChange&&h.onChange()},onComplete:function(){if(d){return}a.setCoords(),h.onComplete&&h.onComplete()}})}}),function(f){function c(m,v){var k=m.origin,h=m.axis1,l=m.axis2,w=m.dimension,j=v.nearest,q=v.center,p=v.farthest;return function(){switch(this.get(k)){case j:return Math.min(this.get(h),this.get(l));case q:return Math.min(this.get(h),this.get(l))+0.5*this.get(w);case p:return Math.max(this.get(h),this.get(l))}}}var b=f.fabric||(f.fabric={}),g=b.util.object.extend,d={x1:1,x2:1,y1:1,y2:1},a=b.StaticCanvas.supports("setLineDash");if(b.Line){b.warn("fabric.Line is already defined");return}b.Line=b.util.createClass(b.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(i,h){h=h||{},i||(i=[0,0,0,0]),this.callSuper("initialize",h),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(h)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1)||1,this.height=Math.abs(this.y2-this.y1)||1,this.left="left" in h?h.left:this._getLeftToOriginX(),this.top="top" in h?h.top:this._getTopToOriginY()},_set:function(i,h){return this[i]=h,typeof d[i]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(k){k.beginPath();var h=this.group&&this.group.type==="path-group";if(h&&!this.transformMatrix){var m=this.getCenterPoint();k.translate(-this.group.width/2+m.x,-this.group.height/2+m.y)}if(!this.strokeDashArray||this.strokeDashArray&&a){var j=this.x1<=this.x2?-1:1,i=this.y1<=this.y2?-1:1;k.moveTo(this.width===1?0:j*this.width/2,this.height===1?0:i*this.height/2),k.lineTo(this.width===1?0:j*-1*this.width/2,this.height===1?0:i*-1*this.height/2)}k.lineWidth=this.strokeWidth;var l=k.strokeStyle;k.strokeStyle=this.stroke||k.fillStyle,this.stroke&&this._renderStroke(k),k.strokeStyle=l},_renderDashedStroke:function(l){var m=this.x1<=this.x2?-1:1,k=this.y1<=this.y2?-1:1,h=this.width===1?0:m*this.width/2,j=this.height===1?0:k*this.height/2;l.beginPath(),b.util.drawDashedLine(l,h,j,-h,-j,this.strokeDashArray),l.closePath()},toObject:function(h){return g(this.callSuper("toObject",h),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(i){var h=this._createBaseSVGMarkup();return h.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),i?i(h.join("")):h.join("")},complexity:function(){return 1}}),b.Line.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),b.Line.fromElement=function(l,k){var h=b.parseAttributes(l,b.Line.ATTRIBUTE_NAMES),j=[h.x1||0,h.y1||0,h.x2||0,h.y2||0];return new b.Line(j,g(h,k))},b.Line.fromObject=function(h){var i=[h.x1,h.y1,h.x2,h.y2];return new b.Line(i,h)}}(typeof exports!="undefined"?exports:this),function(d){function b(g){return"radius" in g&&g.radius>0}var a=d.fabric||(d.fabric={}),f=Math.PI*2,c=a.util.object.extend;if(a.Circle){a.warn("fabric.Circle is already defined.");return}a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,initialize:function(g){g=g||{},this.set("radius",g.radius||0),this.callSuper("initialize",g)},_set:function(h,g){return this.callSuper("_set",h,g),h==="radius"&&this.setRadius(g),this},toObject:function(g){return c(this.callSuper("toObject",g),{radius:this.get("radius")})},toSVG:function(h){var g=this._createBaseSVGMarkup();return g.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),h?h(g.join("")):g.join("")},_render:function(h,g){h.beginPath(),h.globalAlpha=this.group?h.globalAlpha*this.opacity:this.opacity,h.arc(g?this.left:0,g?this.top:0,this.radius,0,f,!1),this._renderFill(h),this.stroke&&this._renderStroke(h)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(g){this.radius=g,this.set("width",g*2).set("height",g*2)},complexity:function(){return 1}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(h,j){j||(j={});var g=a.parseAttributes(h,a.Circle.ATTRIBUTE_NAMES);if(!b(g)){throw new Error("value of `r` attribute is required and can not be negative")}"left" in g||(g.left=0),"top" in g||(g.top=0),"transformMatrix" in g||(g.left-=j.width/2,g.top-=j.height/2);var i=new a.Circle(c(g,j));return i.cx=parseFloat(h.getAttribute("cx"))||0,i.cy=parseFloat(h.getAttribute("cy"))||0,i},a.Circle.fromObject=function(g){return new a.Circle(g)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={});if(a.Triangle){a.warn("fabric.Triangle is already defined");return}a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(c){c=c||{},this.callSuper("initialize",c),this.set("width",c.width||100).set("height",c.height||100)},_render:function(d){var c=this.width/2,f=this.height/2;d.beginPath(),d.moveTo(-c,f),d.lineTo(0,-f),d.lineTo(c,f),d.closePath(),this._renderFill(d),this._renderStroke(d)},_renderDashedStroke:function(d){var f=this.width/2,c=this.height/2;d.beginPath(),a.util.drawDashedLine(d,-f,c,0,-c,this.strokeDashArray),a.util.drawDashedLine(d,0,-c,f,c,this.strokeDashArray),a.util.drawDashedLine(d,f,c,-f,c,this.strokeDashArray),d.closePath()},toSVG:function(g){var d=this._createBaseSVGMarkup(),h=this.width/2,f=this.height/2,c=[-h+" "+f,"0 "+-f,h+" "+f].join(",");return d.push("<polygon ",'points="',c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),g?g(d.join("")):d.join("")},complexity:function(){return 1}}),a.Triangle.fromObject=function(c){return new a.Triangle(c)}}(typeof exports!="undefined"?exports:this),function(c){var a=c.fabric||(c.fabric={}),d=Math.PI*2,b=a.util.object.extend;if(a.Ellipse){a.warn("fabric.Ellipse is already defined.");return}a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(f){f=f||{},this.callSuper("initialize",f),this.set("rx",f.rx||0),this.set("ry",f.ry||0),this.set("width",this.get("rx")*2),this.set("height",this.get("ry")*2)},toObject:function(f){return b(this.callSuper("toObject",f),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(g){var f=this._createBaseSVGMarkup();return f.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),g?g(f.join("")):f.join("")},render:function(g,f){if(this.rx===0||this.ry===0){return}return this.callSuper("render",g,f)},_render:function(g,f){g.beginPath(),g.save(),g.globalAlpha=this.group?g.globalAlpha*this.opacity:this.opacity,g.transform(1,0,0,this.ry/this.rx,0,0),g.arc(f?this.left:0,f?this.top*this.rx/this.ry:0,this.rx,0,d,!1),this._renderFill(g),this._renderStroke(g),g.restore()},complexity:function(){return 1}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),a.Ellipse.fromElement=function(h,j){j||(j={});var f=a.parseAttributes(h,a.Ellipse.ATTRIBUTE_NAMES);"left" in f||(f.left=0),"top" in f||(f.top=0),"transformMatrix" in f||(f.left-=j.width/2,f.top-=j.height/2);var g=new a.Ellipse(b(f,j));return g.cx=parseFloat(h.getAttribute("cx"))||0,g.cy=parseFloat(h.getAttribute("cy"))||0,g},a.Ellipse.fromObject=function(f){return new a.Ellipse(f)}}(typeof exports!="undefined"?exports:this),function(d){function b(g){return g.left=g.left||0,g.top=g.top||0,g}var a=d.fabric||(d.fabric={}),f=a.util.object.extend;if(a.Rect){console.warn("fabric.Rect is already defined");return}var c=a.Object.prototype.stateProperties.concat();c.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,{stateProperties:c,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(g){g=g||{},this.callSuper("initialize",g),this._initRxRy(),this.x=g.x||0,this.y=g.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(m){if(this.width===1&&this.height===1){m.fillRect(0,0,1,1);return}var v=this.rx?Math.min(this.rx,this.width/2):0,j=this.ry?Math.min(this.ry,this.height/2):0,g=this.width,k=this.height,w=-g/2,h=-k/2,q=this.group&&this.group.type==="path-group",p=v!==0||j!==0,l=0.4477152502;m.beginPath(),m.globalAlpha=q?m.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&q&&m.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&q&&m.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),m.moveTo(w+v,h),m.lineTo(w+g-v,h),p&&m.bezierCurveTo(w+g-l*v,h,w+g,h+l*j,w+g,h+j),m.lineTo(w+g,h+k-j),p&&m.bezierCurveTo(w+g,h+k-l*j,w+g-l*v,h+k,w+g-v,h+k),m.lineTo(w+v,h+k),p&&m.bezierCurveTo(w+l*v,h+k,w,h+k-l*j,w,h+k-j),m.lineTo(w,h+j),p&&m.bezierCurveTo(w,h+l*j,w+l*v,h,w+v,h),m.closePath(),this._renderFill(m),this._renderStroke(m)},_renderDashedStroke:function(k){var l=-this.width/2,j=-this.height/2,g=this.width,h=this.height;k.beginPath(),a.util.drawDashedLine(k,l,j,l+g,j,this.strokeDashArray),a.util.drawDashedLine(k,l+g,j,l+g,j+h,this.strokeDashArray),a.util.drawDashedLine(k,l+g,j+h,l,j+h,this.strokeDashArray),a.util.drawDashedLine(k,l,j+h,l,j,this.strokeDashArray),k.closePath()},_normalizeLeftTopProperties:function(g){return"left" in g&&this.set("left",g.left+this.getWidth()/2),this.set("x",g.left||0),"top" in g&&this.set("top",g.top+this.getHeight()/2),this.set("y",g.top||0),this},toObject:function(h){var g=f(this.callSuper("toObject",h),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});return this.includeDefaultValues||this._removeDefaultValues(g),g},toSVG:function(h){var g=this._createBaseSVGMarkup();return g.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),h?h(g.join("")):g.join("")},complexity:function(){return 1}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(i,h){if(!i){return null}var g=a.parseAttributes(i,a.Rect.ATTRIBUTE_NAMES);g=b(g);var j=new a.Rect(f(h?a.util.object.clone(h):{},g));return j._normalizeLeftTopProperties(g),j},a.Rect.fromObject=function(g){return new a.Rect(g)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.toFixed;if(a.Polyline){a.warn("fabric.Polyline is already defined");return}a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,initialize:function(f,d,g){d=d||{},this.set("points",f),this.callSuper("initialize",d),this._calcDimensions(g)},_calcDimensions:function(d){return a.Polygon.prototype._calcDimensions.call(this,d)},toObject:function(d){return a.Polygon.prototype.toObject.call(this,d)},toSVG:function(j){var f=[],h=this._createBaseSVGMarkup();for(var d=0,g=this.points.length;d<g;d++){f.push(c(this.points[d].x,2),",",c(this.points[d].y,2)," ")}return h.push("<polyline ",'points="',f.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),j?j(h.join("")):h.join("")},_render:function(g){var d;g.beginPath(),g.moveTo(this.points[0].x,this.points[0].y);for(var h=0,f=this.points.length;h<f;h++){d=this.points[h],g.lineTo(d.x,d.y)}this._renderFill(g),this._renderStroke(g)},_renderDashedStroke:function(h){var j,g;h.beginPath();for(var d=0,f=this.points.length;d<f;d++){j=this.points[d],g=this.points[d+1]||j,a.util.drawDashedLine(h,j.x,j.y,g.x,g.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElement=function(g,h){if(!g){return null}h||(h={});var f=a.parsePointsAttribute(g.getAttribute("points")),d=a.parseAttributes(g,a.Polyline.ATTRIBUTE_NAMES);return a.util.normalizePoints(f,h),new a.Polyline(f,a.util.object.extend(d,h),!0)},a.Polyline.fromObject=function(d){var f=d.points;return new a.Polyline(f,d,!0)}}(typeof exports!="undefined"?exports:this),function(f){var b=f.fabric||(f.fabric={}),g=b.util.object.extend,d=b.util.array.min,a=b.util.array.max,c=b.util.toFixed;if(b.Polygon){b.warn("fabric.Polygon is already defined");return}b.Polygon=b.util.createClass(b.Object,{type:"polygon",points:null,initialize:function(i,h,j){h=h||{},this.points=i,this.callSuper("initialize",h),this._calcDimensions(j)},_calcDimensions:function(m){var j=this.points,q=d(j,"x"),k=d(j,"y"),p=a(j,"x"),i=a(j,"y");this.width=p-q||1,this.height=i-k||1,this.minX=q,this.minY=k;if(m){return}var h=this.width/2+this.minX,l=this.height/2+this.minY;this.points.forEach(function(n){n.x-=h,n.y-=l},this)},toObject:function(h){return g(this.callSuper("toObject",h),{points:this.points.concat()})},toSVG:function(l){var j=[],m=this._createBaseSVGMarkup();for(var k=0,h=this.points.length;k<h;k++){j.push(c(this.points[k].x,2),",",c(this.points[k].y,2)," ")}return m.push("<polygon ",'points="',j.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),l?l(m.join("")):m.join("")},_render:function(j){var h;j.beginPath(),j.globalAlpha=this.group?j.globalAlpha*this.opacity:this.opacity,j.moveTo(this.points[0].x,this.points[0].y);for(var k=0,i=this.points.length;k<i;k++){h=this.points[k],j.lineTo(h.x,h.y)}this._renderFill(j);if(this.stroke||this.strokeDashArray){j.closePath(),this._renderStroke(j)}},_renderDashedStroke:function(l){var m,k;l.beginPath();for(var h=0,j=this.points.length;h<j;h++){m=this.points[h],k=this.points[h+1]||this.points[0],b.util.drawDashedLine(l,m.x,m.y,k.x,k.y,this.strokeDashArray)}l.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(l,k){if(!l){return null}k||(k={});var h=b.parsePointsAttribute(l.getAttribute("points")),j=b.parseAttributes(l,b.Polygon.ATTRIBUTE_NAMES);return b.util.normalizePoints(h,k),new b.Polygon(h,g(j,k),!0)},b.Polygon.fromObject=function(h){return new b.Polygon(h.points,h,!0)}}(typeof exports!="undefined"?exports:this),function(k){function j(a){return a[0]==="H"?a[1]:a[a.length-2]}function g(a){return a[0]==="V"?a[1]:a[a.length-1]}var q=k.fabric||(k.fabric={}),d=q.util.array.min,b=q.util.array.max,h=q.util.object.extend,v=Object.prototype.toString,c=q.util.drawArc,p={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m={m:"l",M:"L"};if(q.Path){q.warn("fabric.Path is already defined");return}q.Path=q.util.createClass(q.Object,{type:"path",path:null,initialize:function(f,a){a=a||{},this.setOptions(a);if(!f){throw new Error("`path` argument is required")}var i=v.call(f)==="[object Array]";this.path=i?f:f.match&&f.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}i||(this.path=this._parsePath()),this._initializePath(a),a.sourcePath&&this.setSourcePath(a.sourcePath)},_initializePath:function(w){var f="width" in w&&w.width!=null,y="height" in w&&w.width!=null,l="left" in w,i="top" in w,x=l?this.left:0,a=i?this.top:0;!f||!y?(h(this,this._parseDimensions()),f&&(this.width=w.width),y&&(this.height=w.height)):(i||(this.top=this.height/2),l||(this.left=this.width/2)),this.pathOffset=this.pathOffset||this._calculatePathOffset(x,a)},_calculatePathOffset:function(f,a){return{x:this.left-f-this.width/2,y:this.top-a-this.height/2}},_render:function(E){var K,x=null,o=0,A=0,L=0,J=0,H=0,D=0,z,G,B,w,F=-(this.width/2+this.pathOffset.x),I=-(this.height/2+this.pathOffset.y);for(var y=0,C=this.path.length;y<C;++y){K=this.path[y];switch(K[0]){case"l":L+=K[1],J+=K[2],E.lineTo(L+F,J+I);break;case"L":L=K[1],J=K[2],E.lineTo(L+F,J+I);break;case"h":L+=K[1],E.lineTo(L+F,J+I);break;case"H":L=K[1],E.lineTo(L+F,J+I);break;case"v":J+=K[1],E.lineTo(L+F,J+I);break;case"V":J=K[1],E.lineTo(L+F,J+I);break;case"m":L+=K[1],J+=K[2],o=L,A=J,E.moveTo(L+F,J+I);break;case"M":L=K[1],J=K[2],o=L,A=J,E.moveTo(L+F,J+I);break;case"c":z=L+K[5],G=J+K[6],H=L+K[3],D=J+K[4],E.bezierCurveTo(L+K[1]+F,J+K[2]+I,H+F,D+I,z+F,G+I),L=z,J=G;break;case"C":L=K[5],J=K[6],H=K[3],D=K[4],E.bezierCurveTo(K[1]+F,K[2]+I,H+F,D+I,L+F,J+I);break;case"s":z=L+K[3],G=J+K[4],H=H?2*L-H:L,D=D?2*J-D:J,E.bezierCurveTo(H+F,D+I,L+K[1]+F,J+K[2]+I,z+F,G+I),H=L+K[1],D=J+K[2],L=z,J=G;break;case"S":z=K[3],G=K[4],H=2*L-H,D=2*J-D,E.bezierCurveTo(H+F,D+I,K[1]+F,K[2]+I,z+F,G+I),L=z,J=G,H=K[1],D=K[2];break;case"q":z=L+K[3],G=J+K[4],H=L+K[1],D=J+K[2],E.quadraticCurveTo(H+F,D+I,z+F,G+I),L=z,J=G;break;case"Q":z=K[3],G=K[4],E.quadraticCurveTo(K[1]+F,K[2]+I,z+F,G+I),L=z,J=G,H=K[1],D=K[2];break;case"t":z=L+K[1],G=J+K[2],x[0].match(/[QqTt]/)===null?(H=L,D=J):x[0]==="t"?(H=2*L-B,D=2*J-w):x[0]==="q"&&(H=2*L-H,D=2*J-D),B=H,w=D,E.quadraticCurveTo(H+F,D+I,z+F,G+I),L=z,J=G,H=L+K[1],D=J+K[2];break;case"T":z=K[1],G=K[2],H=2*L-H,D=2*J-D,E.quadraticCurveTo(H+F,D+I,z+F,G+I),L=z,J=G;break;case"a":c(E,L+F,J+I,[K[1],K[2],K[3],K[4],K[5],K[6]+L+F,K[7]+J+I]),L+=K[6],J+=K[7];break;case"A":c(E,L+F,J+I,[K[1],K[2],K[3],K[4],K[5],K[6]+F,K[7]+I]),L=K[6],J=K[7];break;case"z":case"Z":L=o,J=A,E.closePath()}x=K}},render:function(f,i){if(!this.visible){return}f.save();var a=this.transformMatrix;a&&f.transform(a[0],a[1],a[2],a[3],a[4],a[5]),i||this.transform(f),this._setStrokeStyles(f),this._setFillStyles(f),this._setShadow(f),this.clipTo&&q.util.clipContext(this,f),f.beginPath(),f.globalAlpha=this.group?f.globalAlpha*this.opacity:this.opacity,this._render(f),this._renderFill(f),this._renderStroke(f),this.clipTo&&f.restore(),this._removeShadow(f),f.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){var a=h(this.callSuper("toObject",f),{path:this.path.map(function(i){return i.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(a.sourcePath=this.sourcePath),this.transformMatrix&&(a.transformMatrix=this.transformMatrix),a},toDatalessObject:function(f){var a=this.toObject(f);return this.sourcePath&&(a.path=this.sourcePath),delete a.sourcePath,a},toSVG:function(u){var f=[],w=this._createBaseSVGMarkup();for(var o=0,a=this.path.length;o<a;o++){f.push(this.path[o].join(" "))}var l=f.join(" ");return w.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',l,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>"),u?u(w.join("")):w.join("")},complexity:function(){return this.path.length},_parsePath:function(){var F=[],K=[],x,a,B=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,L,w;for(var E=0,A,H=this.path.length;E<H;E++){x=this.path[E],w=x.slice(1).trim(),K.length=0;while(L=B.exec(w)){K.push(L[0])}A=[x.charAt(0)];for(var C=0,u=K.length;C<u;C++){a=parseFloat(K[C]),isNaN(a)||A.push(a)}var G=A[0],J=p[G.toLowerCase()],z=m[G]||G;if(A.length-1>J){for(var D=1,I=A.length;D<I;D+=J){F.push([G].concat(A.slice(D,D+J))),G=z}}else{F.push(A)}}return F},_parseDimensions:function(){var y=[],C=[],w={};this.path.forEach(function(e,a){this._getCoordsFromCommand(e,a,y,C,w)},this);var D=d(y),n=d(C),B=b(y),A=b(C),x=B-D,r=A-n,z={left:this.left+(D+x/2),top:this.top+(n+r/2),width:x,height:r};return z},_getCoordsFromCommand:function(y,l,A,x,f){var w=!1;y[0]!=="H"&&(f.x=l===0?j(y):j(this.path[l-1])),y[0]!=="V"&&(f.y=l===0?g(y):g(this.path[l-1])),y[0]===y[0].toLowerCase()&&(w=!0);var z=this._getXY(y,w,f),a;a=parseInt(z.x,10),isNaN(a)||A.push(a),a=parseInt(z.y,10),isNaN(a)||x.push(a)},_getXY:function(o,f,s){var l=f?s.x+j(o):o[0]==="V"?s.x:j(o),a=f?s.y+g(o):o[0]==="H"?s.y:g(o);return{x:l,y:a}}}),q.Path.fromObject=function(a,f){typeof a.path=="string"?q.loadSVGFromURL(a.path,function(n){var e=n[0],l=a.path;delete a.path,q.util.object.extend(e,a),e.setSourcePath(l),f(e)}):f(new q.Path(a.path,a))},q.Path.ATTRIBUTE_NAMES=q.SHARED_ATTRIBUTES.concat(["d"]),q.Path.fromElement=function(i,l,f){var a=q.parseAttributes(i,q.Path.ATTRIBUTE_NAMES);l&&l(new q.Path(a.d,h(a,f)))},q.Path.async=!0}(typeof exports!="undefined"?exports:this),function(d){var b=d.fabric||(d.fabric={}),f=b.util.object.extend,c=b.util.array.invoke,a=b.Object.prototype.toObject;if(b.PathGroup){b.warn("fabric.PathGroup is already defined");return}b.PathGroup=b.util.createClass(b.Path,{type:"path-group",fill:"",initialize:function(h,g){g=g||{},this.paths=h||[];for(var i=this.paths.length;i--;){this.paths[i].group=this}this.setOptions(g),g.widthAttr&&(this.scaleX=g.widthAttr/g.width),g.heightAttr&&(this.scaleY=g.heightAttr/g.height),this.setCoords(),g.sourcePath&&this.setSourcePath(g.sourcePath)},render:function(j){if(!this.visible){return}j.save();var k=this.transformMatrix;k&&j.transform(k[0],k[1],k[2],k[3],k[4],k[5]),this.transform(j),this._setShadow(j),this.clipTo&&b.util.clipContext(this,j);for(var h=0,g=this.paths.length;h<g;++h){this.paths[h].render(j,!0)}this.clipTo&&j.restore(),this._removeShadow(j),j.restore()},_set:function(h,g){if(h==="fill"&&g&&this.isSameColor()){var i=this.paths.length;while(i--){this.paths[i]._set(h,g)}}return this.callSuper("_set",h,g)},toObject:function(h){var g=f(a.call(this,h),{paths:c(this.getObjects(),"toObject",h)});return this.sourcePath&&(g.sourcePath=this.sourcePath),g},toDatalessObject:function(h){var g=this.toObject(h);return this.sourcePath&&(g.paths=this.sourcePath),g},toSVG:function(k){var h=this.getObjects(),l=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"];for(var j=0,g=h.length;j<g;j++){l.push(h[j].toSVG(k))}return l.push("</g>"),k?k(l.join("")):l.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var g=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(e){return(e.get("fill")||"").toLowerCase()===g})},complexity:function(){return this.paths.reduce(function(h,g){return h+(g&&g.complexity?g.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(g,h){typeof g.paths=="string"?b.loadSVGFromURL(g.paths,function(k){var e=g.paths;delete g.paths;var j=b.util.groupSVGElements(k,g,e);h(j)}):b.util.enlivenObjects(g.paths,function(e){delete g.paths,h(new b.PathGroup(e,g))})},b.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(f){var b=f.fabric||(f.fabric={}),h=b.util.object.extend,d=b.util.array.min,a=b.util.array.max,c=b.util.array.invoke;if(b.Group){return}var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",initialize:function(k,i){i=i||{},this._objects=k||[];for(var j=this._objects.length;j--;){this._objects[j].group=this}this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),i&&h(this,i),this._setOpacityIfSame(),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(j){var i=j.getLeft(),k=j.getTop();j.set({originalLeft:i,originalTop:k,left:i-this.left,top:k-this.top}),j.setCoords(),j.__origHasControls=j.hasControls,j.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){return this._restoreObjectsState(),i&&(this._objects.push(i),i.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(i){i.set("active",!0),i.group=this},removeWithUpdate:function(i){return this._moveFlippedObject(i),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(i){i.group=this},_onObjectRemoved:function(i){delete i.group,i.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(j,i){if(j in this.delegatedProperties){var k=this._objects.length;this[j]=i;while(k--){this._objects[k].set(j,i)}}else{this[j]=i}},toObject:function(i){return h(this.callSuper("toObject",i),{objects:c(this._objects,"toObject",i)})},render:function(j){if(!this.visible){return}j.save(),this.clipTo&&b.util.clipContext(this,j);for(var k=0,i=this._objects.length;k<i;k++){this._renderObject(this._objects[k],j)}this.clipTo&&j.restore(),j.restore()},_renderControls:function(k,i){this.callSuper("_renderControls",k,i);for(var l=0,j=this._objects.length;l<j;l++){this._objects[l]._renderControls(k)}},_renderObject:function(j,i){var k=j.hasRotatingPoint;if(!j.visible){return}j.hasRotatingPoint=!1,j.render(i),j.hasRotatingPoint=k},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(m){var k=m.get("originX"),o=m.get("originY"),l=m.getCenterPoint();m.set({originX:"center",originY:"center",left:l.x,top:l.y}),this._toggleFlipping(m);var j=m.getPointByOrigin(k,o);return m.set({originX:k,originY:o,left:j.x,top:j.y}),this},_toggleFlipping:function(i){this.flipX&&(i.toggle("flipX"),i.set("left",-i.get("left")),i.setAngle(-i.getAngle())),this.flipY&&(i.toggle("flipY"),i.set("top",-i.get("top")),i.setAngle(-i.getAngle()))},_restoreObjectState:function(i){return this._setObjectPosition(i),i.setCoords(),i.hasControls=i.__origHasControls,delete i.__origHasControls,i.set("active",!1),i.setCoords(),delete i.group,this},_setObjectPosition:function(k){var i=this.getLeft(),l=this.getTop(),j=this._getRotatedLeftTop(k);k.set({angle:k.getAngle()+this.getAngle(),left:i+j.left,top:l+j.top,scaleX:k.get("scaleX")*this.get("scaleX"),scaleY:k.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(j){var i=this.getAngle()*(Math.PI/180);return{left:-Math.sin(i)*j.getTop()*this.get("scaleY")+Math.cos(i)*j.getLeft()*this.get("scaleX"),top:Math.cos(i)*j.getTop()*this.get("scaleY")+Math.sin(i)*j.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(i){i.setCoords()}),this},_setOpacityIfSame:function(){var j=this.getObjects(),i=j[0]?j[0].get("opacity"):1,k=j.every(function(l){return l.get("opacity")===i});k&&(this.opacity=i)},_calcBounds:function(p){var k=[],u=[],m;for(var j=0,l=this._objects.length;j<l;++j){m=this._objects[j],m.setCoords();for(var q in m.oCoords){k.push(m.oCoords[q].x),u.push(m.oCoords[q].y)}}this.set(this._getBounds(k,u,p))},_getBounds:function(m,q,k){var p=b.util.invertTransform(this.getViewportTransform()),j=b.util.transformPoint(new b.Point(d(m),d(q)),p),i=b.util.transformPoint(new b.Point(a(m),a(q)),p),l={width:i.x-j.x||0,height:i.y-j.y||0};return k||(l.left=(j.x+i.x)/2||0,l.top=(j.y+i.y)/2||0),l},toSVG:function(k){var i=["<g ",'transform="',this.getSvgTransform(),'">'];for(var l=0,j=this._objects.length;l<j;l++){i.push(this._objects[l].toSVG(k))}return i.push("</g>"),k?k(i.join("")):i.join("")},get:function(j){if(j in g){if(this[j]){return this[j]}for(var i=0,k=this._objects.length;i<k;i++){if(this._objects[i][j]){return !0}}return !1}return j in this.delegatedProperties?this._objects[0]&&this._objects[0].get(j):this[j]}}),b.Group.fromObject=function(i,j){b.util.enlivenObjects(i.objects,function(e){delete i.objects,j&&j(new b.Group(e,i))})},b.Group.async=!0}(typeof exports!="undefined"?exports:this),function(b){var a=fabric.util.object.extend;b.fabric||(b.fabric={});if(b.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(d,c){c||(c={}),this.filters=[],this.callSuper("initialize",c),this._initElement(d,c),this._initConfig(c),c.filters&&(this.filters=c.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(d,c){return this._element=d,this._originalElement=d,this._initConfig(),this.filters.length!==0&&this.applyFilters(c),this},setCrossOrigin:function(c){return this.crossOrigin=c,this._element.crossOrigin=c,this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},render:function(f,c){if(!this.visible){return}f.save();var g=this.transformMatrix,d=this.group&&this.group.type==="path-group";d&&f.translate(-this.group.width/2,-this.group.height/2),g&&f.transform(g[0],g[1],g[2],g[3],g[4],g[5]),c||this.transform(f),d&&f.translate(this.width/2,this.height/2),this._setShadow(f),this.clipTo&&fabric.util.clipContext(this,f),this._render(f),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),this._renderStroke(f),this.clipTo&&f.restore(),f.restore()},_stroke:function(c){c.save(),this._setStrokeStyles(c),c.beginPath(),c.strokeRect(-this.width/2,-this.height/2,this.width,this.height),c.closePath(),c.restore()},_renderDashedStroke:function(g){var d=-this.width/2,h=-this.height/2,f=this.width,c=this.height;g.save(),this._setStrokeStyles(g),g.beginPath(),fabric.util.drawDashedLine(g,d,h,d+f,h,this.strokeDashArray),fabric.util.drawDashedLine(g,d+f,h,d+f,h+c,this.strokeDashArray),fabric.util.drawDashedLine(g,d+f,h+c,d,h+c,this.strokeDashArray),fabric.util.drawDashedLine(g,d,h+c,d,h,this.strokeDashArray),g.closePath(),g.restore()},toObject:function(c){return a(this.callSuper("toObject",c),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(d){return d&&d.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(d){var c=[];c.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>");if(this.stroke||this.strokeDashArray){var f=this.fill;this.fill=null,c.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>'),this.fill=f}return c.push("</g>"),d?d(c.join("")):c.join("")},getSrc:function(){if(this.getElement()){return this.getElement().src||this.getElement()._src}},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(g){if(!this._originalElement){return}if(this.filters.length===0){this._element=this._originalElement,g&&g();return}var d=this._originalElement,h=fabric.util.createCanvasElement(),f=fabric.util.createImage(),c=this;return h.width=d.width,h.height=d.height,h.getContext("2d").drawImage(d,0,0,d.width,d.height),this.filters.forEach(function(i){i&&i.applyTo(h)}),f.width=d.width,f.height=d.height,fabric.isLikelyNode?(f.src=h.toBuffer(undefined,fabric.Image.pngCompression),c._element=f,g&&g()):(f.onload=function(){c._element=f,g&&g(),f.onload=h=d=null},f.src=h.toDataURL("image/png")),this},_render:function(c){this._element&&c.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width),this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={}),this.setOptions(c),this._setWidthHeight(c),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(d,c){d.filters&&d.filters.length?fabric.util.enlivenObjects(d.filters,function(f){c&&c(f)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(c){this.width="width" in c?c.width:this.getElement()?this.getElement().width||0:0,this.height="height" in c?c.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(d,c){fabric.util.loadImage(d.src,function(e){fabric.Image.prototype._initFilters.call(d,d,function(g){d.filters=g||[];var f=new fabric.Image(e,d);c&&c(f)})},null,d.crossOrigin)},fabric.Image.fromURL=function(d,c,f){fabric.util.loadImage(d,function(g){c(new fabric.Image(g,f))},null,f&&f.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" ")),fabric.Image.fromElement=function(f,g,d){var c=fabric.parseAttributes(f,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(c["xlink:href"],g,a(d?fabric.util.object.clone(d):{},c))},fabric.Image.async=!0,fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?Math.round((a-1)/90)*90:Math.round(a/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(d){d=d||{};var b=function(){},f=d.onComplete||b,c=d.onChange||b,a=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(g){a.setAngle(g),c()},onComplete:function(){a.setCoords(),f()},onStart:function(){a.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Brightness=a.util.createClass(a.Image.filters.BaseFilter,{type:"Brightness",initialize:function(d){d=d||{},this.brightness=d.brightness||0},applyTo:function(j){var f=j.getContext("2d"),l=f.getImageData(0,0,j.width,j.height),h=l.data,d=this.brightness;for(var g=0,k=h.length;g<k;g+=4){h[g]+=d,h[g+1]+=d,h[g+2]+=d}f.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}}),a.Image.filters.Brightness.fromObject=function(d){return new a.Image.filters.Brightness(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Convolute=a.util.createClass(a.Image.filters.BaseFilter,{type:"Convolute",initialize:function(d){d=d||{},this.opaque=d.opaque,this.matrix=d.matrix||[0,0,0,0,1,0,0,0,0];var f=a.util.createCanvasElement();this.tmpCtx=f.getContext("2d")},_createImageData:function(f,d){return this.tmpCtx.createImageData(f,d)},applyTo:function(ab){var J=this.matrix,R=ab.getContext("2d"),O=R.getImageData(0,0,ab.width,ab.height),X=Math.round(Math.sqrt(J.length)),K=Math.floor(X/2),Q=O.data,H=O.width,af=O.height,aa=H,V=af,ad=this._createImageData(aa,V),Y=ad.data,P=this.opaque?1:0;for(var ac=0;ac<V;ac++){for(var G=0;G<aa;G++){var U=ac,Z=G,B=(ac*aa+G)*4,ae=0,F=0,I=0,q=0;for(var D=0;D<X;D++){for(var j=0;j<X;j++){var z=U+D-K,M=Z+j-K;if(z<0||z>af||M<0||M>H){continue}var W=(z*H+M)*4,A=J[D*X+j];ae+=Q[W]*A,F+=Q[W+1]*A,I+=Q[W+2]*A,q+=Q[W+3]*A}}Y[B]=ae,Y[B+1]=F,Y[B+2]=I,Y[B+3]=q+P*(255-q)}}R.putImageData(ad,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),a.Image.filters.Convolute.fromObject=function(d){return new a.Image.filters.Convolute(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.GradientTransparency=a.util.createClass(a.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(d){d=d||{},this.threshold=d.threshold||100},applyTo:function(k){var g=k.getContext("2d"),m=g.getImageData(0,0,k.width,k.height),j=m.data,f=this.threshold,h=j.length;for(var l=0,d=j.length;l<d;l+=4){j[l+3]=f+255*(h-l)/h}g.putImageData(m,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}}),a.Image.filters.GradientTransparency.fromObject=function(d){return new a.Image.filters.GradientTransparency(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={});a.Image.filters.Grayscale=a.util.createClass(a.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(h){var d=h.getContext("2d"),k=d.getImageData(0,0,h.width,h.height),g=k.data,c=k.width*k.height*4,f=0,j;while(f<c){j=(g[f]+g[f+1]+g[f+2])/3,g[f]=j,g[f+1]=j,g[f+2]=j,f+=4}d.putImageData(k,0,0)}}),a.Image.filters.Grayscale.fromObject=function(){return new a.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={});a.Image.filters.Invert=a.util.createClass(a.Image.filters.BaseFilter,{type:"Invert",applyTo:function(h){var d=h.getContext("2d"),j=d.getImageData(0,0,h.width,h.height),g=j.data,c=g.length,f;for(f=0;f<c;f+=4){g[f]=255-g[f],g[f+1]=255-g[f+1],g[f+2]=255-g[f+2]}d.putImageData(j,0,0)}}),a.Image.filters.Invert.fromObject=function(){return new a.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Mask=a.util.createClass(a.Image.filters.BaseFilter,{type:"Mask",initialize:function(d){d=d||{},this.mask=d.mask,this.channel=[0,1,2,3].indexOf(d.channel)>-1?d.channel:0},applyTo:function(p){if(!this.mask){return}var h=p.getContext("2d"),d=h.getImageData(0,0,p.width,p.height),k=d.data,w=this.mask.getElement(),g=a.util.createCanvasElement(),v=this.channel,t,m=d.width*d.height*4;g.width=w.width,g.height=w.height,g.getContext("2d").drawImage(w,0,0,w.width,w.height);var j=g.getContext("2d").getImageData(0,0,w.width,w.height),q=j.data;for(t=0;t<m;t+=4){k[t+3]=q[t+v]}h.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),a.Image.filters.Mask.fromObject=function(d,f){a.util.loadImage(d.mask.src,function(e){d.mask=new a.Image(e,d.mask),f&&f(new a.Image.filters.Mask(d))})},a.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Noise=a.util.createClass(a.Image.filters.BaseFilter,{type:"Noise",initialize:function(d){d=d||{},this.noise=d.noise||0},applyTo:function(k){var g=k.getContext("2d"),m=g.getImageData(0,0,k.width,k.height),j=m.data,f=this.noise,h;for(var l=0,d=j.length;l<d;l+=4){h=(0.5-Math.random())*f,j[l]+=h,j[l+1]+=h,j[l+2]+=h}g.putImageData(m,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),a.Image.filters.Noise.fromObject=function(d){return new a.Image.filters.Noise(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Pixelate=a.util.createClass(a.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(d){d=d||{},this.blocksize=d.blocksize||4},applyTo:function(B){var H=B.getContext("2d"),q=H.getImageData(0,0,B.width,B.height),g=q.data,y=q.height,I=q.width,k,G,E,A,x,D,z;for(G=0;G<y;G+=this.blocksize){for(E=0;E<I;E+=this.blocksize){k=G*4*I+E*4,A=g[k],x=g[k+1],D=g[k+2],z=g[k+3];for(var j=G,C=G+this.blocksize;j<C;j++){for(var F=E,w=E+this.blocksize;F<w;F++){k=j*4*I+F*4,g[k]=A,g[k+1]=x,g[k+2]=D,g[k+3]=z}}}}H.putImageData(q,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}}),a.Image.filters.Pixelate.fromObject=function(d){return new a.Image.filters.Pixelate(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.RemoveWhite=a.util.createClass(a.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(d){d=d||{},this.threshold=d.threshold||30,this.distance=d.distance||20},applyTo:function(v){var z=v.getContext("2d"),j=z.getImageData(0,0,v.width,v.height),d=j.data,m=this.threshold,A=this.distance,g=255-m,y=Math.abs,x,q,k;for(var w=0,p=d.length;w<p;w+=4){x=d[w],q=d[w+1],k=d[w+2],x>g&&q>g&&k>g&&y(x-q)<A&&y(x-k)<A&&y(q-k)<A&&(d[w+3]=1)}z.putImageData(j,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),a.Image.filters.RemoveWhite.fromObject=function(d){return new a.Image.filters.RemoveWhite(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={});a.Image.filters.Sepia=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(h){var d=h.getContext("2d"),k=d.getImageData(0,0,h.width,h.height),g=k.data,c=g.length,f,j;for(f=0;f<c;f+=4){j=0.3*g[f]+0.59*g[f+1]+0.11*g[f+2],g[f]=j+100,g[f+1]=j+50,g[f+2]=j+255}d.putImageData(k,0,0)}}),a.Image.filters.Sepia.fromObject=function(){return new a.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={});a.Image.filters.Sepia2=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(h){var l=h.getContext("2d"),f=l.getImageData(0,0,h.width,h.height),c=f.data,g=c.length,m,d,k,j;for(m=0;m<g;m+=4){d=c[m],k=c[m+1],j=c[m+2],c[m]=(d*0.393+k*0.769+j*0.189)/1.351,c[m+1]=(d*0.349+k*0.686+j*0.168)/1.203,c[m+2]=(d*0.272+k*0.534+j*0.131)/2.14}l.putImageData(f,0,0)}}),a.Image.filters.Sepia2.fromObject=function(){return new a.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Tint=a.util.createClass(a.Image.filters.BaseFilter,{type:"Tint",initialize:function(d){d=d||{},this.color=d.color||"#000000",this.opacity=typeof d.opacity!="undefined"?d.opacity:(new a.Color(this.color)).getAlpha()},applyTo:function(x){var m=x.getContext("2d"),g=m.getImageData(0,0,x.width,x.height),t=g.data,C=t.length,k,B,A,w,q,z,v,j,y;y=(new a.Color(this.color)).getSource(),B=y[0]*this.opacity,A=y[1]*this.opacity,w=y[2]*this.opacity,j=1-this.opacity;for(k=0;k<C;k+=4){q=t[k],z=t[k+1],v=t[k+2],t[k]=B+q*j,t[k+1]=A+z*j,t[k+2]=w+v*j}m.putImageData(g,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),a.Image.filters.Tint.fromObject=function(d){return new a.Image.filters.Tint(d)}}(typeof exports!="undefined"?exports:this),function(b){var a=b.fabric||(b.fabric={}),c=a.util.object.extend;a.Image.filters.Multiply=a.util.createClass(a.Image.filters.BaseFilter,{type:"Multiply",initialize:function(d){d=d||{},this.color=d.color||"#000000"},applyTo:function(j){var l=j.getContext("2d"),h=l.getImageData(0,0,j.width,j.height),f=h.data,g=f.length,k,d;d=(new a.Color(this.color)).getSource();for(k=0;k<g;k+=4){f[k]*=d[0]/255,f[k+1]*=d[1]/255,f[k+2]*=d[2]/255}l.putImageData(h,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}}),a.Image.filters.Multiply.fromObject=function(d){return new a.Image.filters.Multiply(d)}}(typeof exports!="undefined"?exports:this),function(f){var b=f.fabric||(f.fabric={}),h=b.util.object.extend,d=b.util.object.clone,a=b.util.toFixed,c=b.StaticCanvas.supports("setLineDash");if(b.Text){b.warn("fabric.Text is already defined");return}var g=b.Object.prototype.stateProperties.concat();g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:g,stroke:null,shadow:null,initialize:function(j,i){i=i||{},this.text=j,this.__skipDimension=!0,this.setOptions(i),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(){if(this.__skipDimension){return}var i=b.util.createCanvasElement();this._render(i.getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(j){var i=this.group&&this.group.type==="path-group";i&&!this.transformMatrix?j.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):i&&this.transformMatrix&&j.translate(-this.group.width/2,-this.group.height/2),typeof Cufon=="undefined"||this.useNative===!0?this._renderViaNative(j):this._renderViaCufon(j)},_renderViaNative:function(i){var j=this.text.split(this._reNewline);this.transform(i,b.isLikelyNode),this._setTextStyles(i),this.width=this._getTextWidth(i,j),this.height=this._getTextHeight(i,j),this.clipTo&&b.util.clipContext(this,i),this._renderTextBackground(i,j),this._translateForTextAlign(i),this._renderText(i,j),this.textAlign!=="left"&&this.textAlign!=="justify"&&i.restore(),this._renderTextDecoration(i,j),this.clipTo&&i.restore(),this._setBoundaries(i,j),this._totalLineHeight=0},_renderText:function(j,i){j.save(),this._setShadow(j),this._renderTextFill(j,i),this._renderTextStroke(j,i),this._removeShadow(j),j.restore()},_translateForTextAlign:function(i){this.textAlign!=="left"&&this.textAlign!=="justify"&&(i.save(),i.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(o,k){this._boundaries=[];for(var p=0,m=k.length;p<m;p++){var j=this._getLineWidth(o,k[p]),l=this._getLineLeftOffset(j);this._boundaries.push({height:this.fontSize*this.lineHeight,width:j,left:l})}},_setTextStyles:function(i){this._setFillStyles(i),this._setStrokeStyles(i),i.textBaseline="alphabetic",this.skipTextAlign||(i.textAlign=this.textAlign),i.font=this._getFontDeclaration()},_getTextHeight:function(j,i){return this.fontSize*i.length*this.lineHeight},_getTextWidth:function(o,k){var p=o.measureText(k[0]||"|").width;for(var m=1,j=k.length;m<j;m++){var l=o.measureText(k[m]).width;l>p&&(p=l)}return p},_renderChars:function(m,k,o,l,j){k[m](o,l,j)},_renderTextLine:function(A,G,q,j,x,H){x-=this.fontSize/4;if(this.textAlign!=="justify"){this._renderChars(A,G,q,j,x,H);return}var m=G.measureText(q).width,F=this.width;if(F>m){var D=q.split(/\s+/),z=G.measureText(q.replace(/\s+/g,"")).width,w=F-z,C=D.length-1,y=w/C,k=0;for(var B=0,E=D.length;B<E;B++){this._renderChars(A,G,D[B],j+k,x,H),k+=G.measureText(D[B]).width+y}}else{this._renderChars(A,G,q,j,x,H)}},_getLeftOffset:function(){return b.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return -this.height/2},_renderTextFill:function(o,k){if(!this.fill&&!this._skipFillStrokeCheck){return}this._boundaries=[];var p=0;for(var m=0,j=k.length;m<j;m++){var l=this._getHeightOfLine(o,m,k);p+=l,this._renderTextLine("fillText",o,k[m],this._getLeftOffset(),this._getTopOffset()+p,m)}},_renderTextStroke:function(m,k){if(!this.stroke&&!this._skipFillStrokeCheck){return}var q=0;m.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),c&&m.setLineDash(this.strokeDashArray)),m.beginPath();for(var l=0,j=k.length;l<j;l++){var p=this._getHeightOfLine(m,l,k);q+=p,this._renderTextLine("strokeText",m,k[l],this._getLeftOffset(),this._getTopOffset()+q,l)}m.closePath(),m.restore()},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(j,i){this._renderTextBoxBackground(j),this._renderTextLinesBackground(j,i)},_renderTextBoxBackground:function(i){if(!this.backgroundColor){return}i.save(),i.fillStyle=this.backgroundColor,i.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),i.restore()},_renderTextLinesBackground:function(o,k){if(!this.textBackgroundColor){return}o.save(),o.fillStyle=this.textBackgroundColor;for(var p=0,m=k.length;p<m;p++){if(k[p]!==""){var j=this._getLineWidth(o,k[p]),l=this._getLineLeftOffset(j);o.fillRect(this._getLeftOffset()+l,this._getTopOffset()+p*this.fontSize*this.lineHeight,j,this.fontSize*this.lineHeight)}}o.restore()},_getLineLeftOffset:function(i){return this.textAlign==="center"?(this.width-i)/2:this.textAlign==="right"?this.width-i:0},_getLineWidth:function(j,i){return this.textAlign==="justify"?this.width:j.measureText(i).width},_renderTextDecoration:function(m,k){function j(p){for(var q=0,r=k.length;q<r;q++){var n=l._getLineWidth(m,k[q]),e=l._getLineLeftOffset(n);m.fillRect(l._getLeftOffset()+e,~~(p+q*l._getHeightOfLine(m,q,k)-o),n,1)}}if(!this.textDecoration){return}var o=this._getTextHeight(m,k)/2,l=this;this.textDecoration.indexOf("underline")>-1&&j(this.fontSize*this.lineHeight),this.textDecoration.indexOf("line-through")>-1&&j(this.fontSize*this.lineHeight-this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&j(this.fontSize*this.lineHeight-this.fontSize)},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(j){if(!this.visible){return}j.save();var i=this.transformMatrix;i&&(!this.group||this.group.type==="path-group")&&j.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._render(j),j.restore()},toObject:function(j){var i=h(this.callSuper("toObject",j),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(i),i},toSVG:function(o){var k=[],p=this.text.split(this._reNewline),m=this._getSVGLeftTopOffsets(p),j=this._getSVGTextAndBg(m.lineTop,m.textLeft,p),l=this._getSVGShadows(m.lineTop,p);return m.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(k,j,l,m),o?o(k.join("")):k.join("")},_getSVGLeftTopOffsets:function(k){var i=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,l=-(this.width/2),j=this.useNative?this.fontSize-1:this.height/2-k.length*this.fontSize-this._totalLineHeight;return{textLeft:l,textTop:j,lineTop:i}},_wrapSVGTextAndBg:function(k,i,l,j){k.push('<g transform="',this.getSvgTransform(),'">',i.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',a(j.textLeft,2)," ",a(j.textTop,2),')">',l.join(""),i.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(m,q){var l=[],k,p,j=1;if(!this.shadow||!this._boundaries){return l}for(k=0,p=q.length;k<p;k++){if(q[k]!==""){var i=this._boundaries&&this._boundaries[k]?this._boundaries[k].left:0;l.push('<tspan x="',a(i+j+this.shadow.offsetX,2),k===0||this.useNative?'" y':'" dy','="',a(this.useNative?m*k-this.height/2+this.shadow.offsetY:m+(k===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",b.util.string.escapeXml(q[k]),"</tspan>"),j=1}else{j++}}return l},_getSVGTextAndBg:function(q,l,w){var p=[],k=[],m=1;this._setSVGBg(k);for(var v=0,j=w.length;v<j;v++){w[v]!==""?(this._setSVGTextLineText(w[v],v,p,q,m,k),m=1):m++;if(!this.textBackgroundColor||!this._boundaries){continue}this._setSVGTextLineBg(k,v,l,q)}return{textSpans:p,textBgRects:k}},_setSVGTextLineText:function(l,p,k,j,m){var i=this._boundaries&&this._boundaries[p]?a(this._boundaries[p].left,2):0;k.push('<tspan x="',i,'" ',p===0||this.useNative?"y":"dy",'="',a(this.useNative?j*p-this.height/2:j*m,2),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(l),"</tspan>")},_setSVGTextLineBg:function(k,i,l,j){k.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(l+this._boundaries[i].left,2),'" y="',a(j*i-this.height/2,2),'" width="',a(this._boundaries[i].width,2),'" height="',a(this._boundaries[i].height,2),'"></rect>')},_setSVGBg:function(i){this.backgroundColor&&this._boundaries&&i.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,2),'" y="',a(-this.height/2,2),'" width="',a(this.width,2),'" height="',a(this.height,2),'"></rect>')},_getFillAttributes:function(i){var j=i&&typeof i=="string"?new b.Color(i):"";return !j||!j.getSource()||j.getAlpha()===1?'fill="'+i+'"':'opacity="'+j.getAlpha()+'" fill="'+j.setAlpha(1).toRgb()+'"'},_set:function(j,i){j==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+i+"$3")),this.callSuper("_set",j,i),j in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(l,m){if(!l){return null}var k=b.parseAttributes(l,b.Text.ATTRIBUTE_NAMES);m=b.util.object.extend(m?b.util.object.clone(m):{},k),"dx" in k&&(m.left+=k.dx),"dy" in k&&(m.top+=k.dy),"fontSize" in m||(m.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE),m.originX||(m.originX="center");var j=new b.Text(l.textContent,m);return j.set({left:j.getLeft()+j.getWidth()/2,top:j.getTop()-j.getHeight()/2}),j},b.Text.fromObject=function(i){return new b.Text(i.text,d(i))},b.util.createAccessors(b.Text)}(typeof exports!="undefined"?exports:this),function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1000,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(c,b){this.styles=b?b.styles||{}:{},this.callSuper("initialize",c,b),this.initBehavior(),fabric.IText.instances.push(this),this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles){return !0}var d=this.styles;for(var b in d){for(var f in d[b]){for(var c in d[b][f]){return !1}}}return !0},setSelectionStart:function(b){this.selectionStart!==b&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})),this.selectionStart=b,this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=b)},setSelectionEnd:function(b){this.selectionEnd!==b&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})),this.selectionEnd=b,this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=b)},getSelectionStyles:function(f,c){if(arguments.length===2){var g=[];for(var d=f;d<c;d++){g.push(this.getSelectionStyles(d))}return g}var b=this.get2DCursorLocation(f);return this.styles[b.lineIndex]?this.styles[b.lineIndex][b.charIndex]||{}:{}},setSelectionStyles:function(c){if(this.selectionStart===this.selectionEnd){this._extendStyles(this.selectionStart,c)}else{for(var b=this.selectionStart;b<this.selectionEnd;b++){this._extendStyles(b,c)}}return this},_extendStyles:function(c,b){var d=this.get2DCursorLocation(c);this.styles[d.lineIndex]||(this.styles[d.lineIndex]={}),this.styles[d.lineIndex][d.charIndex]||(this.styles[d.lineIndex][d.charIndex]={}),fabric.util.object.extend(this.styles[d.lineIndex][d.charIndex],b)},_render:function(b){this.callSuper("_render",b),this.ctx=b,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active){return}var c=this.text.split(""),b;this.selectionStart===this.selectionEnd?(b=this._getCursorBoundaries(c,"cursor"),this.renderCursor(b)):(b=this._getCursorBoundaries(c,"selection"),this.renderSelection(c,b))},get2DCursorLocation:function(c){typeof c=="undefined"&&(c=this.selectionStart);var b=this.text.slice(0,c),d=b.split(this._reNewline);return{lineIndex:d.length-1,charIndex:d[d.length-1].length}},getCurrentCharStyle:function(c,b){var d=this.styles[c]&&this.styles[c][b===0?0:b-1];return{fontSize:d&&d.fontSize||this.fontSize,fill:d&&d.fill||this.fill,textBackgroundColor:d&&d.textBackgroundColor||this.textBackgroundColor,textDecoration:d&&d.textDecoration||this.textDecoration,fontFamily:d&&d.fontFamily||this.fontFamily,fontWeight:d&&d.fontWeight||this.fontWeight,fontStyle:d&&d.fontStyle||this.fontStyle,stroke:d&&d.stroke||this.stroke,strokeWidth:d&&d.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,b){return this.styles[c]&&this.styles[c][b===0?0:b-1]&&this.styles[c][b===0?0:b-1].fontSize||this.fontSize},getCurrentCharColor:function(c,b){return this.styles[c]&&this.styles[c][b===0?0:b-1]&&this.styles[c][b===0?0:b-1].fill||this.cursorColor},_getCursorBoundaries:function(g,c){var j=this.get2DCursorLocation(),f=this.text.split(this._reNewline),b=Math.round(this._getLeftOffset()),d=-this.height/2,h=this._getCursorBoundariesOffsets(g,c,j,f);return{left:b,top:d,leftOffset:h.left+h.lineLeft,topOffset:h.top}},_getCursorBoundariesOffsets:function(k,q,d,b){var h=0,v=0,c=0,p=0,m=q==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(d.lineIndex,d.charIndex):0;for(var j=0;j<this.selectionStart;j++){if(k[j]==="\n"){p=0;var g=v+(q==="cursor"?1:0);m+=this._getCachedLineHeight(g),v++,c=0}else{p+=this._getWidthOfChar(this.ctx,k[j],v,c),c++}h=this._getCachedLineOffset(v,b)}return this._clearCache(),{top:m,left:p,lineLeft:h}},_clearCache:function(){this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},_getCachedLineHeight:function(b){return this.__lineHeights[b]||(this.__lineHeights[b]=this._getHeightOfLine(this.ctx,b))},_getCachedLineWidth:function(c,b){return this.__lineWidths[c]||(this.__lineWidths[c]=this._getWidthOfLine(this.ctx,c,b))},_getCachedLineOffset:function(c,b){var d=this._getCachedLineWidth(c,b);return this.__lineOffsets[c]||(this.__lineOffsets[c]=this._getLineLeftOffset(d))},renderCursor:function(g){var c=this.ctx;c.save();var j=this.get2DCursorLocation(),f=j.lineIndex,b=j.charIndex,d=this.getCurrentCharFontSize(f,b),h=f===0&&b===0?this._getCachedLineOffset(f,this.text.split(this._reNewline)):g.leftOffset;c.fillStyle=this.getCurrentCharColor(f,b),c.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,c.fillRect(g.left+h,g.top+g.topOffset,this.cursorWidth/this.scaleX,d),c.restore()},renderSelection:function(y,E){var k=this.ctx;k.save(),k.fillStyle=this.selectionColor;var b=this.get2DCursorLocation(this.selectionStart),q=this.get2DCursorLocation(this.selectionEnd),F=b.lineIndex,j=q.lineIndex,D=this.text.split(this._reNewline);for(var B=F;B<=j;B++){var x=this._getCachedLineOffset(B,D)||0,m=this._getCachedLineHeight(B),A=0;if(B===F){for(var w=0,g=D[B].length;w<g;w++){w>=b.charIndex&&(B!==j||w<q.charIndex)&&(A+=this._getWidthOfChar(k,D[B][w],B,w)),w<b.charIndex&&(x+=this._getWidthOfChar(k,D[B][w],B,w))}}else{if(B>F&&B<j){A+=this._getCachedLineWidth(B,D)||5}else{if(B===j){for(var z=0,C=q.charIndex;z<C;z++){A+=this._getWidthOfChar(k,D[B][z],B,z)}}}}k.fillRect(E.left+x,E.top+E.topOffset,A,m),E.topOffset+=m}k.restore()},_renderChars:function(y,E,k,b,q,F){if(this.isEmptyStyles()){return this._renderCharsFast(y,E,k,b,q)}this.skipTextAlign=!0,b-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var j=this.text.split(this._reNewline),D=this._getWidthOfLine(E,F,j),B=this._getHeightOfLine(E,F,j),x=this._getLineLeftOffset(D),m=k.split(""),A,w="";b+=x||0,E.save();for(var g=0,z=m.length;g<=z;g++){A=A||this.getCurrentCharStyle(F,g);var C=this.getCurrentCharStyle(F,g+1);if(this._hasStyleChanged(A,C)||g===z){this._renderChar(y,E,F,g-1,w,b,q,B),w="",A=C}w+=m[g]}E.restore()},_renderCharsFast:function(f,c,g,d,b){this.skipTextAlign=!1,f==="fillText"&&this.fill&&this.callSuper("_renderChars",f,c,g,d,b),f==="strokeText"&&this.stroke&&this.callSuper("_renderChars",f,c,g,d,b)},_renderChar:function(q,y,g,b,k,z,d,x){var w,p,j;if(this.styles&&this.styles[g]&&(w=this.styles[g][b])){var v=w.stroke||this.stroke,m=w.fill||this.fill;y.save(),p=this._applyCharStylesGetWidth(y,k,g,b,w),j=this._getHeightOfChar(y,k,g,b),m&&y.fillText(k,z,d),v&&y.strokeText(k,z,d),this._renderCharDecoration(y,w,z,d,p,x,j),y.restore(),y.translate(p,0)}else{q==="strokeText"&&this.stroke&&y[q](k,z,d),q==="fillText"&&this.fill&&y[q](k,z,d),p=this._applyCharStylesGetWidth(y,k,g,b),this._renderCharDecoration(y,null,z,d,p,x),y.translate(y.measureText(k).width,0)}},_hasStyleChanged:function(c,b){return c.fill!==b.fill||c.fontSize!==b.fontSize||c.textBackgroundColor!==b.textBackgroundColor||c.textDecoration!==b.textDecoration||c.fontFamily!==b.fontFamily||c.fontWeight!==b.fontWeight||c.fontStyle!==b.fontStyle||c.stroke!==b.stroke||c.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(g,k,d,b,f,l,c){var j=k?k.textDecoration||this.textDecoration:this.textDecoration,h=(k?k.fontSize:null)||this.fontSize;if(!j){return}j.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(g,d,b+this.fontSize/this._fontSizeFraction,f,0,this.fontSize/20),j.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(g,d,b+this.fontSize/this._fontSizeFraction,f,c/2,h/20),j.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(g,d,b,f,l-this.fontSize/this._fontSizeFraction,this.fontSize/20)},_renderCharDecorationAtOffset:function(g,c,h,f,b,d){g.fillRect(c,h-b,f,d)},_renderTextLine:function(g,c,h,f,b,d){b+=this.fontSize/4,this.callSuper("_renderTextLine",g,c,h,f,b,d)},_renderTextDecoration:function(c,b){if(this.isEmptyStyles()){return this.callSuper("_renderTextDecoration",c,b)}},_renderTextLinesBackground:function(m,w){if(!this.textBackgroundColor&&!this.styles){return}m.save(),this.textBackgroundColor&&(m.fillStyle=this.textBackgroundColor);var g=0,b=this.fontSize/this._fontSizeFraction;for(var j=0,x=w.length;j<x;j++){var d=this._getHeightOfLine(m,j,w);if(w[j]===""){g+=d;continue}var v=this._getWidthOfLine(m,j,w),q=this._getLineLeftOffset(v);this.textBackgroundColor&&(m.fillStyle=this.textBackgroundColor,m.fillRect(this._getLeftOffset()+q,this._getTopOffset()+g+b,v,d));if(this.styles[j]){for(var k=0,h=w[j].length;k<h;k++){if(this.styles[j]&&this.styles[j][k]&&this.styles[j][k].textBackgroundColor){var p=w[j][k];m.fillStyle=this.styles[j][k].textBackgroundColor,m.fillRect(this._getLeftOffset()+q+this._getWidthOfCharsAt(m,j,k,w),this._getTopOffset()+g+b,this._getWidthOfChar(m,p,j,k,w)+1,d)}}}g+=d}m.restore()},_getCacheProp:function(c,b){return c+b.fontFamily+b.fontSize+b.fontWeight+b.fontStyle+b.shadow},_applyCharStylesGetWidth:function(e,j,g,d,f){var h=f||this.styles[g]&&this.styles[g][d];h?h=a(h):h={},this._applyFontStyles(h);var c=this._getCacheProp(j,h);if(this.isEmptyStyles()&&this._charWidthsCache[c]&&this.caching){return this._charWidthsCache[c]}typeof h.shadow=="string"&&(h.shadow=new fabric.Shadow(h.shadow));var b=h.fill||this.fill;return e.fillStyle=b.toLive?b.toLive(e):b,h.stroke&&(e.strokeStyle=h.stroke&&h.stroke.toLive?h.stroke.toLive(e):h.stroke),e.lineWidth=h.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(h),this._setShadow.call(h,e),this.caching?(this._charWidthsCache[c]||(this._charWidthsCache[c]=e.measureText(j).width),this._charWidthsCache[c]):e.measureText(j).width},_applyFontStyles:function(b){b.fontFamily||(b.fontFamily=this.fontFamily),b.fontSize||(b.fontSize=this.fontSize),b.fontWeight||(b.fontWeight=this.fontWeight),b.fontStyle||(b.fontStyle=this.fontStyle)},_getStyleDeclaration:function(b,c){return this.styles[b]&&this.styles[b][c]?a(this.styles[b][c]):{}},_getWidthOfChar:function(g,c,j,f){var b=this._getStyleDeclaration(j,f);this._applyFontStyles(b);var d=this._getCacheProp(c,b);if(this._charWidthsCache[d]&&this.caching){return this._charWidthsCache[d]}if(g){g.save();var h=this._applyCharStylesGetWidth(g,c,j,f);return g.restore(),h}},_getHeightOfChar:function(d,b,f,c){return this.styles[f]&&this.styles[f][c]?this.styles[f][c].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(f,c,g,d){d=d||this.text.split(this._reNewline);var b=d[c].split("")[g];return this._getWidthOfChar(f,b,c,g)},_getHeightOfCharAt:function(f,c,g,d){d=d||this.text.split(this._reNewline);var b=d[c].split("")[g];return this._getHeightOfChar(f,b,c,g)},_getWidthOfCharsAt:function(g,c,h,f){var b=0;for(var d=0;d<h;d++){b+=this._getWidthOfCharAt(g,c,d,f)}return b},_getWidthOfLine:function(c,b,d){return this._getWidthOfCharsAt(c,b,d[b].length,d)},_getTextWidth:function(g,c){if(this.isEmptyStyles()){return this.callSuper("_getTextWidth",g,c)}var h=this._getWidthOfLine(g,0,c);for(var f=1,b=c.length;f<b;f++){var d=this._getWidthOfLine(g,f,c);d>h&&(h=d)}return h},_getHeightOfLine:function(g,k,d){d=d||this.text.split(this._reNewline);var b=this._getHeightOfChar(g,d[k][0],k,0),f=d[k],l=f.split("");for(var c=1,j=l.length;c<j;c++){var h=this._getHeightOfChar(g,l[c],k,c);h>b&&(b=h)}return b*this.lineHeight},_getTextHeight:function(f,c){var g=0;for(var d=0,b=c.length;d<b;d++){g+=this._getHeightOfLine(f,d,c)}return g},_getTopOffset:function(){var b=fabric.Text.prototype._getTopOffset.call(this);return b-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(b){if(!this.backgroundColor){return}b.save(),b.fillStyle=this.backgroundColor,b.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),b.restore()},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles)})}}),fabric.IText.fromObject=function(b){return new fabric.IText(b.text,a(b))},fabric.IText.instances=[]}(),function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var b=this;setTimeout(function(){b.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers())})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()}),this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(b){b.__isMousedown=!1})}),this.canvas.on("object:selected",function(b){fabric.IText.prototype.exitEditingOnOthers.call(b.target)})},_tick:function(){var b=this;if(this._abortCursorAnimation){return}this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){b._onTickComplete()},onChange:function(){b.canvas&&b.canvas.renderAll()},abort:function(){return b._abortCursorAnimation}})},_onTickComplete:function(){if(this._abortCursorAnimation){return}var b=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){b.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){b._tick()},onChange:function(){b.canvas&&b.canvas.renderAll()},abort:function(){return b._abortCursorAnimation}})},100)},initDelayedCursor:function(c){var b=this,d=c?0:this.cursorDelay;c&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){b._abortCursorAnimation=!1,b._tick()},d)},abortCursorAnimation:function(){this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.renderAll();var b=this;setTimeout(function(){b._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var b=0,d=c-1;if(this._reSpace.test(this.text.charAt(d))){while(this._reSpace.test(this.text.charAt(d))){b++,d--}}while(/\S/.test(this.text.charAt(d))&&d>-1){b++,d--}return c-b},findWordBoundaryRight:function(c){var b=0,d=c;if(this._reSpace.test(this.text.charAt(d))){while(this._reSpace.test(this.text.charAt(d))){b++,d++}}while(/\S/.test(this.text.charAt(d))&&d<this.text.length){b++,d++}return c+b},findLineBoundaryLeft:function(c){var b=0,d=c-1;while(!/\n/.test(this.text.charAt(d))&&d>-1){b++,d--}return c-b},findLineBoundaryRight:function(c){var b=0,d=c;while(!/\n/.test(this.text.charAt(d))&&d<this.text.length){b++,d++}return c+b},getNumNewLinesInSelectedText:function(){var f=this.getSelectedText(),c=0;for(var g=0,d=f.split(""),b=d.length;g<b;g++){d[g]==="\n"&&c++}return c},searchWordBoundary:function(f,c){var g=this._reSpace.test(this.text.charAt(f))?f-1:f,d=this.text.charAt(g),b=/[ \n\.,;!\?\-]/;while(!b.test(d)&&g>0&&g<this.text.length){g+=c,d=this.text.charAt(g)}return b.test(d)&&d!=="\n"&&(g+=c===1?0:1),g},selectWord:function(c){var b=this.searchWordBoundary(c,-1),d=this.searchWordBoundary(c,1);this.setSelectionStart(b),this.setSelectionEnd(d),this.initDelayedCursor(!0)},selectLine:function(c){var b=this.findLineBoundaryLeft(c),d=this.findLineBoundaryRight(c);this.setSelectionStart(b),this.setSelectionEnd(d),this.initDelayedCursor(!0)},enterEditing:function(){if(this.isEditing||!this.editable){return}return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(b){b.selected=!1,b.isEditing&&b.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(!this.hiddenTextarea){return}this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){var c=this.text.split(this._reNewline);for(var b in this.styles){c[b]||delete this.styles[b]}},_removeCharsFromTo:function(g,c){var h=c;while(h!==g){var f=this.get2DCursorLocation(h).charIndex;h--;var b=this.get2DCursorLocation(h).charIndex,d=b>f;d?this.removeStyleObject(d,h+1):this.removeStyleObject(this.get2DCursorLocation(h).charIndex===0,h)}this.text=this.text.slice(0,g)+this.text.slice(c)},insertChars:function(c){var b=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(c,b,this.copiedStyles),this.selectionStart+=c.length,this.selectionEnd=this.selectionStart,this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(c,g,e){this.shiftLineStyles(c,1),this.styles[c+1]||(this.styles[c+1]={});var b=this.styles[c][g-1],d={};if(e){d[0]=a(b),this.styles[c+1]=d}else{for(var f in this.styles[c]){parseInt(f,10)>=g&&(d[parseInt(f,10)-g]=this.styles[c][f],delete this.styles[c][f])}this.styles[c+1]=d}},insertCharStyleObject:function(d,h,f){var c=this.styles[d],e=a(c);h===0&&!f&&(h=1);for(var g in e){var b=parseInt(g,10);b>=h&&(c[b+1]=e[b])}this.styles[d][h]=f||a(c[h-1])},insertStyleObjects:function(g,c,h){if(this.isEmptyStyles()){return}var f=this.get2DCursorLocation(),b=f.lineIndex,d=f.charIndex;this.styles[b]||(this.styles[b]={}),g==="\n"?this.insertNewlineStyleObject(b,d,c):h?this._insertStyles(h):this.insertCharStyleObject(b,d)},_insertStyles:function(g){for(var c=0,h=g.length;c<h;c++){var f=this.get2DCursorLocation(this.selectionStart+c),b=f.lineIndex,d=f.charIndex;this.insertCharStyleObject(b,d,g[c])}},shiftLineStyles:function(c,f){var e=a(this.styles);for(var b in this.styles){var d=parseInt(b,10);d>c&&(this.styles[d+f]=e[d])}},removeStyleObject:function(y,g){var b=this.get2DCursorLocation(g),k=b.lineIndex,z=b.charIndex;if(y){var e=this.text.split(this._reNewline),x=e[k-1],w=x?x.length:0;this.styles[k-1]||(this.styles[k-1]={});for(z in this.styles[k]){this.styles[k-1][parseInt(z,10)+w]=this.styles[k][z]}this.shiftLineStyles(k,-1)}else{var q=this.styles[k];if(q){var j=this.selectionStart===this.selectionEnd?-1:0;delete q[z+j]}var v=a(q);for(var m in v){var d=parseInt(m,10);d>=z&&d!==0&&(q[d-1]=v[d],delete q[d])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+(new Date),this.__lastLastClickTime=+(new Date),this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(b){this.__newClickTime=+(new Date);var a=this.canvas.getPointer(b.e);this.isTripleClick(a)?(this.fire("tripleclick",b),this._stopEvent(b.e)):this.isDoubleClick(a)&&(this.fire("dblclick",b),this._stopEvent(b.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=a,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMousemoveHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(b){var a=this.canvas.getPointer(b.e);this.__mousedownX=a.x,this.__mousedownY=a.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(b.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(b){if(!this.__isMousedown||!this.isEditing){return}var a=this.getSelectionStartFromPointer(b.e);a>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(a)):(this.setSelectionStart(a),this.setSelectionEnd(this.__selectionStartOnMouseDown))})},_isObjectMoved:function(b){var a=this.canvas.getPointer(b);return this.__mousedownX!==a.x||this.__mousedownY!==a.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=!1;if(this._isObjectMoved(a.e)){return}this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(b){var a=this.getSelectionStartFromPointer(b);b.shiftKey?a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},_getLocalRotatedPointer:function(d){var b=this.canvas.getPointer(d),f=new fabric.Point(b.x,b.y),c=new fabric.Point(this.left,this.top),a=fabric.util.rotatePoint(f,c,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,a)},getSelectionStartFromPointer:function(x){var C=this._getLocalRotatedPointer(x),k=this.text.split(this._reNewline),b=0,q=0,D=0,j=0,B;for(var A=0,w=k.length;A<w;A++){D+=this._getHeightOfLine(this.ctx,A)*this.scaleY;var m=this._getWidthOfLine(this.ctx,A,k),z=this._getLineLeftOffset(m);q=z*this.scaleX,this.flipX&&(k[A]=k[A].split("").reverse().join(""));for(var v=0,g=k[A].length;v<g;v++){var y=k[A][v];b=q,q+=this._getWidthOfChar(this.ctx,y,A,this.flipX?g-v:v)*this.scaleX;if(D<=C.y||q<=C.x){j++;continue}return this._getNewSelectionStartFromOffset(C,b,q,j+A,g)}if(C.y<D){return this._getNewSelectionStartFromOffset(C,b,q,j+A,g,v)}}if(typeof B=="undefined"){return this.text.length}},_getNewSelectionStartFromOffset:function(j,m,d,b,g,p){var c=j.x-m,l=d-j.x,k=l>c?0:1,h=b+k;return this.flipX&&(h=g-h),h>this.text.length&&(h=this.text.length),p===g&&h--,h}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(!this.isEditing){return}if(a.keyCode in this._keysMap){this[this._keysMap[a.keyCode]](a)}else{if(!(a.keyCode in this._ctrlKeysMap&&(a.ctrlKey||a.metaKey))){return}this[this._ctrlKeysMap[a.keyCode]](a)}a.stopPropagation(),this.canvas&&this.canvas.renderAll()},forwardDelete:function(a){this.selectionStart===this.selectionEnd&&this.moveCursorRight(a),this.removeChars(a)},copy:function(b){var a=this.getSelectedText(),c=this._getClipboardData(b);c&&c.setData("text",a),this.copiedText=a,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(b){var a=null,c=this._getClipboardData(b);c?a=c.getData("text"):a=this.copiedText,a&&this.insertChars(a)},cut:function(a){if(this.selectionStart===this.selectionEnd){return}this.copy(),this.removeChars(a)},_getClipboardData:function(a){return a&&(a.clipboardData||fabric.window.clipboardData)},onKeyPress:function(a){if(!this.isEditing||a.metaKey||a.ctrlKey||a.keyCode===8||a.keyCode===13){return}this.insertChars(String.fromCharCode(a.which)),a.stopPropagation()},getDownCursorOffset:function(G,k){var z=k?this.selectionEnd:this.selectionStart,w=this.text.split(this._reNewline),C,q,y=this.text.slice(0,z),j=this.text.slice(z),J=y.slice(y.lastIndexOf("\n")+1),F=j.match(/(.*)\n?/)[1],B=(j.match(/.*\n(.*)\n?/)||{})[1]||"",I=this.get2DCursorLocation(z);if(I.lineIndex===w.length-1||G.metaKey){return this.text.length-z}var D=this._getWidthOfLine(this.ctx,I.lineIndex,w);q=this._getLineLeftOffset(D);var x=q,H=I.lineIndex;for(var b=0,A=J.length;b<A;b++){C=J[b],x+=this._getWidthOfChar(this.ctx,C,H,b)}var E=this._getIndexOnNextLine(I,B,x,w);return F.length+1+E},_getIndexOnNextLine:function(G,k,z,w){var C=G.lineIndex+1,q=this._getWidthOfLine(this.ctx,C,w),y=this._getLineLeftOffset(q),j=y,J=0,F;for(var B=0,I=k.length;B<I;B++){var D=k[B],x=this._getWidthOfChar(this.ctx,D,C,B);j+=x;if(j>z){F=!0;var H=j-x,b=j,A=Math.abs(H-z),E=Math.abs(b-z);J=E<A?B+1:B;break}}return F||(J=k.length),J},moveCursorDown:function(b){this.abortCursorAnimation(),this._currentCursorOpacity=1;var a=this.getDownCursorOffset(b,this._selectionDirection==="right");b.shiftKey?this.moveCursorDownWithShift(a):this.moveCursorDownWithoutShift(a),this.initDelayedCursor()},moveCursorDownWithoutShift:function(a){this._selectionDirection="right",this.selectionStart+=a,this.selectionStart>this.text.length&&(this.selectionStart=this.text.length),this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this.selectionStart+=a,this._selectionDirection="left";return}this._selectionDirection="right",this.selectionEnd+=a,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length)},getUpCursorOffset:function(y,E){var k=E?this.selectionEnd:this.selectionStart,b=this.get2DCursorLocation(k);if(b.lineIndex===0||y.metaKey){return k}var q=this.text.slice(0,k),F=q.slice(q.lastIndexOf("\n")+1),j=(q.match(/\n?(.*)\n.*$/)||{})[1]||"",D=this.text.split(this._reNewline),B,x=this._getWidthOfLine(this.ctx,b.lineIndex,D),m=this._getLineLeftOffset(x),A=m,w=b.lineIndex;for(var g=0,z=F.length;g<z;g++){B=F[g],A+=this._getWidthOfChar(this.ctx,B,w,g)}var C=this._getIndexOnPrevLine(b,j,A,D);return j.length-C+F.length},_getIndexOnPrevLine:function(G,k,z,w){var C=G.lineIndex-1,q=this._getWidthOfLine(this.ctx,C,w),y=this._getLineLeftOffset(q),j=y,J=0,F;for(var B=0,I=k.length;B<I;B++){var D=k[B],x=this._getWidthOfChar(this.ctx,D,C,B);j+=x;if(j>z){F=!0;var H=j-x,b=j,A=Math.abs(H-z),E=Math.abs(b-z);J=E<A?B:B-1;break}}return F||(J=k.length-1),J},moveCursorUp:function(b){this.abortCursorAnimation(),this._currentCursorOpacity=1;var a=this.getUpCursorOffset(b,this._selectionDirection==="right");b.shiftKey?this.moveCursorUpWithShift(a):this.moveCursorUpWithoutShift(a),this.initDelayedCursor()},moveCursorUpWithShift:function(a){if(this.selectionStart===this.selectionEnd){this.selectionStart-=a}else{if(this._selectionDirection==="right"){this.selectionEnd-=a,this._selectionDirection="right";return}this.selectionStart-=a}this.selectionStart<0&&(this.selectionStart=0),this._selectionDirection="left"},moveCursorUpWithoutShift:function(a){this.selectionStart===this.selectionEnd&&(this.selectionStart-=a),this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd=this.selectionStart,this._selectionDirection="left"},moveCursorLeft:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorLeftWithShift(a):this.moveCursorLeftWithoutShift(a),this.initDelayedCursor()},_move:function(b,a,c){b.altKey?this[a]=this["findWordBoundary"+c](this[a]):b.metaKey?this[a]=this["findLineBoundary"+c](this[a]):this[a]+=c==="Left"?-1:1},_moveLeft:function(b,a){this._move(b,a,"Left")},_moveRight:function(b,a){this._move(b,a,"Right")},moveCursorLeftWithoutShift:function(a){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(a,"selectionStart"),this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(a){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(a,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(a){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length){return}this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorRightWithShift(a):this.moveCursorRightWithoutShift(a),this.initDelayedCursor()},moveCursorRightWithShift:function(a){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):(this._selectionDirection="right",this._moveRight(a,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(a){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(a){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(a):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.selectionEnd=this.selectionStart,this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(c){if(this.selectionStart!==0){if(c.metaKey){var a=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(a,this.selectionStart),this.selectionStart=a}else{if(c.altKey){var d=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d}else{var b=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n";this.removeStyleObject(b),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(f,b,g,d,a,c){this.styles[b]?this._setSVGTextLineChars(f,b,g,d,a,c):this.callSuper("_setSVGTextLineText",f,b,g,d,a)},_setSVGTextLineChars:function(y,E,k,b,q,F){var j=E===0||this.useNative?"y":"dy",D=y.split(""),B=0,x=this._getSVGLineLeftOffset(E),m=this._getSVGLineTopOffset(E),A=this._getHeightOfLine(this.ctx,E);for(var w=0,g=D.length;w<g;w++){var z=this.styles[E][w]||{};k.push(this._createTextCharSpan(D[w],z,x,m,j,B));var C=this._getWidthOfChar(this.ctx,D[w],E,w);z.textBackgroundColor&&F.push(this._createTextCharBg(z,x,m,A,C,B)),B+=C}},_getSVGLineLeftOffset:function(a){return this._boundaries&&this._boundaries[a]?fabric.util.toFixed(this._boundaries[a].left,2):0},_getSVGLineTopOffset:function(b){var a=0;for(var c=0;c<=b;c++){a+=this._getHeightOfLine(this.ctx,c)}return a-this.height/2},_createTextCharBg:function(f,b,g,d,a,c){return['<rect fill="',f.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+d,")",'" x="',b+c,'" y="',g+d,'" width="',a,'" height="',d,'"></rect>'].join("")},_createTextCharSpan:function(f,b,h,d,a,c){var g=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},b));return['<tspan x="',h+c,'" ',a,'="',d,'" ',b.fontFamily?'font-family="'+b.fontFamily.replace(/"/g,"'")+'" ':"",b.fontSize?'font-size="'+b.fontSize+'" ':"",b.fontStyle?'font-style="'+b.fontStyle+'" ':"",b.fontWeight?'font-weight="'+b.fontWeight+'" ':"",b.textDecoration?'text-decoration="'+b.textDecoration+'" ':"",'style="',g,'">',fabric.util.string.escapeXml(f),"</tspan>"].join("")}}),function(){function request(e,t,n){var r=URL.parse(e);r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);var i=r.port===443?HTTPS:HTTP,s=i.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(e){var r="";t&&e.setEncoding(t),e.on("end",function(){n(r)}),e.on("data",function(t){e.statusCode===200&&(r+=t)})});s.on("error",function(e){e.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(e.message)}),s.end()}function requestFs(e,t){var n=require("fs");n.readFile(e,function(e,n){if(e){throw fabric.log(e),e}t(n)})}if(typeof document!="undefined"&&typeof window!="undefined"){return}var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(e,t,n){function r(r){i.src=new Buffer(r,"binary"),i._src=e,t&&t.call(n,i)}var i=new Image;e&&(e instanceof Buffer||e.indexOf("data")===0)?(i.src=i._src=e,t&&t.call(n,i)):e&&e.indexOf("http")!==0?requestFs(e,r):e?request(e,"binary",r):t&&t.call(n,e)},fabric.loadSVGFromURL=function(e,t,n){e=e.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),e.indexOf("http")!==0?requestFs(e,function(e){fabric.loadSVGFromString(e.toString(),t,n)}):request(e,"",function(e){fabric.loadSVGFromString(e,t,n)})},fabric.loadSVGFromString=function(e,t,n){var r=(new DOMParser).parseFromString(e);fabric.parseSVGDocument(r.documentElement,function(e,n){t&&t(e,n)},n)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(e,t){fabric.util.loadImage(e.src,function(n){var r=new fabric.Image(n);r._initConfig(e),r._initFilters(e,function(e){r.filters=e||[],t&&t(r)})})},fabric.createCanvasForNode=function(e,t,n,r){r=r||n;var i=fabric.document.createElement("canvas"),s=new Canvas(e||600,t||600,r);i.style={},i.width=s.width,i.height=s.height;var o=fabric.Canvas||fabric.StaticCanvas,u=new o(i,n);return u.contextContainer=s.getContext("2d"),u.nodeCanvas=s,u.Font=Canvas.Font,u},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){return this.nodeCanvas.createJPEGStream(e)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(e){return origSetWidth.call(this,e),this.nodeCanvas.width=e,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(e){return origSetHeight.call(this,e),this.nodeCanvas.height=e,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}();